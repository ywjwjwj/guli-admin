{"version":3,"file":"dropdown-menu.js","sources":["../../src/dropdown/dropdown-menu.tsx"],"sourcesContent":["import Vue, { VueConstructor } from 'vue';\nimport DropdownItem from './dropdown-item';\nimport { prefix } from '../config';\nimport { TNodeReturnValue } from '../common';\nimport { DropdownOption } from './type';\nimport { renderTNodeJSX } from '../utils/render-tnode';\nimport { pxCompat } from '../utils/helper';\n\nconst name = `${prefix}-dropdown__menu`;\nexport interface DropdownMenuInstance extends Vue {\n  dropdown: {\n    options: DropdownOption[];\n    maxHeight: number;\n    minColumnWidth: number;\n    maxColumnWidth: number;\n  };\n}\n\nexport default (Vue as VueConstructor<DropdownMenuInstance>).extend({\n  name: 'TDropdownMenu',\n  inject: {\n    dropdown: {\n      default: undefined,\n    },\n  },\n  data() {\n    return {\n      path: '', // 当前选中路径，形如{/id1/id2/id3}\n    };\n  },\n  methods: {\n    isActive(item: DropdownOption, pathPrefix: string, excludeSelf = true): boolean {\n      const itemPath = `${pathPrefix}/${item.value}`;\n      if (excludeSelf && this.path === itemPath) {\n        return false;\n      }\n      return this.path.indexOf(itemPath) === 0;\n    },\n    handleHoverItem(path: string) {\n      this.path = path;\n    },\n    handleItemClick(data: DropdownOption, context: { e: MouseEvent }, idx: number) {\n      this.dropdown.options[idx].onClick?.(data, context);\n    },\n    renderMenuColumn(children: Array<DropdownOption>, showSubmenu: boolean, pathPrefix: string): TNodeReturnValue {\n      const menuClass = [`${name}-column`, 'narrow-scrollbar', { submenu__visible: showSubmenu }];\n      const { maxHeight, maxColumnWidth, minColumnWidth } = this.dropdown;\n      return (\n        <div\n          class={menuClass}\n          style={{\n            maxHeight: `${maxHeight}px`,\n            maxWidth: pxCompat(maxColumnWidth),\n            minWidth: pxCompat(minColumnWidth),\n          }}\n        >\n          {children.map((item, idx) => (\n            <DropdownItem\n              key={idx}\n              disabled={item.disabled}\n              active={this.isActive(item, pathPrefix) || item.active}\n              value={item.value}\n              content={item.content}\n              divider={item.divider}\n              hasChildren={item.children && item.children.length > 0}\n              path={`${pathPrefix}/${item.value}`}\n              onClick={(data: DropdownOption, context: { e: MouseEvent }) => this.handleItemClick(data, context, idx)}\n              onHover={this.handleHoverItem}\n            />\n          ))}\n        </div>\n      );\n    },\n  },\n\n  render() {\n    const columns: TNodeReturnValue[] = [];\n    let menuItems = this.dropdown.options as DropdownOption[];\n    let pathPrefix = '';\n    if (this.$scopedSlots.default) {\n      return (\n        <div class={name}>\n          <div\n            class={[`${name}__column`, 'narrow-scrollbar']}\n            style={{\n              maxHeight: `${this.dropdown.maxHeight}px`,\n              maxWidth: `${this.dropdown.maxColumnWidth}px`,\n              minWidth: `${this.dropdown.minColumnWidth}px`,\n            }}\n          >\n            {renderTNodeJSX(this, 'default')}\n          </div>\n        </div>\n      );\n    }\n    // 根据path渲染\n    while (menuItems && menuItems.length) {\n      // eslint-disable-next-line\n      const activeItem = menuItems.find((item) => this.isActive(item, pathPrefix, false));\n\n      columns.push(this.renderMenuColumn(menuItems, !!activeItem, pathPrefix));\n\n      if (activeItem) {\n        pathPrefix = `${pathPrefix}/${activeItem.value}`;\n        menuItems = activeItem.children || [];\n      } else {\n        menuItems = [];\n      }\n    }\n    return <div class={name}>{columns}</div>;\n  },\n});\n"],"names":["name","prefix","Vue","extend","inject","dropdown","data","path","methods","isActive","item","pathPrefix","excludeSelf","itemPath","value","indexOf","handleHoverItem","handleItemClick","context","idx","options","onClick","renderMenuColumn","children","showSubmenu","menuClass","submenu__visible","maxHeight","maxColumnWidth","minColumnWidth","maxWidth","pxCompat","minWidth","map","DropdownItem","disabled","active","content","divider","length","render","columns","menuItems","$scopedSlots","renderTNodeJSX","activeItem","find","push"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAKA,IAAMA,IAAI,GAAMC,EAAAA,CAAAA,MAAAA,CAAAA,aAAN,EAAV,iBAAA,CAAA,CAAA;AACA,oBAAeC,uBAAG,CAACC,MAAJ,CAAW;AACxBH,EAAAA,IAAI,EAAE,eADkB;AAExBI,EAAAA,MAAM,EAAE;AACNC,IAAAA,QAAQ,EAAE;AACR,MAAA,SAAA,EAAS,KAAK,CAAA;AADN,KAAA;AADJ,GAFgB;AAOxBC,EAAAA,IAPwB,EAOjB,SAAA,IAAA,GAAA;AACL,IAAO,OAAA;AACLC,MAAAA,IAAI,EAAE,EAAA;AADD,KAAP,CAAA;AAGD,GAXuB;AAYxBC,EAAAA,OAAO,EAAE;AACPC,IAAAA,QADO,EAAA,SAAA,QAAA,CACEC,IADF,EACQC,UADR,EACwC;AAAA,MAApBC,IAAAA,WAAoB,uEAAN,IAAM,CAAA;AAC7C,MAAA,IAAMC,QAAQ,GAAMF,EAAAA,CAAAA,MAAAA,CAAAA,UAAN,cAAoBD,IAAI,CAACI,KAAzB,CAAd,CAAA;;AACA,MAAA,IAAIF,WAAW,IAAI,IAAA,CAAKL,IAAL,KAAcM,QAAjC,EAA2C;AACzC,QAAA,OAAO,KAAP,CAAA;AACD,OAAA;;AACD,MAAA,OAAO,KAAKN,IAAL,CAAUQ,OAAV,CAAkBF,QAAlB,MAAgC,CAAvC,CAAA;AACD,KAPM;AAQPG,IAAAA,eARO,EAQST,SAAAA,eAAAA,CAAAA,IART,EAQe;AACpB,MAAKA,IAAAA,CAAAA,IAAL,GAAYA,IAAZ,CAAA;AACD,KAVM;AAWPU,IAAAA,eAXO,EAWSX,SAAAA,eAAAA,CAAAA,IAXT,EAWeY,OAXf,EAWwBC,GAXxB,EAW6B;AAAA,MAAA,IAAA,qBAAA,EAAA,sBAAA,CAAA;;AAClC,MAAKd,CAAAA,qBAAAA,GAAAA,CAAAA,sBAAAA,GAAAA,IAAAA,CAAAA,QAAL,CAAce,OAAd,CAAsBD,GAAtB,GAA2BE,OAA3B,MAAA,IAAA,IAAA,qBAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,qBAAA,CAAA,IAAA,CAAA,sBAAA,EAAqCf,IAArC,EAA2CY,OAA3C,CAAA,CAAA;AACD,KAbM;AAcPI,IAAAA,gBAdO,EAcUC,SAAAA,gBAAAA,CAAAA,QAdV,EAcoBC,WAdpB,EAciCb,UAdjC,EAc6C;AAAA,MAAA,IAAA,KAAA,GAAA,IAAA,CAAA;;AAAA,MAAA,IAAA,CAAA,GAAA,IAAA,CAAA,cAAA,CAAA;AAClD,MAAA,IAAMc,SAAS,GAAG,CAAA,EAAA,CAAA,MAAA,CAAIzB,IAAJ,EAAA,SAAA,CAAA,EAAmB,kBAAnB,EAAuC;AAAE0B,QAAAA,gBAAgB,EAAEF,WAAAA;AAApB,OAAvC,CAAlB,CAAA;AACA,MAAA,IAAA,cAAA,GAAsD,KAAKnB,QAA3D;AAAA,UAAQsB,SAAR,kBAAQA,SAAR;AAAA,UAAmBC,cAAnB,kBAAmBA,cAAnB;AAAA,UAAmCC,cAAnC,kBAAmCA,cAAnC,CAAA;AACA,MAAA,OAAA,CAAA,CAAA,KAAA,EAAA;AAAA,QAAA,OAAA,EAAmBJ,SAAnB;AAAA,QAAqC,OAAA,EAAA;AACnCE,UAAAA,SAAS,EAAKA,EAAAA,CAAAA,MAAAA,CAAAA,SAAL,EAD0B,IAAA,CAAA;AAEnCG,UAAAA,QAAQ,EAAEC,qBAAQ,CAACH,cAAD,CAFiB;AAGnCI,UAAAA,QAAQ,EAAED,qBAAQ,CAACF,cAAD,CAAA;AAHiB,SAAA;AAArC,OAAA,EAAA,CAIIN,QAAQ,CAACU,GAAT,CAAa,UAACvB,IAAD,EAAOS,GAAP,EAAA;AAAA,QAAA,OAAA,CAAA,CAAAe,gCAAA,EAAA;AAAA,UAAA,KAAA,EAAkCf,GAAlC;AAAA,UAAA,OAAA,EAAA;AAAA,YAAiDT,UAAAA,EAAAA,IAAI,CAACyB,QAAtD;AAAA,YAAwE,QAAA,EAAA,KAAI,CAAC1B,QAAL,CAAcC,IAAd,EAAoBC,UAApB,CAAA,IAAmCD,IAAI,CAAC0B,MAAhH;AAAA,YAA+H1B,OAAAA,EAAAA,IAAI,CAACI,KAApI;AAAA,YAAoJJ,SAAAA,EAAAA,IAAI,CAAC2B,OAAzJ;AAAA,YAA2K3B,SAAAA,EAAAA,IAAI,CAAC4B,OAAhL;AAAA,YAAsM5B,aAAAA,EAAAA,IAAI,CAACa,QAAL,IAAiBb,IAAI,CAACa,QAAL,CAAcgB,MAAd,GAAuB,CAA9O;AAAA,YAAA,MAAA,EAAA,EAAA,CAAA,MAAA,CAA0P5B,UAA1P,EAAA,GAAA,CAAA,CAAA,MAAA,CAAwQD,IAAI,CAACI,KAA7Q,CAAA;AAAA,WAAA;AAAA,UAAA,IAAA,EAAA;AAAA,YAA+R,OAAA,EAAA,SAAA,KAAA,CAACR,IAAD,EAAOY,OAAP,EAAA;AAAA,cAAmB,OAAA,KAAI,CAACD,eAAL,CAAqBX,IAArB,EAA2BY,OAA3B,EAAoCC,GAApC,CAAnB,CAAA;AAAA,aAA/R;AAAA,YAAA,OAAA,EAAqW,KAAI,CAACH,eAAAA;AAA1W,WAAA;AAAA,SAAA,CAAA,CAAA;AAAA,OAAb,CAJJ,CAAA,CAAA,CAAA;AAKD,KAAA;AAtBM,GAZe;AAoCxBwB,EAAAA,MApCwB,EAoCf,SAAA,MAAA,GAAA;AAAA,IAAA,IAAA,MAAA,GAAA,IAAA,CAAA;;AAAA,IAAA,IAAA,CAAA,GAAA,SAAA,CAAA,CAAA,CAAA,CAAA;AACP,IAAMC,IAAAA,OAAO,GAAG,EAAhB,CAAA;AACA,IAAA,IAAIC,SAAS,GAAG,IAAKrC,CAAAA,QAAL,CAAce,OAA9B,CAAA;AACA,IAAIT,IAAAA,UAAU,GAAG,EAAjB,CAAA;;AACA,IAAI,IAAA,IAAA,CAAKgC,YAAL,CAAA,SAAA,CAAJ,EAA+B;AAC7B,MAAA,OAAA,CAAA,CAAA,KAAA,EAAA;AAAA,QAAmB3C,OAAAA,EAAAA,IAAAA;AAAnB,OAAA,EAAA,CAAA,CAAA,CAAA,KAAA,EAAA;AAAA,QAAA,OAAA,EAAqC,CAAIA,EAAAA,CAAAA,MAAAA,CAAAA,IAAJ,EAAoB,UAAA,CAAA,EAAA,kBAApB,CAArC;AAAA,QAAqF,OAAA,EAAA;AACnF2B,UAAAA,SAAS,EAAK,EAAA,CAAA,MAAA,CAAA,IAAA,CAAKtB,QAAL,CAAcsB,SAAnB,EAD0E,IAAA,CAAA;AAEnFG,UAAAA,QAAQ,EAAK,EAAA,CAAA,MAAA,CAAA,IAAA,CAAKzB,QAAL,CAAcuB,cAAnB,EAF2E,IAAA,CAAA;AAGnFI,UAAAA,QAAQ,EAAA,EAAA,CAAA,MAAA,CAAK,IAAK3B,CAAAA,QAAL,CAAcwB,cAAnB,EAAA,IAAA,CAAA;AAH2E,SAAA;AAArF,OAAA,EAAA,CAIIe,gCAAc,CAAC,IAAD,EAAO,SAAP,CAJlB,CAAA,CAAA,CAAA,CAAA,CAAA;AAKD,KAAA;;AACD,IAAA,OAAOF,SAAS,IAAIA,SAAS,CAACH,MAA9B,EAAsC;AACpC,MAAA,IAAMM,UAAU,GAAGH,SAAS,CAACI,IAAV,CAAe,UAACpC,IAAD,EAAA;AAAA,QAAU,OAAA,MAAI,CAACD,QAAL,CAAcC,IAAd,EAAoBC,UAApB,EAAgC,KAAhC,CAAV,CAAA;AAAA,OAAf,CAAnB,CAAA;AACA8B,MAAAA,OAAO,CAACM,IAAR,CAAa,KAAKzB,gBAAL,CAAsBoB,SAAtB,EAAiC,CAAC,CAACG,UAAnC,EAA+ClC,UAA/C,CAAb,CAAA,CAAA;;AACA,MAAA,IAAIkC,UAAJ,EAAgB;AACdlC,QAAAA,UAAU,GAAMA,EAAAA,CAAAA,MAAAA,CAAAA,UAAN,cAAoBkC,UAAU,CAAC/B,KAA/B,CAAV,CAAA;AACA4B,QAAAA,SAAS,GAAGG,UAAU,CAACtB,QAAX,IAAuB,EAAnC,CAAA;AACD,OAHD,MAGO;AACLmB,QAAAA,SAAS,GAAG,EAAZ,CAAA;AACD,OAAA;AACF,KAAA;;AACD,IAAA,OAAA,CAAA,CAAA,KAAA,EAAA;AAAA,MAAmB1C,OAAAA,EAAAA,IAAAA;AAAnB,KAAA,EAAA,CAA0ByC,OAA1B,CAAA,CAAA,CAAA;AACD,GAAA;AA1DuB,CAAX,CAAf;;;;"}