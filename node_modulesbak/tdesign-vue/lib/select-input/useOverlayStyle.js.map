{"version":3,"file":"useOverlayStyle.js","sources":["../../src/select-input/useOverlayStyle.ts"],"sourcesContent":["import {\n  ref, toRefs, watch, getCurrentInstance,\n} from '@vue/composition-api';\nimport isObject from 'lodash/isObject';\nimport isFunction from 'lodash/isFunction';\nimport { TdPopupProps, PopupVisibleChangeContext } from '../popup';\nimport { TdSelectInputProps } from './type';\nimport { Styles } from '../common';\n\n// 单位：px\nconst MAX_POPUP_WIDTH = 1000;\n\nexport default function useOverlayStyle(props: TdSelectInputProps) {\n  const instance = getCurrentInstance();\n\n  const { popupProps, autoWidth } = toRefs(props);\n  const innerPopupVisible = ref(false);\n  const tOverlayStyle = ref<TdPopupProps['overlayStyle']>();\n\n  const macthWidthFunc = (triggerElement: HTMLElement, popupElement: HTMLElement) => {\n    // 避免因滚动条出现文本省略，预留宽度 8\n    const SCROLLBAR_WIDTH = popupElement.scrollHeight > popupElement.offsetHeight ? 8 : 0;\n    const width = popupElement.offsetWidth + SCROLLBAR_WIDTH >= triggerElement.offsetWidth\n      ? popupElement.offsetWidth\n      : triggerElement.offsetWidth;\n    let otherOverlayStyle: Styles = {};\n    if (popupProps.value && typeof popupProps.value.overlayStyle === 'object' && !popupProps.value.overlayStyle.width) {\n      otherOverlayStyle = popupProps.value.overlayStyle;\n    }\n    return {\n      width: `${Math.min(width, MAX_POPUP_WIDTH)}px`,\n      ...otherOverlayStyle,\n    };\n  };\n\n  const onInnerPopupVisibleChange = (visible: boolean, context: PopupVisibleChangeContext) => {\n    if (props.disabled || props.readonly) return;\n    // 如果点击触发元素（输入框），则永久显示下拉框\n    const newVisible = context.trigger === 'trigger-element-click' ? true : visible;\n    innerPopupVisible.value = newVisible;\n    props.onPopupVisibleChange?.(newVisible, context);\n    instance.emit('popup-visible-change', newVisible, context);\n  };\n\n  watch([innerPopupVisible, popupProps], () => {\n    if (tOverlayStyle.value) return;\n    let result: TdPopupProps['overlayStyle'] = {};\n    const overlayStyle = popupProps.value?.overlayStyle || {};\n    if (isFunction(overlayStyle) || (isObject(overlayStyle) && overlayStyle.width)) {\n      result = overlayStyle;\n    } else if (!autoWidth.value) {\n      result = macthWidthFunc;\n    }\n    tOverlayStyle.value = result;\n  });\n\n  return {\n    tOverlayStyle,\n    innerPopupVisible,\n    onInnerPopupVisibleChange,\n  };\n}\n"],"names":["MAX_POPUP_WIDTH","useOverlayStyle","props","instance","getCurrentInstance","toRefs","popupProps","autoWidth","innerPopupVisible","ref","tOverlayStyle","macthWidthFunc","triggerElement","popupElement","SCROLLBAR_WIDTH","scrollHeight","offsetHeight","width","offsetWidth","otherOverlayStyle","value","_typeof","overlayStyle","Math","min","onInnerPopupVisibleChange","visible","context","disabled","readonly","newVisible","trigger","onPopupVisibleChange","emit","watch","result","isFunction","isObject"],"mappings":"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"}