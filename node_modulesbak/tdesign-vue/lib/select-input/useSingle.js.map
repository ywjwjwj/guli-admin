{"version":3,"file":"useSingle.js","sources":["../../src/select-input/useSingle.tsx"],"sourcesContent":["import {\n  SetupContext, ref, computed, toRefs, getCurrentInstance,\n} from '@vue/composition-api';\n\nimport isObject from 'lodash/isObject';\nimport pick from 'lodash/pick';\nimport { SelectInputCommonProperties } from './interface';\nimport { TdSelectInputProps } from './type';\n\nimport Input, { InputValue } from '../input';\nimport Loading from '../loading';\n\nimport { useTNodeJSX } from '../hooks/tnode';\nimport { usePrefixClass } from '../config-provider';\nimport useDefaultValue from '../hooks/useDefaultValue';\n\n// single 和 multiple 共有特性\nconst COMMON_PROPERTIES = [\n  'status',\n  'clearable',\n  'disabled',\n  'label',\n  'placeholder',\n  'readonly',\n  'suffix',\n  'suffixIcon',\n  'onPaste',\n  'onEnter',\n  'onMouseenter',\n  'onMouseleave',\n];\n\nconst DEFAULT_KEYS = {\n  label: 'label',\n  value: 'value',\n};\n\nfunction getInputValue(value: TdSelectInputProps['value'], keys: TdSelectInputProps['keys']) {\n  const iKeys = keys || DEFAULT_KEYS;\n  return isObject(value) ? value[iKeys.label] : value;\n}\n\nexport default function useSingle(props: TdSelectInputProps, context: SetupContext) {\n  const instance = getCurrentInstance();\n\n  const { value, keys, inputValue: propsInputValue } = toRefs(props);\n  const classPrefix = usePrefixClass();\n\n  const [inputValue, setInputValue] = useDefaultValue(\n    propsInputValue,\n    props.defaultInputValue ?? '',\n    props.onInputChange,\n    'inputValue',\n    'input-change',\n  );\n\n  const inputRef = ref();\n  const renderTNode = useTNodeJSX();\n\n  const commonInputProps = computed<SelectInputCommonProperties>(() => pick(props, COMMON_PROPERTIES));\n\n  const onInnerClear = (context: { e: MouseEvent }) => {\n    context?.e?.stopPropagation();\n    props.onClear?.(context);\n    instance.emit('clear', context);\n    setInputValue('', { trigger: 'clear' });\n  };\n\n  const onInnerInputChange = (value: InputValue, context: { e: InputEvent | MouseEvent }) => {\n    if (props.allowInput) {\n      setInputValue(value, { ...context, trigger: 'input' });\n    }\n  };\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const renderSelectSingle = (h: Vue.CreateElement, popupVisible: boolean) => {\n    const singleValueDisplay = renderTNode('valueDisplay');\n    const displayedValue = popupVisible && props.allowInput ? inputValue.value : getInputValue(value.value, keys.value);\n    const prefixContent = [singleValueDisplay, renderTNode('label')];\n    const inputProps = {\n      ...commonInputProps.value,\n      ...props.inputProps,\n      value: singleValueDisplay ? undefined : displayedValue,\n      label: prefixContent.length ? () => prefixContent : undefined,\n      autoWidth: props.autoWidth,\n      readonly: !props.allowInput,\n      placeholder: singleValueDisplay ? '' : props.placeholder,\n      suffixIcon: !props.disabled && props.loading ? () => <Loading loading size=\"small\" /> : props.suffixIcon,\n      showClearIconOnEmpty: Boolean(props.clearable && inputValue.value),\n      inputClass: {\n        [`${classPrefix.value}-input--focused`]: popupVisible,\n      },\n    };\n\n    return (\n      <Input\n        ref=\"inputRef\"\n        props={inputProps}\n        scopedSlots={context.slots}\n        onChange={onInnerInputChange}\n        onClear={onInnerClear}\n        onBlur={(val: InputValue, context: { e: MouseEvent }) => {\n          props.onBlur?.(value.value, { ...context, inputValue: val });\n          instance.emit('blur', value.value, { ...context, inputValue: val });\n        }}\n        onEnter={(val: InputValue, context: { e: KeyboardEvent }) => {\n          props.onEnter?.(value.value, { ...context, inputValue: val });\n          instance.emit('enter', value.value, { ...context, inputValue: val });\n        }}\n        onFocus={(val: InputValue, context: { e: MouseEvent }) => {\n          props.onFocus?.(value.value, { ...context, inputValue: val });\n          instance.emit('focus', value.value, { ...context, tagInputValue: val });\n          !popupVisible && setInputValue(getInputValue(value.value, keys.value), { ...context, trigger: 'input' }); // 聚焦时拿到value\n        }}\n      />\n    );\n  };\n\n  return {\n    inputRef,\n    commonInputProps,\n    onInnerClear,\n    renderSelectSingle,\n  };\n}\n"],"names":["COMMON_PROPERTIES","DEFAULT_KEYS","label","value","getInputValue","keys","iKeys","isObject","useSingle","props","context","instance","getCurrentInstance","toRefs","propsInputValue","inputValue","classPrefix","usePrefixClass","useDefaultValue","defaultInputValue","onInputChange","_slicedToArray","setInputValue","inputRef","ref","renderTNode","useTNodeJSX","commonInputProps","computed","pick","onInnerClear","context2","e","stopPropagation","onClear","emit","trigger","onInnerInputChange","value2","allowInput","renderSelectSingle","h","popupVisible","singleValueDisplay","displayedValue","prefixContent","inputProps","length","autoWidth","readonly","placeholder","suffixIcon","disabled","loading","Loading","showClearIconOnEmpty","Boolean","clearable","inputClass","Input","_mergeJSXProps","slots","val","onBlur","onEnter","onFocus","tagInputValue"],"mappings":"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"}