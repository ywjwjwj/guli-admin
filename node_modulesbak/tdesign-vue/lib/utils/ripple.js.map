{"version":3,"file":"ripple.js","sources":["../../src/utils/ripple.ts"],"sourcesContent":["/**\n * 用法\n * v-ripple\n * 固定色值 v-ripple=\"动画条的背景色\" eg: v-ripple=\"#808080\"\n * 动态色值(推荐) v-ripple=\"true\" data.ripple=\"rippleColor\"\n */\n\nimport { DirectiveBinding } from 'vue/types/options';\nimport setStyle from '../_common/js/utils/set-style';\nimport { prefix } from '../config';\n\nconst Ripple = {\n  startTimeId: null as NodeJS.Timeout,\n  finishTimeId: null as NodeJS.Timeout,\n  inserted(el: HTMLElement, binding: DirectiveBinding) {\n    // 关闭ripple\n    if (binding.value === false) return;\n    const period = 200;\n    const defaultBg = 'rgba(0, 0, 0, 0.35)';\n    let bg = binding.value === true || binding.value == null ? defaultBg : binding.value;\n    const rippleContainer = document.createElement('div');\n    let hasCreateContainer = false;\n    let count = 0;\n\n    el.addEventListener('pointerdown', (e: PointerEvent) => {\n      if (\n        el.classList.contains(`${prefix}-is-active`)\n        || el.classList.contains(`${prefix}-is-disabled`)\n        || el.classList.contains(`${prefix}-is-checked`)\n      ) {\n        return;\n      }\n\n      if (e.button !== 0) return; // 非鼠标左键点击；避免出现动画之后不消失的bug\n\n      // 支持通过dataset传递背景色\n      if (bg === defaultBg && el?.dataset.ripple) {\n        bg = el.dataset.ripple;\n      }\n\n      // 支持通过css variable传递背景色\n      const cssVariable = getComputedStyle(el).getPropertyValue('--ripple-color');\n      if (cssVariable) {\n        bg = cssVariable;\n      }\n\n      const elBorder = parseInt(getComputedStyle(el).borderWidth.replace('px', ''), 10);\n      const border = elBorder > 0 ? elBorder : 0;\n      const width = el.offsetWidth;\n      const height = el.offsetHeight;\n      const style = getComputedStyle(el);\n\n      if (!hasCreateContainer) {\n        hasCreateContainer = true;\n        setStyle(rippleContainer, {\n          position: 'absolute',\n          left: `${0 - border}px`,\n          top: `${0 - border}px`,\n          width: `${width}px`,\n          height: `${height}px`,\n          borderRadius: style.borderRadius,\n          pointerEvents: 'none',\n          overflow: 'hidden',\n        });\n        el.appendChild(rippleContainer);\n      }\n\n      const ripple = document.createElement('div');\n\n      setStyle(ripple, {\n        marginTop: '0',\n        marginLeft: '0',\n        right: `${width}px`,\n        width: `${width + 20}px`,\n        height: '100%',\n        transition: `transform ${period}ms cubic-bezier(.38, 0, .24, 1), background ${period * 2}ms linear`,\n        transform: 'skewX(-8deg)',\n        pointerEvents: 'none',\n        position: 'absolute',\n        zIndex: '0',\n        backgroundColor: bg,\n        opacity: '0.9',\n      });\n\n      // fix zIndex：避免遮盖内部元素\n      const elMap = new WeakMap();\n      for (let n = el.children.length, i = 0; i < n; ++i) {\n        const child = el.children[i];\n        if ((child as HTMLElement).style.zIndex === '' && child !== rippleContainer) {\n          (child as HTMLElement).style.zIndex = '1';\n          elMap.set(child, true);\n        }\n      }\n\n      // fix position\n      const initPosition = el.style.position ? el.style.position : getComputedStyle(el).position;\n      if (initPosition === '' || initPosition === 'static') {\n        // eslint-disable-next-line no-param-reassign\n        el.style.position = 'relative';\n      }\n\n      rippleContainer.insertBefore(ripple, rippleContainer.firstChild);\n      count += 1;\n\n      clearTimeout(Ripple.startTimeId);\n      Ripple.startTimeId = setTimeout(() => {\n        ripple.style.transform = `translateX(${width}px)`;\n      }, 0);\n\n      const handleClearRipple = () => {\n        ripple.style.backgroundColor = 'rgba(0, 0, 0, 0)';\n\n        el.removeEventListener('pointerup', handleClearRipple, false);\n        el.removeEventListener('pointerleave', handleClearRipple, false);\n\n        setTimeout(() => {\n          rippleContainer.removeChild(ripple);\n          count -= 1;\n          if (count > 0) return; // 避免因为移除了relative的定位，从而导致动画漂移\n          // eslint-disable-next-line no-param-reassign\n          el.style.position = initPosition !== 'static' ? initPosition : '';\n\n          // reset zIndex\n          for (let n = el.children.length, i = 0; i < n; ++i) {\n            const child: Element = el.children[i];\n            if (elMap.has(child)) {\n              (child as HTMLElement).style.zIndex = '';\n              elMap.delete(child);\n            }\n          }\n          // 由于容器的尺寸可能会发生变更，因此在动画结束之后，手动移除\n          el.removeChild(rippleContainer);\n          hasCreateContainer = false;\n        }, period * 2 + 100);\n      };\n      el.addEventListener('pointerup', handleClearRipple, false);\n      el.addEventListener('pointerleave', handleClearRipple, false); // 处理鼠标按下不松手直接离开点击block的情况..\n    });\n  },\n};\n\nexport default Ripple;\n"],"names":["Ripple","startTimeId","finishTimeId","inserted","el","binding","value","period","defaultBg","bg","rippleContainer","document","createElement","hasCreateContainer","count","addEventListener","e","classList","contains","prefix","button","dataset","ripple","cssVariable","getComputedStyle","getPropertyValue","elBorder","parseInt","borderWidth","replace","border","width","offsetWidth","height","offsetHeight","style","setStyle","position","left","top","borderRadius","pointerEvents","overflow","appendChild","marginTop","marginLeft","right","transition","transform","zIndex","backgroundColor","opacity","elMap","WeakMap","n","children","length","i","child","set","initPosition","insertBefore","firstChild","clearTimeout","setTimeout","handleClearRipple","removeEventListener","removeChild","has"],"mappings":"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"}