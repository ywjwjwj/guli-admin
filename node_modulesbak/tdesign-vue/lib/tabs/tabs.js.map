{"version":3,"file":"tabs.js","sources":["../../src/tabs/tabs.tsx"],"sourcesContent":["import Vue, { VNode, VueConstructor } from 'vue';\nimport kebabCase from 'lodash/kebabCase';\nimport props from './props';\nimport { prefix } from '../config';\nimport TTabPanel from './tab-panel';\nimport TTabNav from './tab-nav';\nimport { TabValue, TdTabsProps } from './type';\nimport { emitEvent } from '../utils/event';\n\ninterface TabVue extends Vue {\n  listPanels?: Array<VNode>;\n}\n\nexport default (Vue as VueConstructor<TabVue>).extend({\n  name: 'TTabs',\n  model: {\n    prop: 'value',\n    event: 'change',\n  },\n\n  components: {\n    TTabPanel,\n    TTabNav,\n  },\n\n  ...{ listPanels: null as Array<VNode> },\n\n  props: { ...props },\n\n  provide(): { parent: TabVue } {\n    return {\n      parent: this,\n    };\n  },\n\n  data() {\n    return {\n      panels: [] as Array<InstanceType<typeof TTabPanel>>,\n    };\n  },\n\n  watch: {\n    list: {\n      handler() {\n        this.listPanels = this.createListPanels();\n      },\n      deep: true,\n    },\n  },\n\n  mounted() {\n    this.updatePanels();\n  },\n\n  updated() {\n    this.$nextTick(() => {\n      this.updatePanels();\n    });\n  },\n\n  methods: {\n    updatePanels({ force = false } = {}) {\n      if (!this.listPanels) {\n        this.panels = this.panels || [];\n        return;\n      }\n      const newPanels = this.listPanels\n        .map((panel: VNode) => panel.componentInstance as InstanceType<typeof TTabPanel>)\n        .filter(Boolean)\n        .filter((child) => kebabCase(child?.$vnode?.tag).endsWith(`${prefix}-tab-panel`));\n      const isUnchange = () => newPanels.length === this.panels.length && this.panels.every((panel, index) => panel === newPanels[index]);\n      if (isUnchange() && !force) return;\n      this.panels = newPanels;\n    },\n    onAddTab(e: MouseEvent) {\n      emitEvent<Parameters<TdTabsProps['onAdd']>>(this, 'add', { e });\n    },\n    onChangeTab(value: TabValue) {\n      emitEvent<Parameters<TdTabsProps['onChange']>>(this, 'change', value);\n    },\n    onRemoveTab({ e, value, index }: Parameters<TdTabsProps['onRemove']>[0]) {\n      const panel = this.panels[index];\n      const eventData = {\n        value,\n        index,\n        e,\n      };\n      emitEvent<Parameters<TdTabsProps['onRemove']>>(this, 'remove', eventData);\n      if (!panel) return;\n      emitEvent<Parameters<TdTabsProps['onRemove']>>(panel, 'remove', eventData);\n    },\n    renderHeader() {\n      const tabNavProps = {\n        theme: this.theme,\n        value: this.value,\n        size: this.size,\n        disabled: this.disabled,\n        placement: this.placement,\n        addable: this.addable,\n        panels: this.panels,\n      };\n      return (\n        <div\n          class={{\n            [`${prefix}-tabs__header`]: true,\n            [`${prefix}-is-${this.placement}`]: true,\n          }}\n        >\n          <TTabNav\n            props={tabNavProps}\n            onChange={this.onChangeTab}\n            onAdd={this.onAddTab}\n            onRemove={this.onRemoveTab}\n          ></TTabNav>\n        </div>\n      );\n    },\n    createListPanels() {\n      return this.list.map((item) => <TTabPanel props={{ ...item }} onRemove={this.onRemoveTab}></TTabPanel>);\n    },\n    renderList(): VNode[] {\n      if (!this.listPanels) {\n        return this.createListPanels();\n      }\n      return this.listPanels;\n    },\n    renderContent() {\n      // default 的函数可能返回null，此时为了防止 panels 的更新失败，默认用空数组\n      this.listPanels = this.list ? this.renderList() : this.$scopedSlots.default?.({}) || [];\n      return <div class={[`${prefix}-tabs__content`]}>{this.listPanels}</div>;\n    },\n  },\n\n  render() {\n    return (\n      <div class={[`${prefix}-tabs`]}>\n        {this.placement !== 'bottom'\n          ? [this.renderHeader(), this.renderContent()]\n          : [this.renderContent(), this.renderHeader()]}\n      </div>\n    );\n  },\n});\n"],"names":["Vue","extend","name","model","prop","event","components","TTabPanel","TTabNav","listPanels","props","provide","parent","data","panels","watch","list","handler","createListPanels","deep","mounted","updatePanels","updated","$nextTick","methods","force","newPanels","map","panel","componentInstance","filter","Boolean","child","kebabCase","$vnode","tag","endsWith","prefix","isUnchange","length","every","index","onAddTab","e","emitEvent","onChangeTab","value","onRemoveTab","eventData","renderHeader","tabNavProps","theme","size","disabled","placement","addable","_defineProperty","_mergeJSXProps","item","_mergeJSXProps2","renderList","renderContent","$scopedSlots","render"],"mappings":"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"}