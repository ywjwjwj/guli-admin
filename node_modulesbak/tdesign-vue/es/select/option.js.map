{"version":3,"file":"option.js","sources":["../../src/select/option.tsx"],"sourcesContent":["import Vue, { VNode } from 'vue';\nimport { ScopedSlotReturnValue } from 'vue/types/vnode';\nimport get from 'lodash/get';\nimport { renderContent } from '../utils/render-tnode';\nimport mixins from '../utils/mixins';\nimport { scrollSelectedIntoView } from '../utils/dom';\nimport { prefix } from '../config';\nimport CLASSNAMES from '../utils/classnames';\nimport ripple from '../utils/ripple';\nimport props from './option-props';\nimport { TdOptionProps } from './type';\nimport Checkbox from '../checkbox/index';\nimport { SelectInstance } from './instance';\nimport { ClassName } from '../common';\nimport { getKeepAnimationMixins } from '../config-provider/config-receiver';\n\nconst keepAnimationMixins = getKeepAnimationMixins<OptionInstance>();\n\nconst selectName = `${prefix}-select`;\nexport interface OptionInstance extends Vue {\n  tSelect: SelectInstance;\n}\n\nexport default mixins(keepAnimationMixins).extend({\n  name: 'TOption',\n  data() {\n    return {\n      isHover: false,\n      formDisabled: undefined,\n    };\n  },\n  props: { ...props },\n  components: {\n    TCheckbox: Checkbox,\n  },\n  directives: { ripple },\n  inject: {\n    tSelect: {\n      default: undefined,\n    },\n  },\n  watch: {\n    value() {\n      this.tSelect && this.tSelect.getOptions(this);\n    },\n    label() {\n      this.tSelect && this.tSelect.getOptions(this);\n    },\n    hovering() {\n      if (this.hovering) {\n        const timer = setTimeout(() => {\n          scrollSelectedIntoView(this.tSelect.getOverlayElm(), this.$el as HTMLElement);\n          clearTimeout(timer);\n        }, this.tSelect.popupOpenTime); // 待popup弹出后再滚动到对应位置\n      }\n    },\n  },\n  computed: {\n    tDisabled(): boolean {\n      return this.formDisabled || this.disabled;\n    },\n    // 键盘上下按键选中hover样式的选项\n    hovering(): boolean {\n      return (\n        this.tSelect\n        && this.tSelect.visible\n        && this.tSelect.hoverOptions[this.tSelect.hoverIndex]\n        && this.tSelect.hoverOptions[this.tSelect.hoverIndex][this.tSelect.realValue] === this.value\n      );\n    },\n    multiLimitDisabled(): boolean {\n      if (this.tSelect && this.tSelect.multiple && this.tSelect.max) {\n        if (\n          this.tSelect.value instanceof Array\n          && this.tSelect.value.indexOf(this.value) === -1\n          && this.tSelect.max <= this.tSelect.value.length\n        ) {\n          return true;\n        }\n      }\n      return false;\n    },\n    classes(): ClassName {\n      return [\n        `${prefix}-select-option`,\n        {\n          [CLASSNAMES.STATUS.disabled]: this.tDisabled || this.multiLimitDisabled,\n          [CLASSNAMES.STATUS.selected]: this.selected,\n          [CLASSNAMES.SIZE[this.tSelect && this.tSelect.size]]: this.tSelect && this.tSelect.size,\n          [`${prefix}-select-option__hover`]: this.hovering,\n        },\n      ];\n    },\n    isCreatedOption(): boolean {\n      return this.tSelect.creatable && this.value === this.tSelect.searchInput;\n    },\n    show(): boolean {\n      /**\n       * 此属性主要用于slots生成options时显示控制，直传options由select进行显示控制\n       * create的option，始终显示\n       * canFilter只显示待匹配的选项\n       */\n      if (!this.tSelect) return false;\n      if (this.isCreatedOption) return true;\n      if (this.tSelect.canFilter && this.tSelect.searchInput !== '') {\n        return this.tSelect.filterOptions.some(\n          (option: TdOptionProps) => get(option, this.tSelect.realValue) === this.value,\n        );\n      }\n      return true;\n    },\n    labelText(): string | number {\n      return this.label || this.value;\n    },\n    selected(): boolean {\n      let flag = false;\n      if (!this.tSelect) return false;\n      if (this.tSelect.value instanceof Array) {\n        if (this.tSelect.labelInValue) {\n          flag = this.tSelect.value.map((item) => get(item, this.tSelect.realValue)).indexOf(this.value) !== -1;\n        } else {\n          flag = this.tSelect.value.indexOf(this.value) !== -1;\n        }\n      } else if (typeof this.tSelect.value === 'object') {\n        flag = get(this.tSelect.value, this.tSelect.realValue) === this.value;\n      } else {\n        flag = this.tSelect.value === this.value;\n      }\n      return flag;\n    },\n  },\n  methods: {\n    select(e: MouseEvent | KeyboardEvent) {\n      e.stopPropagation();\n      if (this.tDisabled || this.multiLimitDisabled) {\n        return false;\n      }\n      const parent = this.$el.parentNode as HTMLElement;\n      if (parent && parent.className.indexOf(`${selectName}__create-option`) !== -1) {\n        this.tSelect && this.tSelect.createOption(this.value.toString());\n      }\n      this.tSelect && this.tSelect.onOptionClick(this.value, e);\n    },\n    mouseEvent(v: boolean) {\n      this.isHover = v;\n    },\n  },\n  mounted() {\n    this.tSelect && this.tSelect.getOptions(this);\n  },\n  beforeDestroy() {\n    this.tSelect && this.tSelect.hasSlotOptions && this.tSelect.destroyOptions(this);\n  },\n  render(): VNode {\n    const {\n      classes, labelText, selected, disabled, multiLimitDisabled, show,\n    } = this;\n    const children: ScopedSlotReturnValue = renderContent(this, 'default', 'content');\n    const optionChild = children || labelText;\n    return (\n      <li\n        v-show={show}\n        class={classes}\n        title={labelText}\n        onMouseenter={this.mouseEvent.bind(true)}\n        onMouseleave={this.mouseEvent.bind(false)}\n        onClick={this.select}\n        v-ripple={this.keepAnimation.ripple}\n      >\n        {this.tSelect && this.tSelect.multiple ? (\n          <t-checkbox\n            checked={selected}\n            disabled={disabled || multiLimitDisabled}\n            nativeOnClick={(e: MouseEvent) => {\n              e.preventDefault();\n            }}\n          >\n            {optionChild}\n          </t-checkbox>\n        ) : (\n          <span>{optionChild}</span>\n        )}\n      </li>\n    );\n  },\n});\n"],"names":["keepAnimationMixins","getKeepAnimationMixins","selectName","prefix","mixins","extend","name","data","isHover","formDisabled","props","components","TCheckbox","Checkbox","directives","ripple","inject","tSelect","watch","value","getOptions","label","hovering","timer","setTimeout","scrollSelectedIntoView","getOverlayElm","$el","clearTimeout","popupOpenTime","computed","tDisabled","disabled","visible","hoverOptions","hoverIndex","realValue","multiLimitDisabled","multiple","max","Array","indexOf","length","classes","CLASSNAMES","STATUS","selected","SIZE","size","isCreatedOption","creatable","searchInput","show","canFilter","filterOptions","some","option","get","labelText","flag","labelInValue","map","item","methods","select","e","stopPropagation","parent","parentNode","className","createOption","toString","onOptionClick","mouseEvent","v","mounted","beforeDestroy","hasSlotOptions","destroyOptions","render","children","renderContent","optionChild","keepAnimation","bind","preventDefault"],"mappings":"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"}