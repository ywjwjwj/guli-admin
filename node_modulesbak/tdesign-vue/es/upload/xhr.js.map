{"version":3,"file":"xhr.js","sources":["../../src/upload/xhr.ts"],"sourcesContent":["import { XhrOptions } from './interface';\n\nexport default function xhr({\n  action,\n  withCredentials = false,\n  headers = {},\n  data = {},\n  file,\n  name = 'file',\n  onError,\n  onProgress,\n  onSuccess,\n}: XhrOptions) {\n  const xhr = new XMLHttpRequest();\n  if (withCredentials) {\n    xhr.withCredentials = true;\n  }\n\n  // set send data\n  const formData = new FormData();\n  const sendData = typeof data === 'function' ? data(file) : data;\n  Object.keys(sendData).forEach((key) => {\n    formData.append(key, data[key]);\n  });\n  formData.append(name, file.raw);\n\n  xhr.open('post', action, true);\n\n  // custom request headers\n  Object.keys(headers).forEach((key) => {\n    xhr.setRequestHeader(key, headers[key]);\n  });\n\n  xhr.onerror = (event: ProgressEvent) => onError({ event, file });\n\n  xhr.onprogress = function (event: ProgressEvent) {\n    let percent = 0;\n    if (event.total > 0) {\n      percent = Math.round((event.loaded / event.total) * 100);\n    }\n    onProgress({ event, percent, file });\n  };\n\n  xhr.onload = function (event: ProgressEvent) {\n    let response;\n    const isFail = xhr.status < 200 || xhr.status >= 300;\n    if (isFail) {\n      return onError({ event, file, response });\n    }\n    const text = xhr.responseText || xhr.response;\n    try {\n      response = JSON.parse(text);\n    } catch (e) {\n      response = text;\n    }\n    onSuccess({ event, file, response });\n  };\n\n  xhr.send(formData);\n\n  return xhr;\n}\n"],"names":["xhr","action","withCredentials","headers","data","file","name","onError","onProgress","onSuccess","xhr2","XMLHttpRequest","formData","FormData","sendData","Object","keys","forEach","key","append","raw","open","setRequestHeader","onerror","event","onprogress","percent","total","Math","round","loaded","onload","response","isFail","status","text","responseText","JSON","parse","e","send"],"mappings":"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"}