{"version":3,"file":"table-header.js","sources":["../../../src/table/base-table/table-header.tsx"],"sourcesContent":["import Vue, { VNode, CreateElement } from 'vue';\nimport TableCell from './table-cell';\nimport { BaseTableCol, CellData } from '../type';\nimport baseTableProps from '../base-table-props';\nimport { prefix } from '../../config';\n\ninterface Column extends BaseTableCol {\n  scopedSlots: any;\n}\n\ntype ThProps = {\n  rowspan: number;\n  colspan: number;\n  column: BaseTableCol;\n  index: number;\n  hasChildren: boolean;\n  isFirstColumn: boolean;\n};\n\nexport default Vue.extend({\n  name: `${prefix}-table-header`,\n  props: {\n    columns: baseTableProps.columns,\n    bordered: baseTableProps.bordered,\n  },\n\n  data() {\n    return {\n      cacheRowMaxRowspan: [],\n    };\n  },\n\n  methods: {\n    renderHeader(): Array<VNode> {\n      const { bordered, cacheRowMaxRowspan } = this;\n      const trPropsList: Array<Array<ThProps>> = [];\n      this.renderTr(this.columns, 0, trPropsList, true);\n      return trPropsList.map((thPropsList, rowindex) => {\n        const currentRowMaxRowspan = cacheRowMaxRowspan[rowindex] || 1;\n        return (\n          <tr>\n            {thPropsList.map(({\n              column, rowspan, colspan, index, hasChildren, isFirstColumn,\n            }) => {\n              const withBorder = bordered && index === 0 && !isFirstColumn;\n              return this.renderCell(column, hasChildren ? rowspan : currentRowMaxRowspan, colspan, index, withBorder);\n            })}\n          </tr>\n        );\n      });\n    },\n    renderTr(\n      columns: Array<BaseTableCol>,\n      currentRowIndex: number,\n      trPropsList: Array<any>,\n      isParentFirstColumn: boolean,\n    ): any {\n      const { cacheRowMaxRowspan } = this;\n      const currentRowThProps: Array<ThProps> = [];\n      // 当前行\n      if (typeof trPropsList[currentRowIndex] === 'undefined') {\n        // eslint-disable-next-line no-param-reassign\n        trPropsList[currentRowIndex] = [];\n      }\n      if (typeof cacheRowMaxRowspan[currentRowIndex] === 'undefined') {\n        cacheRowMaxRowspan[currentRowIndex] = 1;\n      }\n      // 占用的列\n      let colspan = 0;\n      // 占用的行\n      let rowspan = 1;\n      columns.forEach((column: BaseTableCol, index: number) => {\n        const { children } = column;\n        if (children?.length) {\n          const isFirstColumn = isParentFirstColumn && index === 0;\n          const { colspan: occupiedCol, rowspan: occupiedRow } = this.renderTr(\n            children,\n            currentRowIndex + 1,\n            trPropsList,\n            isFirstColumn,\n          );\n          colspan += occupiedCol;\n          rowspan += occupiedRow;\n          cacheRowMaxRowspan[currentRowIndex] = Math.max(rowspan, cacheRowMaxRowspan[currentRowIndex]);\n          currentRowThProps[index] = {\n            rowspan: 1,\n            colspan: occupiedCol,\n            column,\n            index,\n            hasChildren: true,\n            isFirstColumn: index === 0 && isParentFirstColumn,\n          };\n        }\n      });\n      // 普通单元格\n      columns.forEach((column, index: number) => {\n        const { children } = column;\n        if (!children || children?.length === 0) {\n          currentRowThProps[index] = {\n            rowspan,\n            colspan: 1,\n            column,\n            index,\n            hasChildren: false,\n            isFirstColumn: index === 0 && isParentFirstColumn,\n          };\n          colspan += 1;\n        }\n      });\n      trPropsList[currentRowIndex].push(...currentRowThProps);\n      return {\n        colspan,\n        rowspan,\n      };\n    },\n\n    renderCell(column: BaseTableCol, rowspan: number, colspan: number, index: number, withBorder?: boolean): VNode {\n      const { title, render, scopedSlots } = column as Column;\n      const scopedSlotsTitle = scopedSlots?.title;\n\n      const customData = {\n        type: 'title',\n        func: 'title',\n      };\n      let customRender;\n      if (typeof this.$scopedSlots[scopedSlotsTitle] === 'function') {\n        customRender = this.$scopedSlots[scopedSlotsTitle];\n        console.error('TDesign Table Warn: scopedSlots will be deprecated, please use `cell` and `title` instead.');\n      } else if (typeof title === 'string') {\n        if (typeof this.$scopedSlots[title] === 'function') {\n          customRender = (params: any) => this.$scopedSlots[title](params);\n        } else {\n          customRender = () => title;\n        }\n      } else if (typeof title === 'function') {\n        customRender = (h: CreateElement, params: CellData<any>) => title(h, {\n          colIndex: params.colIndex,\n          col: params.col,\n        });\n      } else if (typeof render === 'function') {\n        customRender = render;\n        customData.func = 'render';\n      } else {\n        customRender = () => '';\n      }\n\n      const cellData = {\n        col: column,\n        colIndex: index,\n        customData,\n        customRender,\n        type: 'th',\n        withBorder,\n      };\n      return <TableCell cellData={cellData} colspan={colspan} rowspan={rowspan} />;\n    },\n  },\n  render() {\n    return <thead>{this.renderHeader()}</thead>;\n  },\n});\n"],"names":["Vue","extend","name","prefix","props","columns","baseTableProps","bordered","data","cacheRowMaxRowspan","methods","renderHeader","trPropsList","renderTr","map","thPropsList","rowindex","currentRowMaxRowspan","column","rowspan","colspan","index","hasChildren","isFirstColumn","withBorder","renderCell","currentRowIndex","isParentFirstColumn","currentRowThProps","forEach","children","length","occupiedCol","occupiedRow","Math","max","push","title","render","scopedSlots","scopedSlotsTitle","customData","type","func","customRender","$scopedSlots","console","error","params","h","colIndex","col","cellData"],"mappings":"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"}