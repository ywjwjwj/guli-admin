{"version":3,"file":"useMultiple.js","sources":["../../src/select-input/useMultiple.tsx"],"sourcesContent":["import {\n  SetupContext, computed, ref, toRefs, getCurrentInstance,\n} from '@vue/composition-api';\nimport isObject from 'lodash/isObject';\nimport Vue from 'vue';\nimport { TdSelectInputProps, SelectInputChangeContext, SelectInputKeys } from './type';\nimport { SelectInputCommonProperties } from './interface';\nimport { InputValue } from '../input';\nimport TagInput, { TagInputValue, InputValueChangeContext } from '../tag-input';\nimport Loading from '../loading';\nimport useDefaultValue from '../hooks/useDefaultValue';\nimport { usePrefixClass } from '../config-provider';\n\nexport interface RenderSelectMultipleParams {\n  commonInputProps: SelectInputCommonProperties;\n  onInnerClear: (context: { e: MouseEvent }) => void;\n  popupVisible: boolean;\n}\n\nconst DEFAULT_KEYS = {\n  label: 'label',\n  key: 'key',\n  children: 'children',\n};\n\nexport default function useMultiple(props: TdSelectInputProps, context: SetupContext) {\n  const { inputValue } = toRefs(props);\n  const classPrefix = usePrefixClass();\n  const instance = getCurrentInstance();\n  const tagInputRef = ref();\n  const [tInputValue, setTInputValue] = useDefaultValue(\n    inputValue,\n    props.defaultInputValue,\n    props.onInputChange,\n    'inputValue',\n    'input-change',\n  );\n  const iKeys = computed<SelectInputKeys>(() => ({ ...DEFAULT_KEYS, ...props.keys }));\n  const tags = computed<TagInputValue>(() => {\n    if (!(props.value instanceof Array)) {\n      return isObject(props.value) ? [props.value[iKeys.value.label]] : [props.value];\n    }\n    return props.value.map((item) => (isObject(item) ? item[iKeys.value.label] : item));\n  });\n\n  const tPlaceholder = computed<string>(() => (!tags.value || !tags.value.length ? props.placeholder : ''));\n\n  const onTagInputChange = (val: TagInputValue, context: SelectInputChangeContext) => {\n    // 避免触发浮层的显示或隐藏\n    if (context.trigger === 'tag-remove') {\n      context.e?.stopPropagation();\n    }\n    props.onTagChange?.(val, context);\n    instance.emit('tag-change', val, context);\n  };\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const renderSelectMultiple = (p: RenderSelectMultipleParams, h: Vue.CreateElement) => {\n    const tagInputProps = {\n      ...props.tagInputProps,\n      ...p.commonInputProps,\n      tagProps: props.tagProps,\n      readonly: !props.allowInput,\n      label: props.label,\n      autoWidth: props.autoWidth,\n      placeholder: tPlaceholder.value,\n      minCollapsedNum: props.minCollapsedNum,\n      collapsedItems: props.collapsedItems,\n      tag: props.tag,\n      valueDisplay: props.valueDisplay,\n      value: tags.value,\n      inputValue: tInputValue.value || '',\n      inputProps: {\n        readonly: !props.allowInput || props.readonly,\n        inputClass: {\n          [`${classPrefix.value}-input--focused`]: p.popupVisible,\n        },\n      },\n      suffixIcon: !props.disabled && props.loading ? () => <Loading loading size=\"small\" /> : props.suffixIcon,\n    };\n\n    return (\n      <TagInput\n        ref=\"tagInputRef\"\n        scopedSlots={context.slots}\n        props={tagInputProps}\n        on={{\n          'input-change': (val: InputValue, context: InputValueChangeContext) => {\n            // 筛选器统一特性：筛选器按下回车时不清空输入框\n            if (context?.trigger === 'enter') return;\n            setTInputValue(val, { trigger: context.trigger, e: context.e });\n          },\n        }}\n        onChange={onTagInputChange}\n        onClear={(context: { e: MouseEvent }) => {\n          context.e.stopPropagation();\n          p.onInnerClear;\n        }}\n        onBlur={(val: TagInputValue, context: { inputValue: InputValue; e: FocusEvent }) => {\n          // 筛选器统一特性：失去焦点时，清空输入内容\n          setTInputValue('', { ...context, trigger: 'blur' });\n          instance.emit('blur', props.value, { ...context, tagInputValue: val });\n        }}\n        onFocus={(val: TagInputValue, context: { inputValue: InputValue; e: FocusEvent }) => {\n          props.onFocus?.(props.value, { ...context, tagInputValue: val });\n          instance.emit('focus', props.value, { ...context, tagInputValue: val });\n        }}\n      />\n    );\n  };\n\n  return {\n    tags,\n    tPlaceholder,\n    tagInputRef,\n    renderSelectMultiple,\n  };\n}\n"],"names":["DEFAULT_KEYS","label","key","children","useMultiple","props","context","toRefs","inputValue","classPrefix","usePrefixClass","instance","getCurrentInstance","tagInputRef","ref","useDefaultValue","defaultInputValue","onInputChange","tInputValue","setTInputValue","iKeys","computed","keys","tags","value","Array","isObject","map","item","tPlaceholder","length","placeholder","onTagInputChange","val","context2","trigger","e","stopPropagation","onTagChange","emit","renderSelectMultiple","p","h","tagInputProps","commonInputProps","tagProps","readonly","allowInput","autoWidth","minCollapsedNum","collapsedItems","tag","valueDisplay","inputProps","inputClass","popupVisible","suffixIcon","disabled","loading","_mergeJSXProps","slots","onInnerClear","tagInputValue","onFocus"],"mappings":"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"}