{"version":3,"file":"plugin.js","sources":["../../src/message/plugin.tsx"],"sourcesContent":["/**\n * Vue.prototype.$message = MessagePlugin;\n *\n * this.$message({ theme: 'info', default: '这是信息', duration: 3000 })\n * this.$message.info('这是信息')\n * this.$message.info('这是信息', 3000)\n * this.$message.info({ content: '这是信息', duration: 3000 })\n * this.$message.success({ content: '这是信息', duration: 3000 })\n * this.$message.warning()\n * this.$message.error()\n * this.$message.question()\n * this.$message.loading()\n * 上述函数返回值：promise: Promise<{close: Function}>\n *\n * // close all message\n * this.$message.closeAll()\n *\n * // close one message. 参数 p 为 this.$message 系列函数返回值，promise: Promise<{close: Function}>\n * this.$message.close(p)\n *\n * // close one message.\n * const msg = this.$message.info({ content: '这是信息', duration: 0 })\n * msg.then(instance => instance.close())\n *\n */\n\nimport Vue from 'vue';\nimport MessageList, { DEFAULT_Z_INDEX } from './messageList';\nimport { getAttach } from '../utils/dom';\nimport {\n  MessageOptions,\n  MessageMethod,\n  MessageInstance,\n  MessageInfoMethod,\n  MessageErrorMethod,\n  MessageWarningMethod,\n  MessageSuccessMethod,\n  MessageLoadingMethod,\n  MessageQuestionMethod,\n  MessageCloseMethod,\n  MessageCloseAllMethod,\n} from './type';\nimport { AttachNodeReturnValue } from '../common';\n\n// 存储不同 attach 和 不同 placement 消息列表实例\nconst instanceMap: Map<AttachNodeReturnValue, object> = new Map();\n\nfunction handleParams(params: MessageOptions): MessageOptions {\n  const options: MessageOptions = {\n    duration: 3000,\n    attach: 'body',\n    zIndex: DEFAULT_Z_INDEX,\n    placement: 'top',\n    ...params,\n  };\n  options.content = params.content;\n  return options;\n}\n\nconst MessageFunction = (props: MessageOptions): Promise<MessageInstance> => {\n  const options = handleParams(props);\n  const { attach, placement } = options;\n  const attachDom = getAttach(attach);\n  if (!instanceMap.get(attachDom)) {\n    instanceMap.set(attachDom, {});\n  }\n  const p = instanceMap.get(attachDom)[placement];\n  if (!p) {\n    const instance = new MessageList({\n      propsData: {\n        zIndex: options.zIndex,\n        placement: options.placement,\n      },\n    }).$mount();\n    instance.add(options);\n    instanceMap.get(attachDom)[placement] = instance;\n    attachDom.appendChild(instance.$el);\n  } else {\n    p.add(options);\n  }\n  // 返回最新消息的 Element\n  return new Promise((resolve) => {\n    const ins = instanceMap.get(attachDom)[placement];\n    ins.$nextTick(() => {\n      const msg: Array<MessageInstance> = ins.$children;\n      resolve(msg[msg.length - 1]);\n    });\n  });\n};\n\nconst showThemeMessage: MessageMethod = (theme, params, duration) => {\n  let options: MessageOptions = { theme };\n  if (typeof params === 'string') {\n    options.content = params;\n  } else if (typeof params === 'object' && !(params instanceof Array)) {\n    options = { ...options, ...params };\n  }\n  (duration || duration === 0) && (options.duration = duration);\n  return MessageFunction(options);\n};\n\ninterface ExtraApi {\n  info: MessageInfoMethod;\n  success: MessageSuccessMethod;\n  warning: MessageWarningMethod;\n  error: MessageErrorMethod;\n  question: MessageQuestionMethod;\n  loading: MessageLoadingMethod;\n  close: MessageCloseMethod;\n  closeAll: MessageCloseAllMethod;\n}\n\nconst extraApi: ExtraApi = {\n  info: (params, duration) => showThemeMessage('info', params, duration),\n  success: (params, duration) => showThemeMessage('success', params, duration),\n  warning: (params, duration) => showThemeMessage('warning', params, duration),\n  error: (params, duration) => showThemeMessage('error', params, duration),\n  question: (params, duration) => showThemeMessage('question', params, duration),\n  loading: (params, duration) => showThemeMessage('loading', params, duration),\n  close: (promise) => {\n    promise.then((instance) => instance.close());\n  },\n  closeAll: () => {\n    if (instanceMap instanceof Map) {\n      instanceMap.forEach((attach) => {\n        Object.keys(attach).forEach((placement) => {\n          const instance = attach[placement];\n          instance.list = [];\n        });\n      });\n    }\n  },\n};\n\nexport type MessagePluginType = Vue.PluginObject<undefined> & ExtraApi & MessageMethod;\n\nexport const MessagePlugin: MessagePluginType = showThemeMessage as MessagePluginType;\n\n// 这样定义后，可以通过 MessagePlugin('success', '消息') 或者 MessagePlugin.success('消息')调用插件\nObject.keys(extraApi).forEach((funcName) => {\n  MessagePlugin[funcName] = extraApi[funcName];\n});\n\nMessagePlugin.install = () => {\n  // 这样定义后，可以通过 this.$message 调用插件\n  Vue.prototype.$message = MessagePlugin;\n};\n\nexport default MessagePlugin;\n\ndeclare module 'vue/types/vue' {\n  // Bind to `this` keyword\n  interface Vue {\n    $message: MessageMethod & ExtraApi;\n  }\n}\n"],"names":["instanceMap","Map","handleParams","params","options","duration","attach","zIndex","DEFAULT_Z_INDEX","placement","content","MessageFunction","props","attachDom","getAttach","get","set","p","instance","MessageList","propsData","$mount","add","appendChild","$el","Promise","resolve","ins","$nextTick","msg","$children","length","showThemeMessage","theme","Array","extraApi","info","success","warning","error","question","loading","close","promise","then","closeAll","forEach","Object","keys","list","MessagePlugin","funcName","install","Vue","prototype","$message"],"mappings":"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"}