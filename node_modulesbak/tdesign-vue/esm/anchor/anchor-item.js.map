{"version":3,"file":"anchor-item.js","sources":["../../src/anchor/anchor-item.tsx"],"sourcesContent":["import Vue, { VueConstructor } from 'vue';\nimport { ScopedSlotReturnValue } from 'vue/types/vnode';\nimport CLASSNAMES from '../utils/classnames';\nimport { ANCHOR_SHARP_REGEXP } from './utils';\nimport props from './anchor-item-props';\nimport { COMPONENT_NAME } from './constant';\n\nconst CLASSNAME_PREFIX = `${COMPONENT_NAME}__item`;\nexport interface Anchor extends Vue {\n  tAnchor: {\n    active: string;\n    handleScrollTo(target: string): void;\n    registerLink(href: string): void;\n    unregisterLink(href: string): void;\n    handleLinkClick(link: { href: string; title: string; e: MouseEvent}): void;\n  };\n}\n\nexport default (Vue as VueConstructor<Anchor>).extend({\n  name: 'TAnchorItem',\n\n  props: {\n    ...props,\n    href: {\n      type: String,\n      required: true,\n      validator(v: string): boolean {\n        return ANCHOR_SHARP_REGEXP.test(v);\n      },\n    },\n  },\n\n  inject: {\n    tAnchor: { default: undefined },\n  },\n\n  watch: {\n    href: {\n      immediate: true,\n      handler() {\n        this.unregister();\n        this.register();\n      },\n    },\n  },\n  destroyed() {\n    this.unregister();\n  },\n  methods: {\n    register(): void {\n      this.tAnchor.registerLink(this.href);\n    },\n    unregister(): void {\n      const { href } = this;\n      if (!href) return;\n      this.tAnchor.unregisterLink(href);\n    },\n    handleClick(e: MouseEvent): void {\n      const { href, tAnchor, title } = this;\n      tAnchor.handleScrollTo(href);\n      tAnchor.handleLinkClick({\n        href,\n        title: typeof title === 'string' ? title : undefined,\n        e,\n      });\n    },\n    /**\n     * 更加props和slot渲染title\n     *\n     * @returns\n     */\n    renderTitle() {\n      const { title, $scopedSlots } = this;\n      const { title: titleSlot } = $scopedSlots;\n      let titleVal: ScopedSlotReturnValue;\n      if (typeof title === 'string') {\n        titleVal = title;\n      } else if (typeof title === 'function') {\n        titleVal = title(this.$createElement);\n      } else if (titleSlot) {\n        titleVal = titleSlot(null);\n      }\n      return titleVal;\n    },\n  },\n  render() {\n    const {\n      href, target, $scopedSlots, tAnchor,\n    } = this;\n    const { default: children, title: titleSlot } = $scopedSlots;\n    const title = this.renderTitle();\n    const titleAttr = typeof title === 'string' ? title : null;\n    const isActive = tAnchor.active === href;\n    const wrapperClass = {\n      [CLASSNAME_PREFIX]: true,\n      [CLASSNAMES.STATUS.active]: isActive,\n    };\n    const titleClass = {\n      [`${CLASSNAME_PREFIX}-link`]: true,\n    };\n    return (\n      <div class={wrapperClass}>\n        <a href={href} title={titleAttr} class={titleClass} target={target} onClick={this.handleClick}>\n          {titleSlot ? titleSlot(null) : title}\n        </a>\n        {children && children(null)}\n      </div>\n    );\n  },\n});\n"],"names":["CLASSNAME_PREFIX","COMPONENT_NAME","Vue","extend","name","props","href","type","String","required","validator","v","ANCHOR_SHARP_REGEXP","test","inject","tAnchor","watch","immediate","handler","unregister","register","destroyed","methods","registerLink","unregisterLink","handleClick","e","title","handleScrollTo","handleLinkClick","renderTitle","$scopedSlots","titleSlot","titleVal","$createElement","render","target","children","titleAttr","isActive","active","wrapperClass","CLASSNAMES","STATUS","titleClass"],"mappings":"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"}