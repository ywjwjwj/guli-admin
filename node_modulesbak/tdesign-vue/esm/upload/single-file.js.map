{"version":3,"file":"single-file.js","sources":["../../src/upload/single-file.tsx"],"sourcesContent":["import Vue, { PropType } from 'vue';\nimport { CloseCircleFilledIcon, ErrorCircleFilledIcon, CheckCircleFilledIcon } from 'tdesign-icons-vue';\nimport Loading from '../loading';\nimport { prefix } from '../config';\nimport { UploadFile } from './type';\nimport { ClassName } from '../common';\nimport { abridgeName, UPLOAD_NAME } from './util';\nimport props from './props';\n\nexport default Vue.extend({\n  name: 'TUploadSingleFile',\n\n  components: {\n    CloseCircleFilledIcon,\n    ErrorCircleFilledIcon,\n    CheckCircleFilledIcon,\n    Loading,\n  },\n\n  data() {\n    return {};\n  },\n\n  props: {\n    showUploadProgress: props.showUploadProgress,\n    file: Object as PropType<UploadFile>,\n    loadingFile: Object as PropType<UploadFile>,\n    remove: Function as PropType<(e: MouseEvent) => void>,\n    placeholder: String,\n    display: {\n      type: String as PropType<'file' | 'file-input'>,\n      validator(val: string) {\n        return ['file', 'file-input'].includes(val);\n      },\n    },\n  },\n\n  computed: {\n    percent(): number {\n      return this.loadingFile && this.loadingFile.percent;\n    },\n    showPreview(): boolean {\n      return Boolean(this.file && this.file.name);\n    },\n    showTextPreview(): boolean {\n      return this.display === 'file';\n    },\n    showInput(): boolean {\n      return this.display === 'file-input';\n    },\n    showProgress(): boolean {\n      return !!(this.loadingFile && this.loadingFile.status === 'progress');\n    },\n    showDelete(): boolean {\n      return this.file && this.file.name && !this.loadingFile;\n    },\n    inputName(): string {\n      const fileName = this.file && this.file.name;\n      const loadingName = this.loadingFile && this.loadingFile.name;\n      return this.showProgress ? loadingName : fileName;\n    },\n    inputText(): string {\n      return this.inputName || this.placeholder;\n    },\n    inputTextClass(): ClassName {\n      return [`${prefix}-input__inner`, { [`${UPLOAD_NAME}__placeholder`]: !this.inputName }];\n    },\n    classes(): ClassName {\n      return [`${UPLOAD_NAME}__single`, `${UPLOAD_NAME}__single-${this.display}`];\n    },\n  },\n\n  methods: {\n    renderProgress() {\n      if (this.loadingFile.status === 'fail') {\n        return <ErrorCircleFilledIcon />;\n      }\n      if (this.showUploadProgress) {\n        return (\n          <div class={`${UPLOAD_NAME}__single-progress`}>\n            <Loading />\n            <span class={`${UPLOAD_NAME}__single-percent`}>{Math.min(this.loadingFile.percent, 99)}%</span>\n          </div>\n        );\n      }\n    },\n\n    renderResult() {\n      if (!!this.loadingFile && this.loadingFile.status === 'fail') {\n        return <ErrorCircleFilledIcon />;\n      }\n      if (this.file && this.file.name && !this.loadingFile) {\n        return <CheckCircleFilledIcon />;\n      }\n      return '';\n    },\n\n    // 文本型预览\n    renderFilePreviewAsText() {\n      if (!this.inputName) return;\n      return (\n        <div class={`${UPLOAD_NAME}__single-display-text t-upload__display-text--margin`}>\n          <span class={`${UPLOAD_NAME}__single-name`}>{this.inputName}</span>\n          {this.showProgress ? (\n            this.renderProgress()\n          ) : (\n            <CloseCircleFilledIcon\n              class={`${UPLOAD_NAME}__icon-delete`}\n              nativeOnClick={(e: MouseEvent) => this.remove(e)}\n            />\n          )}\n        </div>\n      );\n    },\n    // 输入框型预览\n    renderFilePreviewAsInput() {\n      return (\n        <div class={`${UPLOAD_NAME}__single-input-preview ${prefix}-input`}>\n          <div class={this.inputTextClass}>\n            {<span class={`${UPLOAD_NAME}__single-input-text`}>{abridgeName(this.inputText, 4, 6)}</span>}\n            {this.showProgress && this.renderProgress()}\n            {this.renderResult()}\n          </div>\n        </div>\n      );\n    },\n  },\n\n  render() {\n    return (\n      <div class={this.classes}>\n        {this.showInput && this.renderFilePreviewAsInput()}\n        {this.$scopedSlots.default && this.$scopedSlots.default(null)}\n        {this.showTextPreview && this.renderFilePreviewAsText()}\n        {this.showInput && this.showDelete && (\n          <span class={`${UPLOAD_NAME}__single-input-delete`} onClick={(e: MouseEvent) => this.remove(e)}>\n            删除\n          </span>\n        )}\n      </div>\n    );\n  },\n});\n"],"names":["Vue","extend","name","components","CloseCircleFilledIcon","ErrorCircleFilledIcon","CheckCircleFilledIcon","Loading","data","props","showUploadProgress","file","Object","loadingFile","remove","Function","placeholder","String","display","type","validator","val","includes","computed","percent","showPreview","Boolean","showTextPreview","showInput","showProgress","status","showDelete","inputName","fileName","loadingName","inputText","inputTextClass","prefix","UPLOAD_NAME","classes","methods","renderProgress","Math","min","renderResult","renderFilePreviewAsText","e","renderFilePreviewAsInput","abridgeName","render","$scopedSlots"],"mappings":"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"}