{"version":3,"file":"index.js","sources":["../../../src/time-picker/panel/index.tsx"],"sourcesContent":["import dayjs from 'dayjs';\nimport customParseFormat from 'dayjs/plugin/customParseFormat';\n\nimport mixins from '../../utils/mixins';\nimport getConfigReceiverMixins, { TimePickerConfig } from '../../config-provider/config-receiver';\nimport { TimePickerPanelInstance, TimePickerPanelColInstance, EPickerCols } from '../interface';\nimport { componentName } from '../constant';\nimport { panelProps } from './props';\nimport PanelCol from './panel-col';\nimport TButton from '../../button/button';\n\nconst name = `${componentName}__panel`;\n\ndayjs.extend(customParseFormat);\n\nexport default mixins(getConfigReceiverMixins<TimePickerPanelInstance, TimePickerConfig>('timePicker')).extend({\n  name,\n  data() {\n    return {\n      panel: null,\n      isSetup: false,\n    };\n  },\n  components: {\n    PanelCol,\n    TButton,\n  },\n\n  props: panelProps(),\n  computed: {\n    sectionComponentName() {\n      return `${name}-section`;\n    },\n    classNames() {\n      return this.rangePicker ? [name, this.sectionComponentName] : [name];\n    },\n    colValues() {\n      return this.value.map((el) => el || dayjs());\n    },\n    rangePicker() {\n      return this.colValues.length > 1;\n    },\n    formatField() {\n      const match = this.format.match(/(a\\s+|A\\s+)?(h+|H+)?:?(m+)?:?(s+)?(\\s+a|\\s+A)?/);\n      const [, startAChart, hour, minute, second, endAChart] = match;\n      return {\n        startAChart,\n        hour,\n        minute,\n        second,\n        endAChart,\n      };\n    },\n    cols() {\n      const {\n        startAChart, hour, minute, second, endAChart,\n      } = this.formatField;\n      const res = [];\n      startAChart && res.push(EPickerCols.meridiem);\n      hour && res.push(EPickerCols.hour);\n      minute && res.push(EPickerCols.minute);\n      second && res.push(EPickerCols.second);\n      endAChart && res.push(EPickerCols.meridiem);\n      return res;\n    },\n    localeMeridiems() {\n      return [this.global.anteMeridiem, this.global.postMeridiem];\n    },\n    showNowTime() {\n      // 是否展示此刻按钮\n      return !this.rangePicker && this.steps.filter((step) => step !== 1).length < 1;\n    },\n  },\n  watch: {\n    isShowPanel(val: boolean) {\n      if (val) {\n        this.panelColUpdate();\n      }\n    },\n  },\n  mounted() {\n    // 不做 isShowPanel 的判断，故无法合并到 watch\n    this.panelColUpdate();\n  },\n  methods: {\n    panelColUpdate() {\n      setTimeout(() => {\n        (this.$refs.panelCol_0 as TimePickerPanelColInstance)?.updateTimeScrollPos();\n        (this.$refs.panelCol_1 as TimePickerPanelColInstance)?.updateTimeScrollPos();\n      });\n    },\n    scrollToTime(colIndex: number, col: EPickerCols, time: number | string, behavior: ScrollBehavior) {\n      const scroller = this.$refs[`panelCol_${colIndex}`] as TimePickerPanelColInstance;\n      scroller && scroller.scrollToTime(col, time, behavior);\n    },\n    renderFooter() {\n      const confirmAction = this.confirmBtnClick.bind(this);\n      return (\n        <div class={`${this.sectionComponentName}-footer`}>\n          {/* 样式设置为row-reverse 这样不用特地为确定写个绝对布局 */}\n          <t-button theme=\"primary\" variant=\"base\" onClick={confirmAction}>\n            {this.t(this.global.confirm)}\n          </t-button>\n          {this.showNowTime && (\n            <t-button theme=\"primary\" variant=\"text\" onClick={this.nowAction}>\n              {this.t(this.global.now)}\n            </t-button>\n          )}\n        </div>\n      );\n    },\n\n    renderBody() {\n      return (\n        <div class={`${this.sectionComponentName}-body`}>\n          {this.renderSinglePicker(0)}\n          {this.rangePicker && this.renderSinglePicker(1)}\n        </div>\n      );\n    },\n    renderSinglePicker(index: number) {\n      const val = this.colValues[index];\n      const ref = `panelCol_${index}`;\n      return (\n        <panel-col\n          ref={ref}\n          value={val}\n          cols={this.cols}\n          steps={this.steps}\n          hideDisabledTime={this.hideDisabledTime}\n          disableTime={this.disableTime}\n          format={this.format}\n          ontime-pick={(col: EPickerCols, time: string | number) => this.handleTimePick(col, time, index)}\n          localeMeridiems={this.localeMeridiems}\n        />\n      );\n    },\n    confirmBtnClick(e: MouseEvent) {\n      this.$emit('sure', e);\n    },\n    nowAction() {\n      this.$emit('now-action');\n      this.panelColUpdate();\n    },\n    /**\n     * 时间 item 点击选择处理函数\n     * @param col 选择的哪一列 上午/下午 hour minute second am/pm\n     * @param time 选择的时间 如果col是：上午/下午或者am/pm 则time是 string，如果是hour或minute或second则time是 number\n     * @param index\n     */\n    handleTimePick(col: EPickerCols, time: string | number, index: number) {\n      this.$emit('time-pick', col, time, index, this.colValues[index]);\n    },\n  },\n  render() {\n    const { isFooterDisplay, classNames } = this;\n    return (\n      <div class={classNames}>\n        {this.renderBody()}\n        {isFooterDisplay ? this.renderFooter() : null}\n      </div>\n    );\n  },\n});\n"],"names":["name","componentName","dayjs","extend","customParseFormat","mixins","getConfigReceiverMixins","data","panel","isSetup","components","PanelCol","TButton","props","panelProps","computed","sectionComponentName","classNames","rangePicker","colValues","value","map","el","length","formatField","match","format","startAChart","hour","minute","second","endAChart","cols","res","push","EPickerCols","meridiem","localeMeridiems","global","anteMeridiem","postMeridiem","showNowTime","steps","filter","step","watch","isShowPanel","val","panelColUpdate","mounted","methods","setTimeout","$refs","panelCol_0","updateTimeScrollPos","panelCol_1","scrollToTime","colIndex","col","time","behavior","scroller","renderFooter","confirmAction","confirmBtnClick","bind","t","confirm","nowAction","now","renderBody","renderSinglePicker","index","ref","hideDisabledTime","disableTime","handleTimePick","e","$emit","render","isFooterDisplay"],"mappings":"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"}