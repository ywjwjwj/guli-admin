{"version":3,"file":"select.js","sources":["../../../../src/table/primary-table/mixins/select.tsx"],"sourcesContent":["import Vue, { VNode } from 'vue';\nimport get from 'lodash/get';\nimport { PrimaryTableCol, TdPrimaryTableProps } from '../../type';\nimport primaryTableProps from '../../primary-table-props';\nimport baseTableProps from '../../base-table-props';\nimport { prefix } from '../../../config';\nimport { filterDataByIds, isRowSelectedDisabled } from '../../util/common';\nimport SelectBox from '../select-box';\nimport { emitEvent } from '../../../utils/event';\n\ntype SelectChangeParams = Parameters<TdPrimaryTableProps['onSelectChange']>;\n\nexport default Vue.extend({\n  name: `${prefix}-primary-table-select`,\n  props: {\n    columns: primaryTableProps.columns,\n    data: baseTableProps.data,\n    rowKey: baseTableProps.rowKey,\n    selectedRowKeys: primaryTableProps.selectedRowKeys,\n  },\n  computed: {\n    reRowKey(): string {\n      return this.rowKey || 'id';\n    },\n    selectColumn(): any {\n      return this.columns.find(({ type }) => ['multiple', 'single'].includes(type)) || {};\n    },\n    canSelectedRows(): Array<Record<string, any>> {\n      return this.data.filter((row, rowIndex): boolean => !this.isDisabled(row, rowIndex));\n    },\n    isSelectedAll(): boolean {\n      return !!(\n        this.canSelectedRows.length\n        && this.canSelectedRows.every((record) => this.selectedRowKeys.includes(get(record, this.reRowKey)))\n      );\n    },\n    // 判断 indeterminate\n    isSelectedSome(): boolean {\n      return (\n        !this.isSelectedAll\n        && this.canSelectedRows.some((record) => this.selectedRowKeys.includes(get(record, this.reRowKey)))\n      );\n    },\n  },\n  methods: {\n    isDisabled(row: Record<string, any>, rowIndex: number): boolean {\n      return isRowSelectedDisabled(this.selectColumn, row, rowIndex);\n    },\n    // get\n    getSelectColumns(columns: Array<PrimaryTableCol>): Array<PrimaryTableCol> {\n      return columns.map((c: PrimaryTableCol): PrimaryTableCol => {\n        const isSelection = ['multiple', 'single'].includes(c.type);\n        const isMultiple = c.type === 'multiple';\n        const title = isMultiple ? this.getSelectedHeader() : '';\n        return {\n          ...c,\n          ...(isSelection\n            ? {\n              render: (h, slotProps: Record<string, any>): VNode => this.renderSelectCell({\n                column: c,\n                ...slotProps,\n              }),\n            }\n            : {}),\n          ...(isSelection ? { title } : {}),\n        };\n      });\n    },\n    getSelectedHeader() {\n      return () => (\n        <SelectBox\n          checked={this.isSelectedAll}\n          indeterminate={this.isSelectedSome}\n          disabled={!this.canSelectedRows.length}\n          {...{ on: { change: this.handleSelectAll } }}\n        />\n      );\n    },\n\n    // render\n    renderSelectCell({ column = {}, row = {}, rowIndex }: Record<string, any>): VNode {\n      const selectBoxProps = {\n        props: {\n          checked: this.selectedRowKeys.includes(get(row, this.reRowKey)),\n          ...column,\n          type: column.type,\n          checkProps:\n            typeof column.checkProps === 'function' ? column.checkProps({ row, rowIndex }) : column.checkProps,\n          disabled: typeof column.disabled === 'function' ? column.disabled({ row, rowIndex }) : column.disabled,\n          rowIndex,\n        },\n        on: {\n          click: (e: MouseEvent) => {\n            // 选中行功能中，点击 checkbo/radio 需阻止事件冒泡，避免触发不必要的 onRowClick\n            e?.stopPropagation();\n          },\n          // radio 单选框可再点击一次关闭选择，input / change 事件无法监听\n          change: (): void => this.handleSelectChange(row),\n        },\n      };\n      return <SelectBox {...selectBoxProps} />;\n    },\n\n    // handle：\n    handleSelectChange(record: Record<string, any> = {}): void {\n      let selectedRowKeys = [...this.selectedRowKeys] as Array<string | number>;\n      const { reRowKey } = this;\n      const id = get(record, reRowKey);\n      const selectedRowIndex = selectedRowKeys.indexOf(id);\n      const isSelected = selectedRowIndex !== -1;\n      if (this.selectColumn.type === 'multiple') {\n        isSelected\n          ? selectedRowKeys.splice(selectedRowIndex, 1) // 删除\n          : selectedRowKeys.push(id); // 增加\n      }\n      if (this.selectColumn.type === 'single') {\n        selectedRowKeys = !isSelected ? [id] : [];\n      }\n      emitEvent(this, 'select-change', selectedRowKeys, {\n        selectedRowData: filterDataByIds(this.data, selectedRowKeys, reRowKey),\n        currentRowKey: id,\n        currentRowData: record,\n        type: isSelected ? 'uncheck' : 'check',\n      });\n    },\n    handleSelectAll(): void {\n      const { selectedRowKeys, canSelectedRows, reRowKey } = this;\n      const canSelectedRowKeys = canSelectedRows.map((record) => get(record, reRowKey));\n      const disabledSelectedRowKeys = selectedRowKeys.filter((id) => !canSelectedRowKeys.includes(id));\n      const allIds = this.isSelectedAll\n        ? [...disabledSelectedRowKeys]\n        : [...disabledSelectedRowKeys, ...canSelectedRowKeys];\n      emitEvent<SelectChangeParams>(this, 'select-change', allIds, {\n        selectedRowData: filterDataByIds(this.data, allIds, reRowKey),\n        type: this.isSelectedAll ? 'uncheck' : 'check',\n        currentRowKey: 'CHECK_ALL_BOX',\n      });\n    },\n  },\n});\n"],"names":["Vue","extend","name","prefix","props","columns","primaryTableProps","data","baseTableProps","rowKey","selectedRowKeys","computed","reRowKey","selectColumn","find","type","includes","canSelectedRows","filter","row","rowIndex","isDisabled","isSelectedAll","length","every","record","get","isSelectedSome","some","methods","isRowSelectedDisabled","getSelectColumns","map","c","isSelection","isMultiple","title","getSelectedHeader","render","h","slotProps","renderSelectCell","column","change","handleSelectAll","selectBoxProps","checked","checkProps","disabled","on","click","e","stopPropagation","handleSelectChange","_mergeJSXProps","id","selectedRowIndex","indexOf","isSelected","splice","push","emitEvent","selectedRowData","filterDataByIds","currentRowKey","currentRowData","canSelectedRowKeys","disabledSelectedRowKeys","allIds"],"mappings":"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"}