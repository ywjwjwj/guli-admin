{"version":3,"file":"menu.js","sources":["../../src/menu/menu.tsx"],"sourcesContent":["import {\n  defineComponent, ref, computed, watchEffect, provide, watch, onMounted,\n} from '@vue/composition-api';\nimport { prefix } from '../config';\nimport props from './props';\nimport { MenuValue } from './type';\nimport { TdMenuInterface, TdOpenType } from './const';\nimport { renderContent, renderTNodeJSX } from '../utils/render-tnode';\nimport VMenu from './v-menu';\n\nexport default defineComponent({\n  name: 'TMenu',\n  props: { ...props },\n  model: {\n    prop: 'value',\n    event: 'change',\n  },\n  setup(props, ctx) {\n    const mode = ref(props.expandType);\n    const theme = computed(() => props.theme);\n    const isMutex = computed(() => props.expandMutex);\n    const menuClass = computed(() => [\n      `${prefix}-default-menu`,\n      `${prefix}-menu--${props.theme}`,\n      {\n        [`${prefix}-is-collapsed`]: props.collapsed,\n      },\n    ]);\n    const innerClasses = computed(() => [\n      `${prefix}-menu`,\n      { [`${prefix}-menu--scroll`]: mode.value !== 'popup' },\n      'narrow-scrollbar',\n    ]);\n    const styles = computed(() => {\n      const { width } = props;\n      const expandWidth = typeof width === 'number' ? `${width}px` : width;\n      return {\n        height: '100%',\n        width: props.collapsed ? '64px' : expandWidth,\n      };\n    });\n    const activeValue = ref(props.defaultValue || props.value);\n    const activeValues = ref([]);\n    const expandValues = ref(props.expanded || []);\n    const deliver = (evt: string) => {\n      const func = `on${evt[0].toUpperCase() + evt.slice(1)}`;\n      return (val: any) => {\n        if (typeof props[func] === 'function') {\n          props[func](val);\n        }\n        ctx.emit(evt, val);\n      };\n    };\n    const emitChange = deliver('change');\n    const emitExpand = deliver('expand');\n\n    watchEffect(() => {\n      mode.value = props.collapsed ? 'popup' : props.expandType;\n    });\n\n    const vMenu = new VMenu({ isMutex: isMutex.value, expandValues: expandValues.value });\n    provide<TdMenuInterface>('TdMenu', {\n      activeValue,\n      activeValues,\n      expandValues,\n      mode,\n      theme,\n      isHead: false,\n      vMenu,\n      select: (value: MenuValue) => {\n        emitChange(value);\n      },\n      open: (value: MenuValue, type: TdOpenType) => {\n        let expanded = [...expandValues.value];\n\n        if (mode.value === 'normal') {\n          expanded = vMenu.expand(value);\n        } else {\n          const index = expanded.indexOf(value);\n\n          if (type === 'add') {\n            if (index === -1) {\n              // 可能初始expanded里包含了该value\n              expanded.push(value);\n            }\n          } else if (type === 'remove') {\n            expanded.splice(index, 1);\n          }\n        }\n        emitExpand(expanded);\n      },\n    });\n\n    // watch\n    watch(\n      () => props.expanded,\n      (value) => {\n        expandValues.value = value;\n        vMenu.expandValues = new Set(value);\n      },\n    );\n    const updateActiveValues = (value: MenuValue) => {\n      activeValue.value = value;\n      activeValues.value = vMenu.select(value);\n    };\n    watch(() => props.value, updateActiveValues);\n    watch(() => props.defaultValue, updateActiveValues);\n\n    // timelifes\n    onMounted(() => {\n      activeValues.value = vMenu.select(activeValue.value);\n    });\n\n    return {\n      styles,\n      menuClass,\n      innerClasses,\n      activeValue,\n      activeValues,\n      expandValues,\n    };\n  },\n  render() {\n    if (this.$slots.options) {\n      console.warn('TDesign Warn: `options` slot is going to be deprecated, please use `operations` for slot instead.');\n    }\n    const operations = renderContent(this, 'operations', 'options');\n    const logo = renderTNodeJSX(this, 'logo');\n    return (\n      <div class={this.menuClass} style={this.styles}>\n        <div class={`${prefix}-default-menu__inner`}>\n          {logo && <div class={`${prefix}-menu__logo`}>{logo}</div>}\n          <ul class={this.innerClasses}>{renderContent(this, 'default', 'content')}</ul>\n          {operations && <div class={`${prefix}-menu__operations`}>{operations}</div>}\n        </div>\n      </div>\n    );\n  },\n});\n"],"names":["defineComponent","name","props","model","prop","event","setup","props2","ctx","mode","ref","expandType","theme","computed","isMutex","expandMutex","menuClass","prefix","collapsed","innerClasses","value","styles","width","expandWidth","height","activeValue","defaultValue","activeValues","expandValues","expanded","deliver","evt","func","toUpperCase","slice","val","emit","emitChange","emitExpand","watchEffect","vMenu","VMenu","provide","isHead","select","open","type","expand","index","indexOf","push","splice","watch","Set","updateActiveValues","onMounted","render","$slots","options","console","warn","operations","renderContent","logo","renderTNodeJSX"],"mappings":"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"}