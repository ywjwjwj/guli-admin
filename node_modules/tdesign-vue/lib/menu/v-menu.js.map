{"version":3,"file":"v-menu.js","sources":["../../src/menu/v-menu.ts"],"sourcesContent":["import { VNodeChildren } from 'vue';\n\ntype MenuValue = string | number;\ntype MenuNode = MenuValue | VMenuData;\n\ninterface VMenuData {\n  value: MenuValue;\n  parent?: MenuNode;\n  children: VMenuData[];\n  vnode?: VNodeChildren;\n}\n\ninterface VMenuItem {\n  value?: MenuValue;\n  parent: MenuValue;\n  vnode?: VNodeChildren;\n}\n\nconst getTreePaths = (node: VMenuData, val: MenuValue, ans: MenuValue[]): MenuValue[] => {\n  if (!node) return;\n  for (let i = 0; i < node.children.length; ++i) {\n    const child = node.children[i];\n    if (child.value === val) return [...ans, node.value];\n    const target = getTreePaths(child, val, [...ans, node.value]);\n    if (target) return target;\n  }\n};\n\nconst getTreeSameParentNodes = (node: VMenuData, val: MenuValue): VMenuData[] => {\n  if (!node) return;\n  for (let i = 0; i < node.children.length; ++i) {\n    const child = node.children[i];\n    if (child.value === val) return node.children;\n    const target = getTreeSameParentNodes(child, val);\n    if (target) return target;\n  }\n};\n\nconst DFS = (root: VMenuData, val: MenuValue): VMenuData => {\n  if (root.value === val) return root;\n  if (root.children.length > 0) {\n    for (let i = 0, len = root.children.length; i < len; i++) {\n      const res = DFS(root.children[i], val);\n      if (res) return res;\n    }\n  }\n};\n\nexport default class VMenu {\n  data: VMenuData = null;\n\n  cache: Set<VMenuData> = new Set();\n\n  isMutex = false;\n\n  expandValues: Set<MenuValue> = null;\n\n  constructor(options: Record<string, any>) {\n    const root: VMenuData = {\n      value: null, parent: null, children: [],\n    };\n    this.data = root;\n    this.isMutex = options?.isMutex;\n    this.expandValues = new Set(options?.expandValues);\n  }\n\n  add(item: VMenuItem) {\n    const { value, parent, vnode } = item;\n    const node: VMenuData = {\n      value,\n      parent,\n      vnode,\n      children: [],\n    };\n\n    this.cache.forEach((data, v2, set) => {\n      if (item.value === data.parent) {\n        node.children.push(data);\n        set.delete(data);\n      }\n    });\n    if (item.parent == null) {\n      this.data.children.push(node);\n      node.parent = this.data;\n    } else if (this.data.children.length > 0) {\n      const pNode = DFS(this.data, parent);\n      if (pNode) {\n        pNode.children.push(node);\n      } else {\n        this.cache.add(node);\n      }\n    } else {\n      this.cache.add(node);\n    }\n  }\n\n  select(val: MenuValue) {\n    const activeValues = getTreePaths(this.data, val, []) || [];\n\n    activeValues.push(val);\n    return activeValues.filter((val) => val != null);\n  }\n\n  expand(val: MenuValue) {\n    if (this.expandValues.has(val)) {\n      this.expandValues.delete(val);\n      return [...this.expandValues];\n    }\n\n    this.expandValues.add(val);\n\n    if (!this.isMutex) {\n      return [...this.expandValues];\n    }\n\n    const sameParentNodes = getTreeSameParentNodes(this.data, val);\n    const sameLevelSubmenuValues = new Set(sameParentNodes\n      .filter((node) => node.children?.length > 0 && node.value !== val)\n      .map((child) => child.value));\n\n    this.expandValues.forEach((val) => {\n      const isHit = sameLevelSubmenuValues.has(val);\n      if (isHit) {\n        this.expandValues.delete(val);\n      }\n    });\n    return [...this.expandValues];\n  }\n\n  getChild(value: MenuValue) {\n    const target = DFS(this.data, value);\n\n    return target ? target.children : [];\n  }\n}\n"],"names":["getTreePaths","node","val","ans","i","children","length","child","value","_toConsumableArray","target","getTreeSameParentNodes","DFS","root","len","res","VMenu","options","_classCallCheck","_defineProperty","Set","parent","data","isMutex","expandValues","item","vnode","cache","forEach","v2","set","push","pNode","add","activeValues","filter","val2","has","sameParentNodes","sameLevelSubmenuValues","map","isHit"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA,IAAMA,YAAY,GAAG,SAAfA,YAAe,CAACC,IAAD,EAAOC,GAAP,EAAYC,GAAZ,EAAoB;AACvC,EAAI,IAAA,CAACF,IAAL,EACE,OAAA;;AACF,EAAA,KAAK,IAAIG,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,IAAI,CAACI,QAAL,CAAcC,MAAlC,EAA0C,EAAEF,CAA5C,EAA+C;AAC7C,IAAA,IAAMG,KAAK,GAAGN,IAAI,CAACI,QAAL,CAAcD,CAAd,CAAd,CAAA;AACA,IAAIG,IAAAA,KAAK,CAACC,KAAN,KAAgBN,GAApB,EACE,OAAA,EAAA,CAAA,MAAA,CAAAO,sCAAA,CAAWN,GAAX,CAAA,EAAA,CAAgBF,IAAI,CAACO,KAArB,CAAA,CAAA,CAAA;AACF,IAAA,IAAME,MAAM,GAAGV,YAAY,CAACO,KAAD,EAAQL,GAAR,EAAA,EAAA,CAAA,MAAA,CAAAO,sCAAA,CAAiBN,GAAjB,CAAA,EAAA,CAAsBF,IAAI,CAACO,KAA3B,CAA3B,CAAA,CAAA,CAAA;AACA,IAAIE,IAAAA,MAAJ,EACE,OAAOA,MAAP,CAAA;AACH,GAAA;AACF,CAXD,CAAA;;AAYA,IAAMC,sBAAsB,GAAG,SAAzBA,sBAAyB,CAACV,IAAD,EAAOC,GAAP,EAAe;AAC5C,EAAI,IAAA,CAACD,IAAL,EACE,OAAA;;AACF,EAAA,KAAK,IAAIG,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGH,IAAI,CAACI,QAAL,CAAcC,MAAlC,EAA0C,EAAEF,CAA5C,EAA+C;AAC7C,IAAA,IAAMG,KAAK,GAAGN,IAAI,CAACI,QAAL,CAAcD,CAAd,CAAd,CAAA;AACA,IAAIG,IAAAA,KAAK,CAACC,KAAN,KAAgBN,GAApB,EACE,OAAOD,IAAI,CAACI,QAAZ,CAAA;AACF,IAAA,IAAMK,MAAM,GAAGC,sBAAsB,CAACJ,KAAD,EAAQL,GAAR,CAArC,CAAA;AACA,IAAIQ,IAAAA,MAAJ,EACE,OAAOA,MAAP,CAAA;AACH,GAAA;AACF,CAXD,CAAA;;AAYA,IAAME,GAAG,GAAG,SAANA,GAAM,CAACC,IAAD,EAAOX,GAAP,EAAe;AACzB,EAAA,IAAIW,IAAI,CAACL,KAAL,KAAeN,GAAnB,EACE,OAAOW,IAAP,CAAA;;AACF,EAAA,IAAIA,IAAI,CAACR,QAAL,CAAcC,MAAd,GAAuB,CAA3B,EAA8B;AAC5B,IAAA,KAAK,IAAIF,CAAC,GAAG,CAAR,EAAWU,GAAG,GAAGD,IAAI,CAACR,QAAL,CAAcC,MAApC,EAA4CF,CAAC,GAAGU,GAAhD,EAAqDV,CAAC,EAAtD,EAA0D;AACxD,MAAA,IAAMW,GAAG,GAAGH,GAAG,CAACC,IAAI,CAACR,QAAL,CAAcD,CAAd,CAAD,EAAmBF,GAAnB,CAAf,CAAA;AACA,MAAIa,IAAAA,GAAJ,EACE,OAAOA,GAAP,CAAA;AACH,KAAA;AACF,GAAA;AACF,CAVD,CAAA;;IAWqBC;AAKnB,EAAA,SAAA,KAAA,CAAYC,OAAZ,EAAqB;AAAA,IAAAC,mCAAA,CAAA,IAAA,EAAA,KAAA,CAAA,CAAA;;AAAA,IAAAC,mCAAA,CAAA,IAAA,EAAA,MAAA,EAJd,IAIc,CAAA,CAAA;;AAAA,IAHbA,mCAAA,CAAA,IAAA,EAAA,OAAA,iBAAgB,IAAIC,GAAJ,EAGH,CAAA,CAAA;;AAAA,IAAAD,mCAAA,CAAA,IAAA,EAAA,SAAA,EAFX,KAEW,CAAA,CAAA;;AAAA,IAAAA,mCAAA,CAAA,IAAA,EAAA,cAAA,EADN,IACM,CAAA,CAAA;;AACnB,IAAA,IAAMN,IAAI,GAAG;AACXL,MAAAA,KAAK,EAAE,IADI;AAEXa,MAAAA,MAAM,EAAE,IAFG;AAGXhB,MAAAA,QAAQ,EAAE,EAAA;AAHC,KAAb,CAAA;AAKA,IAAKiB,IAAAA,CAAAA,IAAL,GAAYT,IAAZ,CAAA;AACA,IAAKU,IAAAA,CAAAA,OAAL,GAAeN,OAAf,KAAA,IAAA,IAAeA,OAAf,KAAeA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,OAAO,CAAEM,OAAxB,CAAA;AACA,IAAA,IAAA,CAAKC,YAAL,GAAoB,IAAIJ,GAAJ,CAAQH,OAAR,KAAQA,IAAAA,IAAAA,OAAR,KAAQA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,OAAO,CAAEO,YAAjB,CAApB,CAAA;AACD,GAAA;;;;AACD,IAAA,KAAA,EAAA,SAAA,GAAA,CAAIC,IAAJ,EAAU;AACR,MAAA,IAAQjB,KAAR,GAAiCiB,IAAjC,CAAQjB,KAAR;AAAA,UAAea,MAAf,GAAiCI,IAAjC,CAAeJ,MAAf;AAAA,UAAuBK,KAAvB,GAAiCD,IAAjC,CAAuBC,KAAvB,CAAA;AACA,MAAA,IAAMzB,IAAI,GAAG;AACXO,QAAAA,KAAK,EAALA,KADW;AAEXa,QAAAA,MAAM,EAANA,MAFW;AAGXK,QAAAA,KAAK,EAALA,KAHW;AAIXrB,QAAAA,QAAQ,EAAE,EAAA;AAJC,OAAb,CAAA;AAMA,MAAKsB,IAAAA,CAAAA,KAAL,CAAWC,OAAX,CAAmB,UAACN,IAAD,EAAOO,EAAP,EAAWC,GAAX,EAAmB;AACpC,QAAA,IAAIL,IAAI,CAACjB,KAAL,KAAec,IAAI,CAACD,MAAxB,EAAgC;AAC9BpB,UAAAA,IAAI,CAACI,QAAL,CAAc0B,IAAd,CAAmBT,IAAnB,CAAA,CAAA;AACAQ,UAAAA,GAAG,CAAH,QAAA,CAAA,CAAWR,IAAX,CAAA,CAAA;AACD,SAAA;AACF,OALD,CAAA,CAAA;;AAMA,MAAA,IAAIG,IAAI,CAACJ,MAAL,IAAe,IAAnB,EAAyB;AACvB,QAAA,IAAA,CAAKC,IAAL,CAAUjB,QAAV,CAAmB0B,IAAnB,CAAwB9B,IAAxB,CAAA,CAAA;AACAA,QAAAA,IAAI,CAACoB,MAAL,GAAc,KAAKC,IAAnB,CAAA;AACD,OAHD,MAGO,IAAI,IAAA,CAAKA,IAAL,CAAUjB,QAAV,CAAmBC,MAAnB,GAA4B,CAAhC,EAAmC;AACxC,QAAM0B,IAAAA,KAAK,GAAGpB,GAAG,CAAC,KAAKU,IAAN,EAAYD,MAAZ,CAAjB,CAAA;;AACA,QAAA,IAAIW,KAAJ,EAAW;AACTA,UAAAA,KAAK,CAAC3B,QAAN,CAAe0B,IAAf,CAAoB9B,IAApB,CAAA,CAAA;AACD,SAFD,MAEO;AACL,UAAA,IAAA,CAAK0B,KAAL,CAAWM,GAAX,CAAehC,IAAf,CAAA,CAAA;AACD,SAAA;AACF,OAPM,MAOA;AACL,QAAA,IAAA,CAAK0B,KAAL,CAAWM,GAAX,CAAehC,IAAf,CAAA,CAAA;AACD,OAAA;AACF,KAAA;;;AACD,IAAA,KAAA,EAAA,SAAA,MAAA,CAAOC,GAAP,EAAY;AACV,MAAA,IAAMgC,YAAY,GAAGlC,YAAY,CAAC,IAAKsB,CAAAA,IAAN,EAAYpB,GAAZ,EAAiB,EAAjB,CAAZ,IAAoC,EAAzD,CAAA;AACAgC,MAAAA,YAAY,CAACH,IAAb,CAAkB7B,GAAlB,CAAA,CAAA;AACA,MAAA,OAAOgC,YAAY,CAACC,MAAb,CAAoB,UAACC,IAAD,EAAA;AAAA,QAAUA,OAAAA,IAAI,IAAI,IAAlB,CAAA;AAAA,OAApB,CAAP,CAAA;AACD,KAAA;;;AACD,IAAA,KAAA,EAAA,SAAA,MAAA,CAAOlC,GAAP,EAAY;AAAA,MAAA,IAAA,KAAA,GAAA,IAAA,CAAA;;AACV,MAAA,IAAI,KAAKsB,YAAL,CAAkBa,GAAlB,CAAsBnC,GAAtB,CAAJ,EAAgC;AAC9B,QAAKsB,IAAAA,CAAAA,YAAL,WAAyBtB,GAAzB,CAAA,CAAA;AACA,QAAA,OAAAO,sCAAA,CAAW,KAAKe,YAAhB,CAAA,CAAA;AACD,OAAA;;AACD,MAAA,IAAA,CAAKA,YAAL,CAAkBS,GAAlB,CAAsB/B,GAAtB,CAAA,CAAA;;AACA,MAAI,IAAA,CAAC,IAAKqB,CAAAA,OAAV,EAAmB;AACjB,QAAA,OAAAd,sCAAA,CAAW,KAAKe,YAAhB,CAAA,CAAA;AACD,OAAA;;AACD,MAAMc,IAAAA,eAAe,GAAG3B,sBAAsB,CAAC,KAAKW,IAAN,EAAYpB,GAAZ,CAA9C,CAAA;AACA,MAAMqC,IAAAA,sBAAsB,GAAG,IAAInB,GAAJ,CAAQkB,eAAe,CAACH,MAAhB,CAAuB,UAAClC,IAAD,EAAA;AAAA,QAAA,IAAA,cAAA,CAAA;;AAAA,QAAA,OAAU,CAAAA,CAAAA,cAAAA,GAAAA,IAAI,CAACI,QAAL,MAAeC,IAAAA,IAAAA,cAAAA,KAAAA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,cAAAA,CAAAA,MAAf,IAAwB,CAAxB,IAA6BL,IAAI,CAACO,KAAL,KAAeN,GAAtD,CAAA;AAAA,OAAvB,CAAkFsC,CAAAA,GAAlF,CAAsF,UAACjC,KAAD,EAAA;AAAA,QAAWA,OAAAA,KAAK,CAACC,KAAjB,CAAA;AAAA,OAAtF,CAAR,CAA/B,CAAA;AACA,MAAA,IAAA,CAAKgB,YAAL,CAAkBI,OAAlB,CAA0B,UAACQ,IAAD,EAAU;AAClC,QAAA,IAAMK,KAAK,GAAGF,sBAAsB,CAACF,GAAvB,CAA2BD,IAA3B,CAAd,CAAA;;AACA,QAAA,IAAIK,KAAJ,EAAW;AACT,UAAA,KAAI,CAACjB,YAAL,CAAA,QAAA,CAAA,CAAyBY,IAAzB,CAAA,CAAA;AACD,SAAA;AACF,OALD,CAAA,CAAA;AAMA,MAAA,OAAA3B,sCAAA,CAAW,KAAKe,YAAhB,CAAA,CAAA;AACD,KAAA;;;AACD,IAAA,KAAA,EAAA,SAAA,QAAA,CAAShB,KAAT,EAAgB;AACd,MAAME,IAAAA,MAAM,GAAGE,GAAG,CAAC,KAAKU,IAAN,EAAYd,KAAZ,CAAlB,CAAA;AACA,MAAA,OAAOE,MAAM,GAAGA,MAAM,CAACL,QAAV,GAAqB,EAAlC,CAAA;AACD,KAAA;;;;;;;;"}