{"version":3,"file":"head-menu.js","sources":["../../src/menu/head-menu.tsx"],"sourcesContent":["import {\n  defineComponent, computed, provide, ref, reactive, watch, onMounted,\n} from '@vue/composition-api';\nimport { prefix } from '../config';\nimport props from './head-menu-props';\nimport { MenuValue } from './type';\nimport { TdMenuInterface, TdOpenType } from './const';\nimport { Tabs, TabPanel } from '../tabs';\nimport { renderContent, renderTNodeJSX } from '../utils/render-tnode';\nimport VMenu from './v-menu';\n\nexport default defineComponent({\n  name: 'THeadMenu',\n  props,\n  model: {\n    prop: 'value',\n    event: 'change',\n  },\n  components: { Tabs, TabPanel },\n  setup(props, ctx) {\n    const activeValue = ref(props.defaultValue || props.value);\n    const activeValues = ref([]);\n    const expandValues = ref(props.defaultExpanded || props.expanded || []);\n    const theme = computed(() => props.theme);\n    const menuClass = computed(() => [\n      `${prefix}-menu`,\n      `${prefix}-head-menu`,\n      `${prefix}-menu--${props.theme}`,\n    ]);\n    const mode = ref(props.expandType);\n    const submenu = reactive([]);\n    const deliver = (evt: string) => {\n      const func = `on${evt[0].toUpperCase() + evt.slice(1)}`;\n      return (val: any) => {\n        if (typeof props[func] === 'function') {\n          props[func](val);\n        }\n        ctx.emit(evt, val);\n      };\n    };\n    const emitChange = deliver('change');\n    const emitExpand = deliver('expand');\n    const vMenu = new VMenu({ isMutex: true, expandValues: expandValues.value });\n\n    provide<TdMenuInterface>('TdMenu', {\n      mode,\n      theme,\n      vMenu,\n      isHead: true,\n      expandValues,\n      activeValue,\n      activeValues,\n      select: (value: MenuValue) => {\n        emitChange(value);\n      },\n      open: (value: MenuValue, type: TdOpenType) => {\n        const expanded = [...expandValues.value];\n        const index = expanded.indexOf(value);\n\n        if (mode.value === 'popup') {\n          if (type === 'add') {\n            if (index === -1) { // 可能初始expanded里包含了该value\n              expanded.push(value);\n            }\n          } else if (type === 'remove') {\n            expanded.splice(index, 1);\n          }\n        } else {\n          expanded.splice(0, 1);\n          if (index === -1) {\n            expanded.push(value);\n          }\n        }\n        emitExpand(expanded);\n      },\n    });\n\n    // methods\n    const handleTabChange = (value: MenuValue) => {\n      emitChange(value);\n    };\n\n    // watch\n    const handleSubmenuExpand = (value: MenuValue) => {\n      const ans = vMenu.getChild(value);\n      submenu.length = 0;\n      submenu.push(...ans);\n    };\n    watch(\n      () => props.expanded,\n      (value) => {\n        expandValues.value = value;\n        if (mode.value === 'normal') {\n          handleSubmenuExpand(value[0]);\n        }\n      },\n    );\n    const updateActiveValues = (value: MenuValue) => {\n      activeValue.value = value;\n      activeValues.value = vMenu.select(value);\n    };\n    watch(() => props.value, updateActiveValues);\n    watch(() => props.defaultValue, updateActiveValues);\n    watch(() => props.expandType, (value) => {\n      mode.value = value;\n    });\n\n    onMounted(() => {\n      activeValues.value = vMenu.select(activeValue.value);\n      if (expandValues.value?.length > 0) {\n        handleSubmenuExpand(expandValues.value[0]); // 顶部导航只能同时展开一个子菜单\n      }\n    });\n\n    return {\n      mode,\n      menuClass,\n      expandValues,\n      activeValue,\n      activeValues,\n      submenu,\n      handleTabChange,\n    };\n  },\n  methods: {\n    renderNormalSubmenu() {\n      if (this.submenu.length === 0) return null;\n      return (\n        <ul class={[`${prefix}-head-menu__submenu`, `${prefix}-submenu`]}>\n          {\n            <t-tabs value={this.activeValue} onChange={this.handleTabChange}>\n              { this.submenu.map((item) => (\n                <t-tab-panel value={item.value} label={item.vnode[0].text} />\n              ))}\n            </t-tabs>\n          }\n        </ul>\n      );\n    },\n  },\n  render() {\n    if (this.$slots.options) {\n      console.warn('TDesign Warn: `options` slot is going to be deprecated, please use `operations` for slot instead.');\n    }\n    const operations = renderContent(this, 'operations', 'options');\n    const logo = renderTNodeJSX(this, 'logo');\n    return (\n      <div class={this.menuClass}>\n        <div class={`${prefix}-head-menu__inner`}>\n          {logo && <div class={`${prefix}-menu__logo`}>{logo}</div>}\n          <ul class={`${prefix}-menu`}>\n            {renderContent(this, 'default', 'content')}\n          </ul>\n          {operations && <div class={`${prefix}-menu__operations`}>{operations}</div>}\n        </div>\n        {this.mode === 'normal' && this.renderNormalSubmenu()}\n      </div>\n    );\n  },\n});\n"],"names":["defineComponent","name","props","model","prop","event","components","Tabs","TabPanel","setup","props2","ctx","activeValue","ref","defaultValue","value","activeValues","expandValues","defaultExpanded","expanded","theme","computed","menuClass","prefix","mode","expandType","submenu","reactive","deliver","evt","func","toUpperCase","slice","val","emit","emitChange","emitExpand","vMenu","VMenu","isMutex","provide","isHead","select","open","type","_toConsumableArray","index","indexOf","push","splice","handleTabChange","handleSubmenuExpand","ans","getChild","length","watch","updateActiveValues","onMounted","methods","renderNormalSubmenu","map","item","vnode","text","render","$slots","options","console","warn","operations","renderContent","logo","renderTNodeJSX"],"mappings":"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"}