{"version":3,"file":"useVModel.js","sources":["../../src/hooks/useVModel.ts"],"sourcesContent":["import { Ref, ref, getCurrentInstance } from '@vue/composition-api';\n\nexport type ChangeHandler<T, P extends any[]> = (value: T, ...args: P) => void;\n\nexport default function useVModel<T, P extends any[]>(\n  value: Ref<T>,\n  defaultValue: T,\n  onChange: ChangeHandler<T, P>,\n  // eventName 不是 input 时，需要单独传入 eventName 用于事件输出\n  eventName?: string,\n): [Ref<T>, ChangeHandler<T, P>] {\n  const { emit } = getCurrentInstance();\n\n  const internalValue = ref<T>();\n  internalValue.value = defaultValue;\n\n  // 受控模式\n  if (typeof value.value !== 'undefined') {\n    return [\n      value,\n      (newValue, ...args) => {\n        // input 事件为 v-model 语法糖\n        emit?.('input', newValue, ...args);\n        onChange?.(newValue, ...args);\n        if (eventName && eventName !== 'input') {\n          emit?.(eventName, newValue, ...args);\n        }\n      },\n    ];\n  }\n\n  // 非受控模式\n  return [\n    internalValue,\n    (newValue, ...args) => {\n      internalValue.value = newValue;\n      onChange?.(newValue, ...args);\n      if (eventName && eventName !== 'input') {\n        emit?.(eventName, newValue, ...args);\n      }\n    },\n  ];\n}\n"],"names":["useVModel","value","defaultValue","onChange","eventName","getCurrentInstance","emit","internalValue","ref","newValue","args"],"mappings":";;;;;;;;;;;;AACe,SAASA,SAAT,CAAmBC,KAAnB,EAA0BC,YAA1B,EAAwCC,QAAxC,EAAkDC,SAAlD,EAA6D;AAC1E,EAAA,IAAA,mBAAA,GAAiBC,oCAAkB,EAAnC;AAAA,MAAQC,IAAR,uBAAQA,IAAR,CAAA;;AACA,EAAMC,IAAAA,aAAa,GAAGC,qBAAG,EAAzB,CAAA;AACAD,EAAAA,aAAa,CAACN,KAAd,GAAsBC,YAAtB,CAAA;;AACA,EAAA,IAAI,OAAOD,KAAK,CAACA,KAAb,KAAuB,WAA3B,EAAwC;AACtC,IAAA,OAAO,CACLA,KADK,EAEL,UAACQ,QAAD,EAAuB;AAAA,MAAA,KAAA,IAAA,IAAA,GAAA,SAAA,CAAA,MAAA,EAATC,IAAS,GAAA,IAAA,KAAA,CAAA,IAAA,GAAA,CAAA,GAAA,IAAA,GAAA,CAAA,GAAA,CAAA,CAAA,EAAA,IAAA,GAAA,CAAA,EAAA,IAAA,GAAA,IAAA,EAAA,IAAA,EAAA,EAAA;AAATA,QAAAA,IAAS,CAAA,IAAA,GAAA,CAAA,CAAA,GAAA,SAAA,CAAA,IAAA,CAAA,CAAA;AAAA,OAAA;;AACrBJ,MAAAA,IAAI,KAAA,IAAJ,IAAAA,IAAI,KAAJ,KAAA,CAAA,GAAA,KAAA,CAAA,GAAAA,IAAI,CAAA,KAAJ,CAAO,KAAA,CAAA,EAAA,CAAA,OAAP,EAAgBG,QAAhB,SAA6BC,IAA7B,CAAA,CAAA,CAAA;AACAP,MAAAA,QAAQ,KAAR,IAAA,IAAAA,QAAQ,KAAA,KAAA,CAAR,GAAAA,KAAAA,CAAAA,GAAAA,QAAQ,CAAR,KAAA,CAAA,KAAA,CAAA,EAAA,CAAWM,QAAX,CAAA,CAAA,MAAA,CAAwBC,IAAxB,CAAA,CAAA,CAAA;;AACA,MAAA,IAAIN,SAAS,IAAIA,SAAS,KAAK,OAA/B,EAAwC;AACtCE,QAAAA,IAAI,KAAA,IAAJ,IAAAA,IAAI,KAAJ,KAAA,CAAA,GAAA,KAAA,CAAA,GAAAA,IAAI,CAAA,KAAJ,CAAOF,KAAAA,CAAAA,EAAAA,CAAAA,SAAP,EAAkBK,QAAlB,SAA+BC,IAA/B,CAAA,CAAA,CAAA;AACD,OAAA;AACF,KARI,CAAP,CAAA;AAUD,GAAA;;AACD,EAAA,OAAO,CACLH,aADK,EAEL,UAACE,QAAD,EAAuB;AACrBF,IAAAA,aAAa,CAACN,KAAd,GAAsBQ,QAAtB,CAAA;;AADqB,IAAA,KAAA,IAAA,KAAA,GAAA,SAAA,CAAA,MAAA,EAATC,IAAS,GAAA,IAAA,KAAA,CAAA,KAAA,GAAA,CAAA,GAAA,KAAA,GAAA,CAAA,GAAA,CAAA,CAAA,EAAA,KAAA,GAAA,CAAA,EAAA,KAAA,GAAA,KAAA,EAAA,KAAA,EAAA,EAAA;AAATA,MAAAA,IAAS,CAAA,KAAA,GAAA,CAAA,CAAA,GAAA,SAAA,CAAA,KAAA,CAAA,CAAA;AAAA,KAAA;;AAErBP,IAAAA,QAAQ,KAAR,IAAA,IAAAA,QAAQ,KAAA,KAAA,CAAR,GAAAA,KAAAA,CAAAA,GAAAA,QAAQ,CAAR,KAAA,CAAA,KAAA,CAAA,EAAA,CAAWM,QAAX,CAAA,CAAA,MAAA,CAAwBC,IAAxB,CAAA,CAAA,CAAA;;AACA,IAAA,IAAIN,SAAS,IAAIA,SAAS,KAAK,OAA/B,EAAwC;AACtCE,MAAAA,IAAI,KAAA,IAAJ,IAAAA,IAAI,KAAJ,KAAA,CAAA,GAAA,KAAA,CAAA,GAAAA,IAAI,CAAA,KAAJ,CAAOF,KAAAA,CAAAA,EAAAA,CAAAA,SAAP,EAAkBK,QAAlB,SAA+BC,IAA/B,CAAA,CAAA,CAAA;AACD,KAAA;AACF,GARI,CAAP,CAAA;AAUD;;;;"}