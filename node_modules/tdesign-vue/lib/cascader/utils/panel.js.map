{"version":3,"file":"panel.js","sources":["../../../src/cascader/utils/panel.ts"],"sourcesContent":["import isNumber from 'lodash/isNumber';\nimport {\n  TreeNode, CascaderContextType, CascaderProps, TreeNodeValue,\n} from '../interface';\n\n/**\n * 面板数据计算方法\n * @param treeNodes\n * @returns\n */\nexport function getPanels(treeNodes: CascaderContextType['treeNodes']) {\n  const panels: TreeNode[][] = [];\n  treeNodes.forEach((node: TreeNode) => {\n    if (panels[node.level]) {\n      panels[node.level].push(node);\n    } else {\n      panels[node.level] = [node];\n    }\n  });\n  return panels;\n}\n\n/**\n * 点击item的副作用\n * @param propsTrigger\n * @param trigger\n * @param node\n * @param cascaderContext\n * @param onChange\n * @param ctx\n */\nexport function expendClickEffect(\n  propsTrigger: CascaderProps['trigger'],\n  trigger: CascaderProps['trigger'],\n  node: TreeNode,\n  cascaderContext: CascaderContextType,\n) {\n  const {\n    checkStrictly,\n    filterActive,\n    multiple,\n    treeStore,\n    setFilterActive,\n    setVisible,\n    setValue,\n    setTreeNodes,\n    setExpend,\n    value,\n    max,\n    valueType,\n  } = cascaderContext;\n\n  const isDisabled = node.disabled || (multiple && (value as TreeNodeValue[]).length >= max && max !== 0);\n\n  if (isDisabled) return;\n  // 点击展开节点，设置展开状态\n  if (propsTrigger === trigger && !node.isLeaf()) {\n    const expanded = node.setExpanded(true);\n    treeStore.refreshNodes();\n    treeStore.replaceExpanded(expanded);\n    const nodes = treeStore.getNodes().filter((node: TreeNode) => node.visible);\n    setTreeNodes(nodes);\n\n    // 多选条件下\b手动维护expend\n    if (multiple) {\n      setExpend(expanded);\n    }\n  }\n\n  if (!multiple && (node.isLeaf() || checkStrictly) && trigger === 'click') {\n    treeStore.resetChecked();\n    const checked = node.setChecked(!node.isChecked());\n    const [value] = checked;\n\n    // 过滤状态下，点击后清除过滤状态\n    if (filterActive) {\n      setFilterActive(false);\n    }\n\n    // 非过滤状态下，关闭\n    if (!filterActive && !checkStrictly) {\n      setVisible(false);\n    }\n\n    // 非受控状态下更新状态\n    setValue(valueType === 'single' ? value : node.getPath().map((item) => item.value), 'checked', node.getModel());\n  }\n}\n\n/**\n * 多选状态下选中状态数据变化的副作用\n * @param node\n * @param cascaderContext\n * @returns\n */\nexport function valueChangeEffect(node: TreeNode, cascaderContext: CascaderContextType) {\n  const {\n    disabled,\n    max,\n    multiple,\n    setVisible,\n    setValue,\n    filterActive,\n    setFilterActive,\n    treeNodes,\n    treeStore,\n    valueType,\n  } = cascaderContext;\n\n  if (!node || disabled || node.disabled) {\n    return;\n  }\n  const checked = node.setChecked(!node.isChecked());\n\n  if (isNumber(max) && max < 0) {\n    console.warn('TDesign Warn:', 'max should > 0');\n  }\n\n  if (checked.length > max && isNumber(max) && max > 0) {\n    return;\n  }\n\n  if (checked.length === 0) {\n    const expanded = treeStore.getExpanded();\n    setTimeout(() => {\n      treeStore.replaceExpanded(expanded);\n      treeStore.refreshNodes();\n    }, 0);\n  }\n\n  if (!multiple) {\n    setVisible(false);\n  }\n\n  const isSelectAll = treeNodes.every((item) => checked.indexOf(item.value) > -1);\n\n  if (filterActive && isSelectAll) {\n    setVisible(false);\n    setFilterActive(false);\n  }\n\n  // 处理不同数据类型\n  const resValue = valueType === 'single'\n    ? checked\n    : checked.map((val) => treeStore\n      .getNode(val)\n      .getPath()\n      .map((item) => item.value));\n  setValue(resValue, 'checked', node.getModel());\n}\n"],"names":["getPanels","treeNodes","panels","forEach","node","level","push","expendClickEffect","propsTrigger","trigger","cascaderContext","checkStrictly","filterActive","multiple","treeStore","setFilterActive","setVisible","setValue","setTreeNodes","setExpend","value","max","valueType","isDisabled","disabled","length","isLeaf","expanded","setExpanded","refreshNodes","replaceExpanded","nodes","getNodes","filter","node2","visible","resetChecked","checked","setChecked","isChecked","_slicedToArray","value2","getPath","map","item","getModel","valueChangeEffect","isNumber","console","warn","getExpanded","setTimeout","isSelectAll","every","indexOf","resValue","val","getNode"],"mappings":"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"}