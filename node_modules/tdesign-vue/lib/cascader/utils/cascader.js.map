{"version":3,"file":"cascader.js","sources":["../../../src/cascader/utils/cascader.ts"],"sourcesContent":["import { getFullPathLabel, getTreeValue } from './helper';\nimport { TreeNode, TreeNodeValue, CascaderContextType } from '../interface';\n\n/**\n * input和treeStore变化的副作用\n * @param inputVal\n * @param treeStore\n * @param setTreeNodes\n * @returns\n */\nexport const treeNodesEffect = (\n  inputVal: CascaderContextType['inputVal'],\n  treeStore: CascaderContextType['treeStore'],\n  setTreeNodes: CascaderContextType['setTreeNodes'],\n) => {\n  if (!treeStore) return;\n  let nodes = [];\n  if (inputVal) {\n    nodes = treeStore.nodes.filter((node: TreeNode) => {\n      const fullPathLabel = getFullPathLabel(node);\n      return fullPathLabel.indexOf(inputVal) > -1 && node.isLeaf();\n    });\n  } else {\n    nodes = treeStore.getNodes().filter((node: TreeNode) => node.visible);\n  }\n  setTreeNodes(nodes);\n};\n\n/**\n * 初始化展开阶段与展开状态副作用\n * @param treeStore\n * @param treeValue\n * @param expend\n */\nexport const treeStoreExpendEffect = (\n  treeStore: CascaderContextType['treeStore'],\n  value: CascaderContextType['value'],\n  expend: TreeNodeValue[],\n) => {\n  const treeValue = getTreeValue(value);\n\n  if (!treeStore) return;\n  // init expanded, 无expend状态时设置\n  if (Array.isArray(treeValue) && expend.length === 0) {\n    const expandedMap = new Map();\n    const [val] = treeValue;\n    if (val) {\n      expandedMap.set(val, true);\n      const node = treeStore.getNode(val);\n      if (!node) {\n        treeStore.refreshNodes();\n        return;\n      }\n      node.getParents().forEach((tn: TreeNode) => {\n        expandedMap.set(tn.value, true);\n      });\n      const expandedArr = Array.from(expandedMap.keys());\n      treeStore.replaceExpanded(expandedArr);\n    } else {\n      treeStore.resetExpanded();\n    }\n  }\n  // 本地维护 expend，更加可控，不需要依赖于 tree 的状态\n  if (treeStore.getExpanded() && expend.length) {\n    treeStore.replaceExpanded(expend);\n  }\n  treeStore.refreshNodes();\n};\n"],"names":["treeNodesEffect","inputVal","treeStore","setTreeNodes","nodes","filter","node","fullPathLabel","getFullPathLabel","indexOf","isLeaf","getNodes","visible","treeStoreExpendEffect","value","expend","treeValue","getTreeValue","Array","isArray","length","expandedMap","Map","_slicedToArray","val","set","getNode","refreshNodes","getParents","forEach","tn","expandedArr","from","keys","replaceExpanded","resetExpanded","getExpanded"],"mappings":";;;;;;;;;;;;;;;;;;;AACO,IAAMA,eAAe,GAAG,SAAlBA,eAAkB,CAACC,QAAD,EAAWC,SAAX,EAAsBC,YAAtB,EAAuC;AACpE,EAAI,IAAA,CAACD,SAAL,EACE,OAAA;AACF,EAAIE,IAAAA,KAAK,GAAG,EAAZ,CAAA;;AACA,EAAA,IAAIH,QAAJ,EAAc;AACZG,IAAAA,KAAK,GAAGF,SAAS,CAACE,KAAV,CAAgBC,MAAhB,CAAuB,UAACC,IAAD,EAAU;AACvC,MAAA,IAAMC,aAAa,GAAGC,sCAAgB,CAACF,IAAD,CAAtC,CAAA;AACA,MAAA,OAAOC,aAAa,CAACE,OAAd,CAAsBR,QAAtB,CAAA,GAAkC,CAAC,CAAnC,IAAwCK,IAAI,CAACI,MAAL,EAA/C,CAAA;AACD,KAHO,CAAR,CAAA;AAID,GALD,MAKO;AACLN,IAAAA,KAAK,GAAGF,SAAS,CAACS,QAAV,EAAqBN,CAAAA,MAArB,CAA4B,UAACC,IAAD,EAAA;AAAA,MAAUA,OAAAA,IAAI,CAACM,OAAf,CAAA;AAAA,KAA5B,CAAR,CAAA;AACD,GAAA;;AACDT,EAAAA,YAAY,CAACC,KAAD,CAAZ,CAAA;AACD,EAbM;AAcA,IAAMS,qBAAqB,GAAG,SAAxBA,qBAAwB,CAACX,SAAD,EAAYY,KAAZ,EAAmBC,MAAnB,EAA8B;AACjE,EAAA,IAAMC,SAAS,GAAGC,kCAAY,CAACH,KAAD,CAA9B,CAAA;AACA,EAAI,IAAA,CAACZ,SAAL,EACE,OAAA;;AACF,EAAIgB,IAAAA,KAAK,CAACC,OAAN,CAAcH,SAAd,CAA4BD,IAAAA,MAAM,CAACK,MAAP,KAAkB,CAAlD,EAAqD;AACnD,IAAA,IAAMC,WAAW,kBAAmB,IAAIC,GAAJ,EAApC,CAAA;;AACA,IAAA,IAAA,UAAA,GAAAC,kCAAA,CAAcP,SAAd,EAAA,CAAA,CAAA;AAAA,QAAOQ,GAAP,GAAA,UAAA,CAAA,CAAA,CAAA,CAAA;;AACA,IAAA,IAAIA,GAAJ,EAAS;AACPH,MAAAA,WAAW,CAACI,GAAZ,CAAgBD,GAAhB,EAAqB,IAArB,CAAA,CAAA;AACA,MAAA,IAAMlB,IAAI,GAAGJ,SAAS,CAACwB,OAAV,CAAkBF,GAAlB,CAAb,CAAA;;AACA,MAAI,IAAA,CAAClB,IAAL,EAAW;AACTJ,QAAAA,SAAS,CAACyB,YAAV,EAAA,CAAA;AACA,QAAA,OAAA;AACD,OAAA;;AACDrB,MAAAA,IAAI,CAACsB,UAAL,EAAA,CAAkBC,OAAlB,CAA0B,UAACC,EAAD,EAAQ;AAChCT,QAAAA,WAAW,CAACI,GAAZ,CAAgBK,EAAE,CAAChB,KAAnB,EAA0B,IAA1B,CAAA,CAAA;AACD,OAFD,CAAA,CAAA;AAGA,MAAMiB,IAAAA,WAAW,GAAGb,KAAK,CAACc,IAAN,CAAWX,WAAW,CAACY,IAAZ,EAAX,CAApB,CAAA;AACA/B,MAAAA,SAAS,CAACgC,eAAV,CAA0BH,WAA1B,CAAA,CAAA;AACD,KAZD,MAYO;AACL7B,MAAAA,SAAS,CAACiC,aAAV,EAAA,CAAA;AACD,KAAA;AACF,GAAA;;AACD,EAAA,IAAIjC,SAAS,CAACkC,WAAV,MAA2BrB,MAAM,CAACK,MAAtC,EAA8C;AAC5ClB,IAAAA,SAAS,CAACgC,eAAV,CAA0BnB,MAA1B,CAAA,CAAA;AACD,GAAA;;AACDb,EAAAA,SAAS,CAACyB,YAAV,EAAA,CAAA;AACD;;;;;"}