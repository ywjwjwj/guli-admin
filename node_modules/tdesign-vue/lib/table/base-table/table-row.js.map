{"version":3,"file":"table-row.js","sources":["../../../src/table/base-table/table-row.tsx"],"sourcesContent":["import Vue, { VNode, PropType, CreateElement } from 'vue';\nimport get from 'lodash/get';\nimport { prefix } from '../../config';\nimport { BaseTableCol, RowspanColspan, TdBaseTableProps } from '../type';\nimport baseTableProps from '../base-table-props';\nimport TableCell from './table-cell';\nimport { CustomData, CellData, CellParams } from '../util/interface';\nimport { emitEvent } from '../../utils/event';\n\ninterface Column extends BaseTableCol {\n  scopedSlots: any;\n}\n\ntype Attrs = Record<string, any>;\n\nconst eventsName = {\n  mouseover: 'row-hover',\n  mouseleave: 'row-mouseleave',\n  mouseenter: 'row-mouseenter',\n  mousedown: 'row-mousedown',\n  mouseup: 'row-mouseup',\n  click: 'row-click',\n  dblclick: 'row-db-click',\n  dragstart: 'row-dragstart',\n  dragover: 'row-dragover',\n};\n\nexport default Vue.extend({\n  name: `${prefix}-table-row`,\n\n  props: {\n    rowClass: baseTableProps.rowClassName,\n    columns: baseTableProps.columns,\n    rowKey: baseTableProps.rowKey,\n    rowspanAndColspanProps: {\n      type: Object as PropType<RowspanColspan>,\n      required: false,\n    },\n    rowData: {\n      type: Object,\n      default(): any {\n        return {};\n      },\n    },\n    index: {\n      type: Number,\n      default: -1,\n    },\n    current: {\n      type: Number,\n      default: 1,\n    },\n    onCellClick: baseTableProps.onCellClick,\n    provider: {\n      type: Object,\n      default() {\n        return {\n          sortOnRowDraggable: false,\n        };\n      },\n    },\n  },\n\n  methods: {\n    // 渲染行\n    renderRow(): Array<VNode> {\n      const {\n        rowData, columns, index: rowIndex, rowspanAndColspanProps,\n      } = this;\n      const rowBody: Array<VNode> = [];\n\n      let flag = true;\n      columns.forEach((column, index) => {\n        const customData: CustomData = {\n          type: 'cell',\n          func: 'cell',\n        };\n        const { render, cell, scopedSlots } = column as Column;\n        const scopedSlotsCol = scopedSlots?.col;\n        const { colKey } = column;\n\n        let customRender: any;\n\n        if (typeof this.$scopedSlots[scopedSlotsCol] === 'function') {\n          customRender = (h: CreateElement, params: CellParams) => this.$scopedSlots[scopedSlotsCol](params);\n          console.warn('TDesign Table Warn: scopedSlots will be deprecated, please use `cell` and `title` instead.');\n        } else if (typeof cell === 'function') {\n          customRender = cell;\n        } else if (typeof cell === 'string' && typeof this.$scopedSlots[cell] === 'function') {\n          customRender = (h: CreateElement, params: CellParams) => this.$scopedSlots[cell](params);\n        } else if (typeof this.$scopedSlots[colKey] === 'function') {\n          customRender = (h: CreateElement, params: CellParams) => this.$scopedSlots[colKey](params);\n        } else if (typeof render === 'function') {\n          customRender = render;\n          customData.func = 'render';\n        } else {\n          customRender = () => get(rowData, colKey);\n        }\n\n        const attrs: Attrs = column.attrs || {};\n        if (colKey !== 'expanded-row' && rowspanAndColspanProps?.[colKey]) {\n          let colspan = 1;\n          let rowspan = 1;\n          if (rowspanAndColspanProps[colKey]) {\n            rowspan = rowspanAndColspanProps[colKey].rowspan || rowspan;\n            colspan = rowspanAndColspanProps[colKey].colspan || colspan;\n          }\n          attrs.colspan = colspan;\n          attrs.rowspan = rowspan;\n          if (colspan === -1 || rowspan === -1) {\n            return;\n          }\n        }\n        let withBorder;\n        let withoutBorder;\n        // 存在跨列或者跨行的情况\n        if (index > rowBody.length && rowIndex > 0) {\n          // 如果当前显示行的第一列，但不是 column 的第一列而且有固定列存在的情况下，要隐藏一下 border\n          if (columns[index - 1]?.fixed && rowBody.length === 0) {\n            withoutBorder = true;\n          } else if (flag) {\n            withBorder = true;\n            flag = false;\n          }\n        }\n        const cellData: CellData = {\n          col: {\n            ...column,\n            attrs,\n          },\n          withBorder,\n          withoutBorder,\n          colIndex: index,\n          row: rowData,\n          rowIndex,\n          customData,\n          customRender,\n          type: 'td',\n        };\n        const on = {\n          'cell-click': (p: Parameters<TdBaseTableProps['onCellClick']>[0]) => {\n            emitEvent<Parameters<TdBaseTableProps['onCellClick']>>(this, 'cell-click', p);\n          },\n        };\n        rowBody.push(<TableCell on={on} cellData={cellData} length={columns.length} />);\n      });\n      return rowBody;\n    },\n  },\n\n  render() {\n    const {\n      rowClass, $attrs, rowData, index, rowKey, current,\n    } = this;\n    const params = {\n      row: rowData,\n      index,\n    };\n    const on = {\n      ...this.$listeners,\n    };\n    Object.keys(eventsName).forEach((event) => {\n      const emitEventName = eventsName[event];\n      on[event] = (e: MouseEvent) => {\n        emitEvent(this, emitEventName, {\n          ...params,\n          e,\n        });\n      };\n    });\n    const trProps = {\n      attrs: {\n        ...$attrs,\n        class: rowClass,\n        key: rowKey ? get(rowData, rowKey) : index + current,\n      },\n      on,\n    };\n    if (this.provider.sortOnRowDraggable) {\n      (trProps.attrs as any).draggable = true;\n    }\n    return <tr {...trProps}>{this.renderRow()}</tr>;\n  },\n});\n"],"names":["eventsName","mouseover","mouseleave","mouseenter","mousedown","mouseup","click","dblclick","dragstart","dragover","Vue","extend","name","prefix","props","rowClass","baseTableProps","rowClassName","columns","rowKey","rowspanAndColspanProps","type","Object","required","rowData","index","Number","current","onCellClick","provider","sortOnRowDraggable","methods","renderRow","rowIndex","rowBody","flag","forEach","column","customData","func","render","cell","scopedSlots","scopedSlotsCol","col","colKey","customRender","$scopedSlots","h","params","console","warn","get","attrs","colspan","rowspan","withBorder","withoutBorder","length","fixed","cellData","colIndex","row","on","p","emitEvent","push","TableCell","_mergeJSXProps","$attrs","$listeners","keys","event","emitEventName","e","trProps","key","draggable","_mergeJSXProps2"],"mappings":"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"}