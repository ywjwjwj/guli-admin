{"version":3,"file":"loading.js","sources":["../../src/loading/loading.tsx"],"sourcesContent":["import Vue from 'vue';\nimport GradientIcon from './icon/gradient';\nimport { prefix } from '../config';\nimport { SIZE_CLASSNAMES } from '../utils/classnames';\nimport { addClass, removeClass } from '../utils/dom';\nimport { renderTNodeJSX, renderContent } from '../utils/render-tnode';\nimport TransferDom from '../utils/transfer-dom';\nimport props from './props';\nimport { ClassName, Styles } from '../common';\n\nconst name = `${prefix}-loading`;\nconst centerClass = `${prefix}-loading--center`;\nconst fullscreenClass = `${prefix}-loading__fullscreen`;\nconst lockClass = `${prefix}-loading--lock`;\nconst overlayClass = `${prefix}-loading__overlay`;\nconst relativeClass = `${prefix}-loading__parent`;\nconst fullClass = `${prefix}-loading--full`;\nconst inheritColorClass = `${prefix}-loading--inherit-color`;\n\nexport default Vue.extend({\n  name: 'TLoading',\n\n  props: {\n    ...props,\n  },\n\n  directives: {\n    TransferDom,\n  },\n\n  data() {\n    return {\n      delayShowLoading: false,\n    };\n  },\n\n  created() {\n    this.delay && this.countDelay();\n  },\n\n  watch: {\n    loading: {\n      handler(value) {\n        if (value) {\n          this.countDelay();\n          this.lockFullscreen && addClass(document.body, lockClass);\n        } else {\n          this.lockFullscreen && removeClass(document.body, lockClass);\n        }\n      },\n      immediate: true,\n    },\n  },\n\n  computed: {\n    styles(): Styles {\n      const styles: Styles = {};\n      if (this.zIndex !== undefined) {\n        styles.zIndex = this.zIndex;\n      }\n      if (!['small', 'medium', 'large'].includes(this.size)) {\n        styles['font-size'] = this.size;\n      }\n      return styles;\n    },\n    showText(): boolean {\n      return Boolean(this.text || this.$scopedSlots.text);\n    },\n    baseClasses(): ClassName {\n      return [centerClass, SIZE_CLASSNAMES[this.size], { [inheritColorClass]: this.inheritColor }];\n    },\n    hasContent(): boolean {\n      return Boolean(this.default || this.$scopedSlots.default || this.content || this.$scopedSlots.content);\n    },\n    withContentClasses(): ClassName {\n      return this.baseClasses.concat([\n        name,\n        fullClass,\n        {\n          [overlayClass]: this.showOverlay,\n        },\n      ]);\n    },\n    fullScreenClasses(): ClassName {\n      return [name, fullscreenClass, centerClass, overlayClass];\n    },\n    attachClasses(): ClassName {\n      return this.baseClasses.concat([name, fullClass, { [overlayClass]: this.showOverlay }]);\n    },\n    normalClasses(): ClassName {\n      return this.baseClasses.concat([name]);\n    },\n    lockFullscreen(): boolean {\n      return this.preventScrollThrough && this.fullscreen;\n    },\n    // 延时计时是否完成。用于控制延时计时结束前不能显示加载态\n    delayCounted(): boolean {\n      return Boolean(!this.delay || (this.delay && this.delayShowLoading));\n    },\n    showWrapLoading(): boolean {\n      return this.hasContent && this.loading && this.delayCounted;\n    },\n    showFullScreenLoading(): boolean {\n      return this.fullscreen && this.loading && this.delayCounted;\n    },\n    showAttachedLoading(): boolean {\n      return this.attach && this.loading && this.delayCounted;\n    },\n  },\n\n  methods: {\n    countDelay() {\n      this.delayShowLoading = false;\n      const timer = setTimeout(() => {\n        this.delayShowLoading = true;\n        clearTimeout(timer);\n      }, this.delay);\n    },\n  },\n\n  render() {\n    const defaultIndicator = <GradientIcon size={this.size} />;\n    const indicator = this.loading && renderTNodeJSX(this, 'indicator', defaultIndicator);\n    const text = this.showText && <div class={`${prefix}-loading__text`}>{renderTNodeJSX(this, 'text')}</div>;\n\n    // full screen loading\n    if (this.fullscreen) {\n      if (!this.showFullScreenLoading) return null;\n      return (\n        <div class={this.fullScreenClasses} style={this.styles} v-transfer-dom={this.attach}>\n          <div class={this.baseClasses}>\n            {indicator}\n            {text}\n          </div>\n        </div>\n      );\n    }\n\n    // Loading is wrapping a HTMLElement.\n    if (this.hasContent) {\n      return (\n        <div class={relativeClass}>\n          {renderContent(this, 'default', 'content')}\n          {this.showWrapLoading && (\n            <div class={this.withContentClasses} style={this.styles}>\n              {indicator}\n              {text}\n            </div>\n          )}\n        </div>\n      );\n    }\n\n    // transfer parent node\n    if (this.attach) {\n      if (!this.showAttachedLoading) return;\n      return (\n        <div class={this.attachClasses} style={this.styles} v-transfer-dom={this.attach}>\n          {indicator}\n          {text}\n        </div>\n      );\n    }\n\n    // Normal Loading without overlay or content\n    return (\n      <div class={this.normalClasses} style={this.styles}>\n        {indicator}\n        {text}\n      </div>\n    );\n  },\n});\n"],"names":["name","prefix","centerClass","fullscreenClass","lockClass","overlayClass","relativeClass","fullClass","inheritColorClass","Vue","extend","props","directives","TransferDom","data","delayShowLoading","created","delay","countDelay","watch","loading","handler","value","lockFullscreen","addClass","document","body","removeClass","immediate","computed","styles","zIndex","includes","size","showText","Boolean","text","$scopedSlots","baseClasses","SIZE_CLASSNAMES","inheritColor","hasContent","content","withContentClasses","concat","showOverlay","fullScreenClasses","attachClasses","normalClasses","preventScrollThrough","fullscreen","delayCounted","showWrapLoading","showFullScreenLoading","showAttachedLoading","attach","methods","timer","setTimeout","clearTimeout","render","defaultIndicator","GradientIcon","indicator","renderTNodeJSX","renderContent"],"mappings":"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"}