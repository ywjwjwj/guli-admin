{"version":3,"file":"container.js","sources":["../../src/popup/container.tsx"],"sourcesContent":["import Vue from 'vue';\nimport { getAttach, removeDom } from '../utils/dom';\nimport props from './props';\n\nfunction isContentRectChanged(rect1: DOMRectReadOnly, rect2: DOMRectReadOnly) {\n  if (!rect1 || !rect2) return;\n  if (['width', 'height', 'x', 'y'].some((k) => rect1[k] !== rect2[k])) {\n    return true;\n  }\n  return false;\n}\n\nconst Ref = Vue.extend({\n  data() {\n    return {\n      contentRect: null as DOMRectReadOnly,\n    };\n  },\n  mounted() {\n    if (window?.ResizeObserver && this.$el) {\n      const el = this.$el;\n      const vm = this as any;\n      const ro = new ResizeObserver((entries = []) => {\n        const { contentRect } = entries[0] || {};\n        if (isContentRectChanged(contentRect, vm.contentRect)) {\n          vm.contentRect = contentRect;\n          vm.$emit('resize', { ...contentRect });\n          return;\n        }\n        // omit initial change\n        if (!vm.contentRect) {\n          vm.contentRect = contentRect;\n        }\n      });\n      ro.observe(el);\n      this.$on('hook:destroyed', () => {\n        ro.unobserve(el);\n      });\n    }\n  },\n  render() {\n    const children = this.$slots.default || [];\n    if (children.length > 1 || !children[0]?.tag) {\n      return <span>{children}</span>;\n    }\n    return children[0];\n  },\n});\n\nexport default Vue.extend({\n  props: {\n    parent: Object,\n    visible: Boolean,\n    attach: props.attach,\n  },\n  data() {\n    return {\n      content: null as Vue,\n    };\n  },\n  mounted() {\n    if (this.visible) {\n      this.mountContent();\n    }\n    this.$watch('visible', (visible) => {\n      if (visible) {\n        this.mountContent();\n      }\n    });\n  },\n  destroyed() {\n    this.unmountContent();\n  },\n  methods: {\n    mountContent() {\n      if (this.content) return;\n      // eslint-disable-next-line @typescript-eslint/no-this-alias\n      const parent = this;\n      const elm = document.createElement('div');\n      elm.style.cssText = 'position: absolute; top: 0px; left: 0px; width: 100%';\n      elm.appendChild(document.createElement('div'));\n      this.content = new (this.$root.constructor as any)({\n        parent,\n        render() {\n          return <div>{parent.$slots.content}</div>;\n        },\n        mounted() {\n          parent.$emit('mounted');\n        },\n        destroyed() {\n          parent.content = null;\n          removeDom(elm);\n        },\n      });\n      getAttach(this.attach).appendChild(elm);\n      this.content.$mount(elm.children[0]);\n    },\n    unmountContent() {\n      this.content?.$destroy();\n    },\n    updateContent() {\n      this.content?.$forceUpdate();\n    },\n  },\n  render() {\n    return <Ref onResize={(ev: DOMRectReadOnly) => this.$emit('refResize', ev)}>{this.$slots.default}</Ref>;\n  },\n});\n"],"names":["isContentRectChanged","rect1","rect2","some","k","Ref","Vue","extend","data","contentRect","mounted","window","ResizeObserver","$el","el","vm","ro","entries","$emit","observe","$on","unobserve","render","children","$slots","length","tag","props","parent","Object","visible","Boolean","attach","content","mountContent","$watch","destroyed","unmountContent","methods","elm","document","createElement","style","cssText","appendChild","$root","constructor","removeDom","getAttach","$mount","$destroy","updateContent","$forceUpdate","ev"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAGA,SAASA,oBAAT,CAA8BC,KAA9B,EAAqCC,KAArC,EAA4C;AAC1C,EAAA,IAAI,CAACD,KAAD,IAAU,CAACC,KAAf,EACE,OAAA;;AACF,EAAA,IAAI,CAAC,OAAD,EAAU,QAAV,EAAoB,GAApB,EAAyB,GAAzB,CAA8BC,CAAAA,IAA9B,CAAmC,UAACC,CAAD,EAAA;AAAA,IAAOH,OAAAA,KAAK,CAACG,CAAD,CAAL,KAAaF,KAAK,CAACE,CAAD,CAAzB,CAAA;AAAA,GAAnC,CAAJ,EAAsE;AACpE,IAAA,OAAO,IAAP,CAAA;AACD,GAAA;;AACD,EAAA,OAAO,KAAP,CAAA;AACD,CAAA;;AACD,IAAMC,GAAG,GAAGC,uBAAG,CAACC,MAAJ,CAAW;AACrBC,EAAAA,IADqB,EACd,SAAA,IAAA,GAAA;AACL,IAAO,OAAA;AACLC,MAAAA,WAAW,EAAE,IAAA;AADR,KAAP,CAAA;AAGD,GALoB;AAMrBC,EAAAA,OANqB,EAMX,SAAA,OAAA,GAAA;AAAA,IAAA,IAAA,OAAA,CAAA;;AACR,IAAI,IAAA,CAAA,OAAA,GAAAC,MAAM,MAAN,IAAA,IAAA,OAAA,KAAA,KAAA,CAAA,IAAA,OAAA,CAAQC,cAAR,IAA0B,IAAA,CAAKC,GAAnC,EAAwC;AACtC,MAAMC,IAAAA,EAAE,GAAG,IAAA,CAAKD,GAAhB,CAAA;AACA,MAAME,IAAAA,EAAE,GAAG,IAAX,CAAA;AACA,MAAA,IAAMC,EAAE,GAAG,IAAIJ,cAAJ,CAAmB,YAAkB;AAAA,QAAjBK,IAAAA,OAAiB,uEAAP,EAAO,CAAA;;AAC9C,QAAA,IAAA,IAAA,GAAwBA,OAAO,CAAC,CAAD,CAAP,IAAc,EAAtC;AAAA,YAAQR,WAAR,QAAQA,WAAR,CAAA;;AACA,QAAIT,IAAAA,oBAAoB,CAACS,WAAD,EAAcM,EAAE,CAACN,WAAjB,CAAxB,EAAuD;AACrDM,UAAAA,EAAE,CAACN,WAAH,GAAiBA,WAAjB,CAAA;AACAM,UAAAA,EAAE,CAACG,KAAH,CAAS,QAAT,oBAAwBT,WAAxB,CAAA,CAAA,CAAA;AACA,UAAA,OAAA;AACD,SAAA;;AACD,QAAA,IAAI,CAACM,EAAE,CAACN,WAAR,EAAqB;AACnBM,UAAAA,EAAE,CAACN,WAAH,GAAiBA,WAAjB,CAAA;AACD,SAAA;AACF,OAVU,CAAX,CAAA;AAWAO,MAAAA,EAAE,CAACG,OAAH,CAAWL,EAAX,CAAA,CAAA;AACA,MAAA,IAAA,CAAKM,GAAL,CAAS,gBAAT,EAA2B,YAAM;AAC/BJ,QAAAA,EAAE,CAACK,SAAH,CAAaP,EAAb,CAAA,CAAA;AACD,OAFD,CAAA,CAAA;AAGD,KAAA;AACF,GA1BoB;AA2BrBQ,EAAAA,MA3BqB,EA2BZ,SAAA,MAAA,GAAA;AAAA,IAAA,IAAA,UAAA,CAAA;;AAAA,IAAA,IAAA,CAAA,GAAA,SAAA,CAAA,CAAA,CAAA,CAAA;AACP,IAAA,IAAMC,QAAQ,GAAG,IAAKC,CAAAA,MAAL,eAAuB,EAAxC,CAAA;;AACA,IAAA,IAAID,QAAQ,CAACE,MAAT,GAAkB,CAAlB,IAAuB,EAAA,CAAA,UAAA,GAACF,QAAQ,CAAC,CAAD,CAAT,MAAA,IAAA,IAAA,UAAA,KAAA,KAAA,CAAA,IAAC,UAAaG,CAAAA,GAAd,CAA3B,EAA8C;AAC5C,MAAA,OAAA,CAAA,CAAA,MAAA,EAAA,CAAcH,QAAd,CAAA,CAAA,CAAA;AACD,KAAA;;AACD,IAAOA,OAAAA,QAAQ,CAAC,CAAD,CAAf,CAAA;AACD,GAAA;AAjCoB,CAAX,CAAZ,CAAA;AAmCA,gBAAejB,uBAAG,CAACC,MAAJ,CAAW;AACxBoB,EAAAA,KAAK,EAAE;AACLC,IAAAA,MAAM,EAAEC,MADH;AAELC,IAAAA,OAAO,EAAEC,OAFJ;AAGLC,IAAAA,MAAM,EAAEL,sBAAK,CAACK,MAAAA;AAHT,GADiB;AAMxBxB,EAAAA,IANwB,EAMjB,SAAA,IAAA,GAAA;AACL,IAAO,OAAA;AACLyB,MAAAA,OAAO,EAAE,IAAA;AADJ,KAAP,CAAA;AAGD,GAVuB;AAWxBvB,EAAAA,OAXwB,EAWd,SAAA,OAAA,GAAA;AAAA,IAAA,IAAA,KAAA,GAAA,IAAA,CAAA;;AACR,IAAI,IAAA,IAAA,CAAKoB,OAAT,EAAkB;AAChB,MAAA,IAAA,CAAKI,YAAL,EAAA,CAAA;AACD,KAAA;;AACD,IAAA,IAAA,CAAKC,MAAL,CAAY,SAAZ,EAAuB,UAACL,OAAD,EAAa;AAClC,MAAA,IAAIA,OAAJ,EAAa;AACX,QAAA,KAAI,CAACI,YAAL,EAAA,CAAA;AACD,OAAA;AACF,KAJD,CAAA,CAAA;AAKD,GApBuB;AAqBxBE,EAAAA,SArBwB,EAqBZ,SAAA,SAAA,GAAA;AACV,IAAA,IAAA,CAAKC,cAAL,EAAA,CAAA;AACD,GAvBuB;AAwBxBC,EAAAA,OAAO,EAAE;AACPJ,IAAAA,YADO,EACQ,SAAA,YAAA,GAAA;AAAA,MAAA,IAAA,CAAA,eAAA;AACb,MAAI,IAAA,IAAA,CAAKD,OAAT,EACE,OAAA;AACF,MAAML,IAAAA,MAAM,GAAG,IAAf,CAAA;AACA,MAAA,IAAMW,GAAG,GAAGC,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAZ,CAAA;AACAF,MAAAA,GAAG,CAACG,KAAJ,CAAUC,OAAV,GAAoB,sDAApB,CAAA;AACAJ,MAAAA,GAAG,CAACK,WAAJ,CAAgBJ,QAAQ,CAACC,aAAT,CAAuB,KAAvB,CAAhB,CAAA,CAAA;AACA,MAAA,IAAA,CAAKR,OAAL,GAAe,IAAI,KAAKY,KAAL,CAAWC,WAAf,CAA2B;AACxClB,QAAAA,MAAM,EAANA,MADwC;AAExCN,QAAAA,MAFwC,EAE/B,SAAA,MAAA,GAAA;AAAA,UAAA,IAAA,CAAA,GAAA,SAAA,CAAA,CAAA,CAAA,CAAA;AACP,UAAA,OAAA,CAAA,CAAA,KAAA,EAAA,CAAaM,MAAM,CAACJ,MAAP,CAAcS,OAA3B,CAAA,CAAA,CAAA;AACD,SAJuC;AAKxCvB,QAAAA,OALwC,EAK9B,SAAA,OAAA,GAAA;AACRkB,UAAAA,MAAM,CAACV,KAAP,CAAa,SAAb,CAAA,CAAA;AACD,SAPuC;AAQxCkB,QAAAA,SARwC,EAQ5B,SAAA,SAAA,GAAA;AACVR,UAAAA,MAAM,CAACK,OAAP,GAAiB,IAAjB,CAAA;AACAc,UAAAA,mBAAS,CAACR,GAAD,CAAT,CAAA;AACD,SAAA;AAXuC,OAA3B,CAAf,CAAA;AAaAS,MAAAA,mBAAS,CAAC,IAAKhB,CAAAA,MAAN,CAAT,CAAuBY,WAAvB,CAAmCL,GAAnC,CAAA,CAAA;AACA,MAAKN,IAAAA,CAAAA,OAAL,CAAagB,MAAb,CAAoBV,GAAG,CAAChB,QAAJ,CAAa,CAAb,CAApB,CAAA,CAAA;AACD,KAvBM;AAwBPc,IAAAA,cAxBO,EAwBU,SAAA,cAAA,GAAA;AAAA,MAAA,IAAA,aAAA,CAAA;;AACf,MAAKJ,CAAAA,aAAAA,GAAAA,IAAAA,CAAAA,OAAL,gEAAciB,QAAd,EAAA,CAAA;AACD,KA1BM;AA2BPC,IAAAA,aA3BO,EA2BS,SAAA,aAAA,GAAA;AAAA,MAAA,IAAA,cAAA,CAAA;;AACd,MAAKlB,CAAAA,cAAAA,GAAAA,IAAAA,CAAAA,OAAL,kEAAcmB,YAAd,EAAA,CAAA;AACD,KAAA;AA7BM,GAxBe;AAuDxB9B,EAAAA,MAvDwB,EAuDf,SAAA,MAAA,GAAA;AAAA,IAAA,IAAA,MAAA,GAAA,IAAA,CAAA;;AAAA,IAAA,IAAA,CAAA,GAAA,SAAA,CAAA,CAAA,CAAA,CAAA;AACP,IAAA,OAAA,CAAA,CAAA,GAAA,EAAA;AAAA,MAAA,IAAA,EAAA;AAAA,QAAA,QAAA,EAAsB,gBAAC+B,EAAD,EAAA;AAAA,UAAA,OAAQ,MAAI,CAACnC,KAAL,CAAW,WAAX,EAAwBmC,EAAxB,CAAR,CAAA;AAAA,SAAA;AAAtB,OAAA;AAAA,KAA4D,EAAA,CAAA,IAAA,CAAK7B,MAAL,CAA5D,SAAA,CAAA,CAAA,CAAA,CAAA;AACD,GAAA;AAzDuB,CAAX,CAAf;;;;"}