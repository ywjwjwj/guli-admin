{"version":3,"file":"popup.js","sources":["../../src/popup/popup.tsx"],"sourcesContent":["import Vue, { VNodeDirective } from 'vue';\nimport { createPopper, Placement } from '@popperjs/core';\nimport { prefix } from '../config';\nimport CLASSNAMES from '../utils/classnames';\nimport { on, off, once } from '../utils/dom';\nimport { renderTNodeJSX, renderContent } from '../utils/render-tnode';\nimport { getIEVersion } from '../utils/helper';\nimport setStyle from '../_common/js/utils/set-style';\nimport props from './props';\nimport { PopupVisibleChangeContext, TdPopupProps } from './type';\nimport { Styles, ClassName } from '../common';\nimport Container from './container';\n\nconst name = `${prefix}-popup`;\nconst showTimeout = 250;\nconst hideTimeout = 150;\nconst triggers = ['click', 'hover', 'focus', 'context-menu'] as const;\n\nfunction getPopperPlacement(placement: TdPopupProps['placement']) {\n  return placement.replace(/-(left|top)$/, '-start').replace(/-(right|bottom)$/, '-end') as Placement;\n}\n\nexport default Vue.extend({\n  name: 'TPopup',\n\n  provide(this: any) {\n    return {\n      popup: this,\n    };\n  },\n\n  inject: {\n    popup: {\n      default: undefined,\n    },\n  },\n\n  props: {\n    ...props,\n    expandAnimation: {\n      type: Boolean,\n    },\n  },\n\n  data() {\n    return {\n      name,\n      /** popperjs instance */\n      popper: null as ReturnType<typeof createPopper>,\n      /** timeout id */\n      timeout: null,\n      hasDocumentEvent: false,\n      /** if a trusted action (opening or closing) is prevented, increase this flag */\n      visibleState: 0,\n      mouseInRange: false,\n      /** mark popup as clicked when mousedown, reset after mouseup */\n      contentClicked: false,\n      /**\n       * mark reference as clicked when click,\n       * reset after click event bubbles to document */\n      refClicked: false,\n    };\n  },\n  computed: {\n    overlayClasses(): ClassName {\n      const base = [\n        `${name}__content`,\n        {\n          [`${name}__content--text`]: this.content === 'string',\n          [`${name}__content--arrow`]: this.showArrow,\n          [CLASSNAMES.STATUS.disabled]: this.disabled,\n        },\n      ] as ClassName;\n      return base.concat(this.overlayClassName);\n    },\n    hasTrigger(): Record<typeof triggers[number], boolean> {\n      return triggers.reduce(\n        (map, trigger) => ({\n          ...map,\n          [trigger]: this.trigger.includes(trigger),\n        }),\n        {} as any,\n      );\n    },\n  },\n  watch: {\n    visible(val) {\n      const reference = this.$el;\n      const { hasTrigger } = this;\n      if (val) {\n        this.preventClosing(true);\n        if (!this.hasDocumentEvent) {\n          on(document, 'click', this.handleDocumentClick);\n          this.hasDocumentEvent = true;\n        }\n        // focus trigger esc 隐藏浮层\n        if (reference && hasTrigger.focus) {\n          once(reference, 'keydown', (ev: KeyboardEvent) => {\n            if (ev.code === 'Escape') {\n              this.handleClose({ trigger: 'keydown-esc' });\n            }\n          });\n        }\n      } else {\n        this.preventClosing(false);\n        // destruction is delayed until after animation ends\n        off(document, 'click', this.handleDocumentClick);\n        this.hasDocumentEvent = false;\n        this.mouseInRange = false;\n      }\n    },\n    overlayStyle() {\n      if (this.popper) {\n        this.popper.update();\n        this.updateOverlayStyle();\n      }\n    },\n    // sync lock state recursively\n    contentClicked(clicked) {\n      if ((this as any).popup) {\n        (this as any).popup.contentClicked = clicked;\n      }\n    },\n  },\n  mounted() {\n    const reference = this.$el;\n    const { hasTrigger } = this;\n\n    if (hasTrigger.hover) {\n      on(reference, 'mouseenter', () => this.handleOpen({ trigger: 'trigger-element-hover' }));\n      on(reference, 'mouseleave', () => this.handleClose({ trigger: 'trigger-element-hover' }));\n      on(reference, 'click', () => {\n        this.refClicked = true;\n      });\n    } else if (hasTrigger.focus) {\n      on(reference, 'focusin', () => this.handleOpen({ trigger: 'trigger-element-focus' }));\n      on(reference, 'focusout', () => this.handleClose({ trigger: 'trigger-element-blur' }));\n    } else if (hasTrigger.click) {\n      on(reference, 'click', (e: MouseEvent) => {\n        this.refClicked = true;\n        // override nested popups with trigger hover since higher priority\n        this.visibleState = 0;\n        this.handleToggle({ e, trigger: 'trigger-element-click' });\n        // ie9-10 trigger propagation\n        if (getIEVersion() < 11) {\n          this.handleDocumentClick();\n        }\n      });\n    } else if (hasTrigger['context-menu']) {\n      on(reference, 'contextmenu', (e: MouseEvent) => {\n        e.preventDefault();\n        // MouseEvent.button\n        // 2: Secondary button pressed, usually the right button\n        e.button === 2 && this.handleToggle({ trigger: 'context-menu' });\n      });\n    }\n  },\n  updated() {\n    (this.$refs.container as any)?.updateContent();\n  },\n  destroyed() {\n    this.destroyPopper();\n  },\n  methods: {\n    createPopper() {\n      const reference = this.$el;\n      const currentPlacement = this.placement;\n      const popperElm = this.$refs.popper as HTMLElement;\n\n      if (!popperElm) return;\n\n      this.popper?.destroy();\n\n      this.popper = createPopper(reference, popperElm, {\n        modifiers:\n          getIEVersion() > 9\n            ? []\n            : [\n              {\n                name: 'computeStyles',\n                options: {\n                  // 默认为 true，即使用 transform 定位，开启 gpu 加速\n                  // ie9 不支持 transform，需要添加 -ms- 前缀，@popperjs/core 没有添加这个样式，\n                  // 在 ie9 下则去掉 gpu 优化加速，使用 top, right, bottom, left 定位\n                  gpuAcceleration: false,\n                },\n              },\n            ],\n        placement: getPopperPlacement(currentPlacement),\n        onFirstUpdate: () => {\n          this.$nextTick(this.updatePopper);\n        },\n      });\n    },\n\n    updatePopper() {\n      if (this.popper) {\n        this.popper.update();\n        return;\n      }\n      this.createPopper();\n    },\n\n    updateOverlayStyle() {\n      const { overlayStyle } = this;\n      const referenceElm = this.$el as HTMLElement;\n      if (!this.$refs) return;\n      const refOverlayElm = this.$refs.overlay as HTMLElement;\n      if (typeof overlayStyle === 'function' && referenceElm && refOverlayElm) {\n        const userOverlayStyle = overlayStyle(referenceElm, refOverlayElm);\n        this.setOverlayStyle(userOverlayStyle);\n      } else if (typeof overlayStyle === 'object' && refOverlayElm) {\n        this.setOverlayStyle(overlayStyle);\n      }\n    },\n\n    setOverlayStyle(styles: Styles) {\n      if (!this.$refs) return;\n      const refOverlayElm = this.$refs.overlay as HTMLElement;\n      if (typeof styles === 'object' && refOverlayElm) {\n        setStyle(refOverlayElm, styles);\n      }\n    },\n\n    /**\n     * destroy popper IF NEEDED\n     */\n    destroyPopper() {\n      this.popper?.destroy();\n      this.popper = null;\n      if (this.destroyOnClose) {\n        (this.$refs.container as any)?.unmountContent();\n      }\n    },\n\n    handleToggle(context: PopupVisibleChangeContext) {\n      this.emitPopVisible(!this.visible, context);\n    },\n    handleOpen(context: Pick<PopupVisibleChangeContext, 'trigger'>) {\n      clearTimeout(this.timeout);\n      this.timeout = setTimeout(\n        () => {\n          this.emitPopVisible(true, context);\n        },\n        this.hasTrigger.click ? 0 : showTimeout,\n      );\n    },\n    handleClose(context: Pick<PopupVisibleChangeContext, 'trigger'>) {\n      clearTimeout(this.timeout);\n      this.timeout = setTimeout(\n        () => {\n          this.emitPopVisible(false, context);\n        },\n        this.hasTrigger.click ? 0 : hideTimeout,\n      );\n    },\n    handleDocumentClick() {\n      if (this.contentClicked || this.refClicked) {\n        this.refClicked = false;\n        // clear the flag if mouseup handler is failed\n        setTimeout(() => {\n          this.contentClicked = false;\n        });\n        return;\n      }\n      this.visibleState = 0;\n      this.emitPopVisible(false, { trigger: 'document' });\n    },\n    emitPopVisible(val: boolean, context: PopupVisibleChangeContext) {\n      if (this.disabled || val === this.visible) return;\n      if (!val && this.visibleState > 1) return;\n      if (val && this.mouseInRange) return;\n      this.$emit('visible-change', val, context);\n      if (typeof this.onVisibleChange === 'function') {\n        this.onVisibleChange(val, context);\n      }\n    },\n    onMouseEnter() {\n      this.mouseInRange = true;\n      this.handleOpen({});\n    },\n    onMouseLeave(ev: MouseEvent) {\n      // 子元素存在打开的 popup 时，ui 可能重叠，而 dom 节点多是并列关系\n      // 需要做碰撞检测去阻止父级 popup 关闭\n      if (this.visibleState > 1) {\n        const rect = (this.$refs.popper as HTMLElement).getBoundingClientRect();\n        if (ev.x > rect.x && ev.x < rect.x + rect.width && ev.y > rect.y && ev.y < rect.y + rect.height) return;\n      }\n      this.mouseInRange = false;\n      this.handleClose({});\n\n      // parent can no longer monitor mouse leave\n      const parent = (this as any).popup;\n      if (parent?.mouseInRange) {\n        parent.onMouseLeave(ev);\n      }\n    },\n    onBeforeEnter() {\n      if (this.visible) {\n        this.updatePopper();\n      }\n    },\n    onAfterEnter() {\n      if (this.visible) {\n        this.updatePopper();\n      }\n    },\n    preventClosing(preventing: boolean) {\n      const parent = (this as any).popup;\n      parent?.preventClosing(preventing);\n      if (preventing) {\n        this.visibleState += 1;\n      } else if (this.visibleState) {\n        this.visibleState -= 1;\n        if (!this.visibleState) {\n          this.emitPopVisible(false, {});\n          if (parent?.hasTrigger.hover && !parent?.mouseInRange) {\n            parent.emitPopVisible(false, {});\n          }\n        }\n      }\n    },\n  },\n\n  render(h) {\n    const {\n      visible, destroyOnClose, hasTrigger, onScroll,\n    } = this;\n    const ref = renderContent(this, 'default', 'triggerElement');\n    const content = renderTNodeJSX(this, 'content');\n\n    if (this.hideEmptyPopup && ['', undefined, null].includes(content)) {\n      return ref;\n    }\n\n    const overlay = visible || !destroyOnClose\n      ? h(\n        'div',\n        {\n          class: name,\n          ref: 'popper',\n          directives: destroyOnClose\n            ? undefined\n            : [\n                    {\n                      name: 'show',\n                      rawName: 'v-show',\n                      value: visible,\n                      expression: 'visible',\n                    } as VNodeDirective,\n            ],\n          on: {\n            mousedown: () => {\n              this.contentClicked = true;\n            },\n            mouseup: () => {\n              // make sure to execute after document click is triggered\n              setTimeout(() => {\n                // clear the flag which was set by mousedown\n                this.contentClicked = false;\n              });\n            },\n            ...(hasTrigger.hover && {\n              mouseenter: this.onMouseEnter,\n              mouseleave: this.onMouseLeave,\n            }),\n          },\n        },\n        [\n          h(\n            'div',\n            {\n              class: this.overlayClasses,\n              ref: 'overlay',\n              on: onScroll\n                ? {\n                  scroll(e: WheelEvent) {\n                    onScroll({ e });\n                  },\n                }\n                : undefined,\n            },\n            [content, this.showArrow && h('div', { class: `${name}__arrow` })],\n          ),\n        ],\n      )\n      : null;\n\n    return (\n      <Container\n        ref=\"container\"\n        onMounted={() => {\n          if (visible) {\n            this.updatePopper();\n            this.updateOverlayStyle();\n          }\n        }}\n        onRefResize={() => {\n          if (visible) {\n            this.updatePopper();\n          }\n        }}\n        parent={this}\n        visible={visible}\n        attach={this.attach}\n      >\n        <transition\n          slot=\"content\"\n          name={this.expandAnimation ? `${name}--animation-expand` : `${name}--animation`}\n          appear\n          onBeforeEnter={this.onBeforeEnter}\n          onAfterEnter={this.onAfterEnter}\n          onAfterLeave={this.destroyPopper}\n        >\n          {(visible || !destroyOnClose) && overlay}\n        </transition>\n        {ref}\n      </Container>\n    );\n  },\n});\n"],"names":["name","prefix","showTimeout","hideTimeout","triggers","getPopperPlacement","placement","replace","Vue","extend","provide","popup","inject","props","expandAnimation","type","Boolean","data","popper","timeout","hasDocumentEvent","visibleState","mouseInRange","contentClicked","refClicked","computed","overlayClasses","base","_defineProperty","content","showArrow","CLASSNAMES","STATUS","disabled","concat","overlayClassName","hasTrigger","reduce","map","trigger","includes","watch","visible","val","reference","$el","preventClosing","on","document","handleDocumentClick","focus","once","ev","code","handleClose","off","overlayStyle","update","updateOverlayStyle","clicked","mounted","hover","handleOpen","click","e","handleToggle","getIEVersion","preventDefault","button","updated","$refs","container","updateContent","destroyed","destroyPopper","methods","createPopper","currentPlacement","popperElm","destroy","modifiers","options","gpuAcceleration","onFirstUpdate","$nextTick","updatePopper","referenceElm","refOverlayElm","overlay","userOverlayStyle","setOverlayStyle","_typeof","styles","setStyle","destroyOnClose","unmountContent","context","emitPopVisible","clearTimeout","setTimeout","$emit","onVisibleChange","onMouseEnter","onMouseLeave","rect","getBoundingClientRect","x","width","y","height","parent","onBeforeEnter","onAfterEnter","preventing","render","h","onScroll","ref","renderContent","renderTNodeJSX","hideEmptyPopup","directives","rawName","value","expression","mousedown","mouseup","mouseenter","mouseleave","scroll","Container","attach"],"mappings":"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"}