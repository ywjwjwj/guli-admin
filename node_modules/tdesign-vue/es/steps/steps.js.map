{"version":3,"file":"steps.js","sources":["../../src/steps/steps.tsx"],"sourcesContent":["import { VNode } from 'vue';\nimport { prefix } from '../config';\nimport props from './props';\nimport TStepItem from './step-item';\nimport { ClassName } from '../common';\nimport mixins from '../utils/mixins';\nimport getConfigReceiverMixins from '../config-provider/config-receiver';\nimport { TdStepsProps, TdStepItemProps } from './type';\nimport { emitEvent } from '../utils/event';\n\nconst name = `${prefix}-steps`;\nexport default mixins(getConfigReceiverMixins('steps')).extend({\n  name: 'TSteps',\n  components: {\n    TStepItem,\n  },\n  props: { ...props },\n  data() {\n    return {\n      stepChildren: [],\n      indexMap: {},\n    };\n  },\n  provide(): { steps: any } {\n    return {\n      steps: this,\n    };\n  },\n  watch: {\n    options: {\n      immediate: true,\n      handler() {\n        if (!this.options) return;\n        this.options.forEach((item, index) => {\n          if (item.value !== undefined) {\n            this.indexMap[item.value] = index;\n          }\n        });\n      },\n    },\n  },\n  computed: {\n    baseClass(): ClassName {\n      if (this.direction) {\n        console.warn('TDesign Steps Warn: `direction` is going to be deprecated. please use `layout` instead. ');\n      }\n      const layout = this.layout || this.direction || 'horizontal';\n      return [\n        name,\n        `${name}--${layout}`,\n        `${name}--${this.handleTheme()}-anchor`,\n        {\n          [`${name}--${this.sequence}`]: layout === 'vertical',\n        },\n      ];\n    },\n  },\n  render() {\n    const nodes = this.$scopedSlots?.default && this.$scopedSlots.default(null);\n    const options = this.getOptions();\n    const content = options.map((item, index) => {\n      const propsData = {\n        ...item,\n        status: this.handleStatus(item, index),\n      };\n\n      const stepItem = (\n        <t-step-item\n          props={{\n            ...item,\n            status: this.handleStatus(item, index),\n          }}\n          key={item.value || index}\n        ></t-step-item>\n      );\n\n      if (nodes && nodes[index]) {\n        const vnode = nodes[index];\n        if (vnode.componentOptions) {\n          vnode.componentOptions.propsData = propsData;\n          return vnode;\n        }\n        return stepItem;\n      }\n      return stepItem;\n    });\n    return <div class={this.baseClass}>{content}</div>;\n  },\n  methods: {\n    getOptions() {\n      const nodes = this.$scopedSlots?.default && this.$scopedSlots.default(null);\n      let options: Array<TdStepItemProps>;\n      if (this.options && this.options.length) {\n        options = this.options;\n      } else {\n        options = this.getOptionListBySlots(nodes);\n      }\n      return options;\n    },\n    getOptionListBySlots(nodes: VNode[]) {\n      const arr: Array<TdStepItemProps> = [];\n      nodes?.forEach((node) => {\n        const option = node?.componentOptions?.propsData;\n        option && arr.push(option);\n      });\n      return arr;\n    },\n    handleTheme() {\n      let { theme } = this;\n      const options = this.getOptions();\n      options.forEach((item) => {\n        if (item?.icon !== undefined) {\n          // icon > theme\n          theme = 'default';\n        }\n      });\n      return theme;\n    },\n    handleStatus(item: TdStepItemProps, index: number) {\n      if (item.status && item.status !== 'default') return item.status;\n      if (this.current === 'FINISH') return 'finish';\n      // value 不存在时，使用 index 进行区分每一个步骤\n      if (item.value === undefined && index < this.current) return 'finish';\n      // value 存在，找匹配位置\n      if (item.value !== undefined) {\n        const matchIndex = this.indexMap[this.current];\n        if (matchIndex === undefined) {\n          console.warn('TDesign Steps Warn: The current `value` is not exist.');\n          return 'default';\n        }\n        if (index < matchIndex) return 'finish';\n      }\n      const key = item.value === undefined ? index : item.value;\n      if (key === this.current) return 'process';\n      return 'default';\n    },\n    addItem(item: InstanceType<typeof TStepItem>) {\n      const index = this.stepChildren.length;\n      // eslint-disable-next-line\n      item.index = index;\n      this.stepChildren.push(item);\n    },\n    removeItem(item: InstanceType<typeof TStepItem>) {\n      this.stepChildren = this.stepChildren.filter((t) => t !== item);\n    },\n    handleChange(cur: TdStepsProps['current'], prev: TdStepsProps['current'], e: MouseEvent) {\n      emitEvent<Parameters<TdStepsProps['onChange']>>(this, 'change', cur, prev, { e });\n    },\n  },\n});\n"],"names":["name","prefix","mixins","getConfigReceiverMixins","extend","components","TStepItem","props","data","stepChildren","indexMap","provide","steps","watch","options","immediate","handler","forEach","item","index","value","computed","baseClass","direction","console","warn","layout","handleTheme","sequence","render","nodes","$scopedSlots","getOptions","content","map","propsData","status","handleStatus","stepItem","_mergeJSXProps","vnode","componentOptions","methods","length","getOptionListBySlots","arr","node","option","push","theme","icon","current","matchIndex","key","addItem","removeItem","filter","t","handleChange","cur","prev","e","emitEvent"],"mappings":"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"}