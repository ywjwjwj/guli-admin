{"version":3,"file":"index.js","sources":["../../../src/table/primary-table/index.tsx"],"sourcesContent":["import baseTableProps from '../base-table-props';\nimport {\n  DataType, TdBaseTableProps, TdPrimaryTableProps, PrimaryTableCol,\n} from '../type';\n\nimport primaryTableProps from '../primary-table-props';\nimport BaseTable from '../base-table';\nimport mixins from '../../utils/mixins';\nimport expand from './mixins/expand';\nimport select from './mixins/select';\nimport sort from './mixins/sort';\nimport rowDraggable from './mixins/row-draggable';\nimport filter from './mixins/filter';\nimport showColumns from './mixins/show-columns';\nimport asyncLoadingMixin from './mixins/async-loading';\nimport { PageInfo } from '../../pagination/type';\nimport { emitEvent } from '../../utils/event';\nimport { renderTNodeJSX } from '../../utils/render-tnode';\n\ntype PageChangeContext = Parameters<TdBaseTableProps['onPageChange']>;\ntype ChangeContext = Parameters<TdPrimaryTableProps['onChange']>;\n\nexport default mixins(expand, select, sort, rowDraggable, filter, showColumns, asyncLoadingMixin).extend({\n  name: 'TTable',\n  props: {\n    ...baseTableProps,\n    ...primaryTableProps,\n  },\n  computed: {\n    rehandleColumns(): Array<PrimaryTableCol> {\n      let columns = this.columns.map((col) => ({ ...col }));\n      columns = this.getShowColumns([...this.columns]);\n      columns = this.getSorterColumns(columns);\n      columns = this.getFilterColumns(columns);\n      columns = this.getSelectColumns(columns);\n      columns = this.getExpandColumns(columns);\n      return columns;\n    },\n  },\n  created() {\n    if (typeof this.$attrs['expanded-row-render'] !== 'undefined') {\n      console.warn('The expandedRowRender prop is deprecated. Use expandedRow instead.');\n    }\n  },\n  methods: {\n    // 最后一行，通行数据，可能是异步加载状态，可能是其他\n    renderLastFullRow() {\n      const lastFullRow = renderTNodeJSX(this, 'lastFullRow');\n      const asyncLoadingNode = this.renderAsyncLoadingRow();\n      const nodes = [lastFullRow, asyncLoadingNode].filter((v) => ![undefined, null, false].includes(v));\n      if (nodes.length === 0) return null;\n      if (nodes.length === 1) return nodes[0];\n      return (\n        <div>\n          {nodes[0]}\n          {nodes[1]}\n        </div>\n      );\n    },\n  },\n  render() {\n    const { $props, $scopedSlots, rehandleColumns } = this;\n    const scopedSlots = {\n      ...$scopedSlots,\n    };\n    const on = {\n      ...this.$listeners,\n      'page-change': (pageInfo: PageInfo, newDataSource: Array<DataType>) => {\n        emitEvent<PageChangeContext>(this, 'page-change', pageInfo, newDataSource);\n        emitEvent<ChangeContext>(\n          this,\n          'change',\n          { pagination: pageInfo },\n          { trigger: 'pagination', currentData: newDataSource },\n        );\n      },\n      'row-dragstart': this.onDragStart,\n      'row-dragover': this.onDragOver,\n    };\n    if (this.expandOnRowClick) {\n      on['row-click'] = (params: { row: Record<string, any>; index: number }) => {\n        this.handleExpandChange(params.row);\n      };\n    }\n    const baseTableProps = {\n      props: {\n        ...$props,\n        columns: rehandleColumns,\n        provider: {\n          renderExpandedRow: this.expandedRow ?? this.$scopedSlots.expandedRow ? this.renderExpandedRow : undefined,\n          sortOnRowDraggable: this.sortOnRowDraggable,\n          dragging: this.dragging,\n        },\n        // this.hasFilterCondition is from mixins/filter.tsx\n        firstFullRow: this.hasFilterCondition ? this.renderFirstFilterRow : this.firstFullRow,\n        lastFullRow: this.renderLastFullRow,\n        empty: this.empty,\n        topContent: this.columnController ? this.renderShowColumns() : '',\n      },\n      scopedSlots,\n      on,\n    };\n    return <BaseTable {...baseTableProps} />;\n  },\n});\n"],"names":["mixins","expand","select","sort","rowDraggable","filter","showColumns","asyncLoadingMixin","extend","name","props","baseTableProps","primaryTableProps","computed","rehandleColumns","columns","map","col","getShowColumns","getSorterColumns","getFilterColumns","getSelectColumns","getExpandColumns","created","$attrs","console","warn","methods","renderLastFullRow","lastFullRow","renderTNodeJSX","asyncLoadingNode","renderAsyncLoadingRow","nodes","v","includes","length","render","$props","$scopedSlots","scopedSlots","on","$listeners","pageInfo","newDataSource","emitEvent","pagination","trigger","currentData","onDragStart","onDragOver","expandOnRowClick","params","handleExpandChange","row","baseTableProps2","provider","renderExpandedRow","expandedRow","sortOnRowDraggable","dragging","firstFullRow","hasFilterCondition","renderFirstFilterRow","empty","topContent","columnController","renderShowColumns","BaseTable","_mergeJSXProps"],"mappings":"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"}