{"version":3,"file":"useTagList.js","sources":["../../src/tag-input/useTagList.tsx"],"sourcesContent":["import { ref, toRefs } from '@vue/composition-api';\nimport { TagInputValue, TdTagInputProps, TagInputChangeContext } from './type';\nimport { InputValue } from '../input';\nimport Tag from '../tag';\nimport { prefix } from '../config';\nimport useVModel from '../hooks/useVModel';\nimport { useTNodeJSX } from '../hooks/tnode';\n\nexport type ChangeParams = [TagInputChangeContext];\n\n// handle tag add and remove\nexport default function useTagList(props: TdTagInputProps) {\n  const renderTNode = useTNodeJSX();\n  const {\n    value, onRemove, max, minCollapsedNum, size, disabled, readonly, tagProps,\n  } = toRefs(props);\n\n  // handle controlled property and uncontrolled property\n  const [tagValue, setTagValue] = useVModel(value, props.defaultValue || [], props.onChange, 'change');\n  // const { onChange } = props;\n  const oldInputValue = ref<InputValue>();\n\n  // 点击标签关闭按钮，删除标签\n  const onClose = (p: { e?: MouseEvent; index: number; item: string | number }) => {\n    const arr = [...tagValue.value];\n    arr.splice(p.index, 1);\n    setTagValue(arr, { trigger: 'tag-remove', ...p });\n    onRemove.value?.({ ...p, trigger: 'tag-remove', value: arr });\n  };\n\n  const clearAll = (context: { e: MouseEvent }) => {\n    setTagValue([], { trigger: 'clear', e: context.e });\n  };\n\n  // 按下 Enter 键，新增标签\n  const onInnerEnter = (value: InputValue, context: { e: KeyboardEvent }) => {\n    const valueStr = String(value).trim();\n    if (!valueStr) return;\n    const isLimitExceeded = max && tagValue.value?.length >= max.value;\n    let newValue: TagInputValue = tagValue.value;\n    if (!isLimitExceeded) {\n      newValue = tagValue.value instanceof Array ? tagValue.value.concat(String(valueStr)) : [valueStr];\n      setTagValue(newValue, {\n        trigger: 'enter',\n        index: newValue.length - 1,\n        item: valueStr,\n        e: context.e,\n      });\n    }\n    props?.onEnter?.(newValue, { ...context, inputValue: value });\n  };\n\n  // 按下回退键，删除标签\n  const onInputBackspaceKeyUp = (value: InputValue, context: { e: KeyboardEvent }) => {\n    const { e } = context;\n    if (!tagValue.value || !tagValue.value.length) return;\n    // 回车键删除，输入框值为空时，才允许 Backspace 删除标签\n    if (!oldInputValue.value && ['Backspace', 'NumpadDelete'].includes(e.code)) {\n      const index = tagValue.value.length - 1;\n      const item = tagValue.value[index];\n      const trigger = 'backspace';\n      setTagValue(tagValue.value.slice(0, -1), {\n        e,\n        index,\n        item,\n        trigger,\n      });\n      onRemove.value?.({\n        e,\n        index,\n        item,\n        trigger,\n        value: tagValue.value,\n      });\n    }\n    oldInputValue.value = value;\n  };\n\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const renderLabel = ({ displayNode, label }: { displayNode: any; label: any }, h: Vue.CreateElement) => {\n    const newList = minCollapsedNum.value ? tagValue.value.slice(0, minCollapsedNum.value) : tagValue.value;\n    const list = displayNode\n      ? [displayNode]\n      : newList?.map((item, index) => {\n        const tagContent = renderTNode('tag', { params: { value: item } });\n        return (\n            <Tag\n              key={index}\n              size={size.value}\n              disabled={disabled.value}\n              onClose={(context: { e: MouseEvent }) => onClose({ e: context.e, item, index })}\n              closable={!readonly.value && !disabled.value}\n              props={tagProps.value}\n            >\n              {tagContent ?? item}\n            </Tag>\n        );\n      });\n    if (![null, undefined, ''].includes(label)) {\n      list.unshift(\n        <div class={`${prefix}-tag-input__prefix`} key=\"label\">\n          {label}\n        </div>,\n      );\n    }\n    // 超出省略\n    if (newList.length !== tagValue.value.length) {\n      const len = tagValue.value.length - newList.length;\n      const more = renderTNode('collapsedItems', {\n        params: {\n          value: tagValue,\n          count: tagValue.value.length,\n          collapsedTags: tagValue.value.slice(minCollapsedNum.value, tagValue.value.length),\n        },\n      });\n      list.push(more ?? <Tag key=\"more\">+{len}</Tag>);\n    }\n    return list;\n  };\n\n  return {\n    tagValue,\n    clearAll,\n    onClose,\n    onInnerEnter,\n    onInputBackspaceKeyUp,\n    renderLabel,\n  };\n}\n"],"names":["useTagList","props","renderTNode","useTNodeJSX","toRefs","value","onRemove","max","minCollapsedNum","size","disabled","readonly","tagProps","useVModel","defaultValue","onChange","tagValue","setTagValue","oldInputValue","ref","onClose","p","arr","splice","index","trigger","clearAll","context","e","onInnerEnter","value2","valueStr","String","trim","isLimitExceeded","length","newValue","Array","concat","item","onEnter","inputValue","onInputBackspaceKeyUp","includes","code","slice","renderLabel","h","displayNode","label","newList","list","map","tagContent","params","_mergeJSXProps","unshift","prefix","len","more","count","collapsedTags","push"],"mappings":"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"}