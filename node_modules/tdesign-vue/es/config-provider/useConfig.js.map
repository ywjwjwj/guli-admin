{"version":3,"file":"useConfig.js","sources":["../../src/config-provider/useConfig.tsx"],"sourcesContent":["import { computed, inject } from '@vue/composition-api';\nimport cloneDeep from 'lodash/cloneDeep';\nimport _mergeWith from 'lodash/mergeWith';\nimport { defaultGlobalConfig, GlobalConfig } from './context';\n\nexport * from './type';\n\n// deal with https://github.com/lodash/lodash/issues/1313\nexport const merge = (defaultGlobalConfig: GlobalConfig, injectConfig: GlobalConfig) => _mergeWith(defaultGlobalConfig, injectConfig, (objValue, srcValue) => {\n  if (Array.isArray(objValue)) {\n    return srcValue;\n  }\n});\n\n/**\n * component global config\n * @param componentName\n * @returns {t, global}\n * useConfig('pagination')\n */\nexport function useConfig<T extends keyof GlobalConfig>(componentName: T) {\n  const mergedGlobalConfig = computed(() => {\n    const globalConfig = inject<GlobalConfig>('globalConfig', Object.create(null));\n    const mergedGlobalConfig = merge(cloneDeep(defaultGlobalConfig), globalConfig);\n    return mergedGlobalConfig;\n  });\n\n  const global = computed(() => mergedGlobalConfig.value[componentName]);\n\n  const classPrefix = computed(() => mergedGlobalConfig.value.classPrefix);\n\n  // 处理正则表达式\n  const t = function <T> (pattern: T, data?: Record<string, string | number>) {\n    if (typeof pattern === 'string') {\n      if (!data) return pattern;\n      const regular = /\\{\\s*([\\w-]+)\\s*\\}/g;\n      const translated = pattern.replace(regular, (match, key) => {\n        if (data) {\n          return String(data[key]);\n        }\n        return '';\n      });\n      return translated;\n    }\n    if (typeof pattern === 'function') {\n      return pattern(data);\n    }\n    return '';\n  };\n\n  return {\n    t,\n    global,\n    classPrefix,\n  };\n}\n\nexport function usePrefixClass(componentName?: string) {\n  const { classPrefix } = useConfig('classPrefix');\n  return computed(() => (componentName ? `${classPrefix.value}-${componentName}` : classPrefix.value));\n}\n"],"names":["merge","defaultGlobalConfig2","injectConfig","_mergeWith","objValue","srcValue","Array","isArray","useConfig","componentName","mergedGlobalConfig","computed","globalConfig","inject","Object","create","mergedGlobalConfig2","cloneDeep","defaultGlobalConfig","global","value","classPrefix","t","pattern","data","regular","translated","replace","match","key","String","usePrefixClass"],"mappings":";;;;;;;;;;;;;;AAKO,IAAMA,KAAK,GAAG,SAARA,KAAQ,CAACC,oBAAD,EAAuBC,YAAvB,EAAA;AAAA,EAAwCC,OAAAA,SAAU,CAACF,oBAAD,EAAuBC,YAAvB,EAAqC,UAACE,QAAD,EAAWC,QAAX,EAAwB;AAClI,IAAA,IAAIC,KAAK,CAACC,OAAN,CAAcH,QAAd,CAAJ,EAA6B;AAC3B,MAAA,OAAOC,QAAP,CAAA;AACD,KAAA;AACF,GAJsE,CAAlD,CAAA;AAAA,EAAd;AAKA,SAASG,SAAT,CAAmBC,aAAnB,EAAkC;AACvC,EAAA,IAAMC,kBAAkB,GAAGC,QAAQ,CAAC,YAAM;AACxC,IAAA,IAAMC,YAAY,GAAGC,MAAM,CAAC,cAAD,iBAAiCC,MAAM,CAACC,MAAP,CAAc,IAAd,CAAjC,CAA3B,CAAA;AACA,IAAMC,IAAAA,mBAAmB,GAAGhB,KAAK,CAACiB,SAAS,CAACC,mBAAD,CAAV,EAAiCN,YAAjC,CAAjC,CAAA;AACA,IAAA,OAAOI,mBAAP,CAAA;AACD,GAJkC,CAAnC,CAAA;AAKA,EAAMG,IAAAA,MAAM,GAAGR,QAAQ,CAAC,YAAA;AAAA,IAAA,OAAMD,kBAAkB,CAACU,KAAnB,CAAyBX,aAAzB,CAAN,CAAA;AAAA,GAAD,CAAvB,CAAA;AACA,EAAMY,IAAAA,WAAW,GAAGV,QAAQ,CAAC,YAAA;AAAA,IAAA,OAAMD,kBAAkB,CAACU,KAAnB,CAAyBC,WAA/B,CAAA;AAAA,GAAD,CAA5B,CAAA;;AACA,EAAMC,IAAAA,CAAC,GAAG,SAAJA,CAAI,CAASC,OAAT,EAAkBC,IAAlB,EAAwB;AAChC,IAAA,IAAI,OAAOD,OAAP,KAAmB,QAAvB,EAAiC;AAC/B,MAAA,IAAI,CAACC,IAAL,EACE,OAAOD,OAAP,CAAA;AACF,MAAME,IAAAA,OAAO,GAAG,qBAAhB,CAAA;AACA,MAAA,IAAMC,UAAU,GAAGH,OAAO,CAACI,OAAR,CAAgBF,OAAhB,EAAyB,UAACG,KAAD,EAAQC,GAAR,EAAgB;AAC1D,QAAA,IAAIL,IAAJ,EAAU;AACR,UAAA,OAAOM,MAAM,CAACN,IAAI,CAACK,GAAD,CAAL,CAAb,CAAA;AACD,SAAA;;AACD,QAAA,OAAO,EAAP,CAAA;AACD,OALkB,CAAnB,CAAA;AAMA,MAAA,OAAOH,UAAP,CAAA;AACD,KAAA;;AACD,IAAA,IAAI,OAAOH,OAAP,KAAmB,UAAvB,EAAmC;AACjC,MAAOA,OAAAA,OAAO,CAACC,IAAD,CAAd,CAAA;AACD,KAAA;;AACD,IAAA,OAAO,EAAP,CAAA;AACD,GAjBD,CAAA;;AAkBA,EAAO,OAAA;AACLF,IAAAA,CAAC,EAADA,CADK;AAELH,IAAAA,MAAM,EAANA,MAFK;AAGLE,IAAAA,WAAW,EAAXA,WAAAA;AAHK,GAAP,CAAA;AAKD,CAAA;AACM,SAASU,cAAT,CAAwBtB,aAAxB,EAAuC;AAC5C,EAAwBD,IAAAA,UAAAA,GAAAA,SAAS,CAAC,aAAD,CAAjC;AAAA,MAAQa,WAAR,cAAQA,WAAR,CAAA;;AACA,EAAA,OAAOV,QAAQ,CAAC,YAAA;AAAA,IAAMF,OAAAA,aAAa,GAAMY,EAAAA,CAAAA,MAAAA,CAAAA,WAAW,CAACD,KAAlB,cAA2BX,aAA3B,CAAA,GAA6CY,WAAW,CAACD,KAA5E,CAAA;AAAA,GAAD,CAAf,CAAA;AACD;;;;"}