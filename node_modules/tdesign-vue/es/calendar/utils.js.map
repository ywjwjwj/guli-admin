{"version":3,"file":"utils.js","sources":["../../src/calendar/utils.ts"],"sourcesContent":["import dayjs from 'dayjs';\n\nimport { CalendarCell } from './type';\n\n// 组件的一些常量\nimport {\n  FIRST_MONTH_OF_YEAR,\n  LAST_MONTH_OF_YEAR,\n  DAY_CN_MAP,\n} from './const';\n\n/**\n * 获取一个日期是周几（1~7）\n */\nconst getDay = (dt: Date): number => {\n  let day = dayjs(dt).day();\n  if (day === 0) {\n    day = 7;\n  }\n  return day;\n};\n\n/**\n * 获取星期的中文\n * @param num 星期（1~7）\n */\nconst getDayCn = (num: number): string => {\n  let re = '';\n  const numStr = num.toString();\n  if (numStr in DAY_CN_MAP) {\n    re = DAY_CN_MAP[numStr];\n  }\n  return re;\n};\n\n/**\n * 获取一个日期在日历上的列下标\n * @param firstDayOfWeek 周起始日（1~7）\n * @param dt\n */\nconst getCellColIndex = (firstDayOfWeek: number, dt: Date): number => {\n  let re = 0;\n  const day = getDay(dt);\n  if (day >= firstDayOfWeek) {\n    re = day - firstDayOfWeek;\n  } else {\n    re = 7 - firstDayOfWeek + day;\n  }\n  return re;\n};\n/**\n * 返回日期+天数（天数可以负数）\n */\nconst addDate = (dt: Date, days: number) => {\n  const d = new Date(dt);\n  d.setDate(d.getDate() + days);\n  return d;\n};\n\n/**\n * 创建月历单元格数据\n * @param year 月历年份\n * @param curDate 当前日期\n */\nconst createYearCellsData = (\n  year: number,\n  curDate: dayjs.Dayjs,\n  format: string,\n): CalendarCell[] => {\n  const monthsArr: CalendarCell[] = [];\n  const isCurYear = curDate.year() === year;\n  for (let num = FIRST_MONTH_OF_YEAR; num <= LAST_MONTH_OF_YEAR; num++) {\n    const date = new Date(year, num - 1);\n    const curDateMon = parseInt(curDate.format('M'), 10);\n    const isCurrent = (isCurYear && curDateMon === num);\n    monthsArr.push({\n      mode: 'year',\n      isCurrent,\n      date,\n      formattedDate: dayjs(date).format(format),\n      filterDate: null,\n      formattedFilterDate: null,\n      isShowWeekend: true,\n    });\n  }\n\n  return monthsArr;\n};\n\n/**\n * 创建日历单元格数据\n * @param year 日历年份\n * @param month 日历月份\n * @param firstDayOfWeek 周起始日（1~7）\n * @param curDate 当前日期\n * @param format 日期格式\n */\nconst createMonthCellsData = (\n  year: number,\n  month: number,\n  firstDayOfWeek: number,\n  curDate: dayjs.Dayjs,\n  format: string,\n): CalendarCell[][] => {\n  const daysArr: CalendarCell[][] = [];\n  // 当前月份的开始日期\n  const begin: Date = dayjs(`${year}-${month}`).startOf('month')\n    .toDate();\n  // 当前月份的结束日期\n  const end: Date = dayjs(`${year}-${month}`).endOf('month')\n    .toDate();\n  const days = end.getDate();\n\n  const beginDateColIndex = getCellColIndex(firstDayOfWeek, begin);\n  let arr = [];\n  let num = 1;\n\n  const createCellData = (\n    belongTo: number,\n    isCurrent: boolean,\n    date: Date,\n    weekOrder: number,\n  ): CalendarCell => {\n    const day = getDay(date);\n    return {\n      mode: 'month',\n      belongTo,\n      isCurrent,\n      day,\n      weekOrder,\n      date,\n      formattedDate: dayjs(date).format(format),\n      filterDate: null,\n      formattedFilterDate: null,\n      isShowWeekend: true,\n    };\n  };\n\n  // 添加上个月中和当前月第一天同一周的日期\n  for (let i = 0; i < beginDateColIndex; i++) {\n    const date = addDate(begin, (i - beginDateColIndex));\n    arr.push(createCellData(-1, false, date, num));\n    if (arr.length === 7) {\n      daysArr.push(arr);\n      arr = [];\n      num += 1;\n    }\n  }\n  for (let i = 0; i < days; i++) {\n    const date = addDate(begin, i);\n    arr.push(createCellData(0, curDate.isSame(dayjs(date)), date, num));\n    if (arr.length === 7) {\n      daysArr.push(arr);\n      arr = [];\n      num += 1;\n    }\n  }\n  // 添加下个月中和当前月最后同一周的日期\n  if (arr.length) {\n    const nextMonthCellNum = 7 - arr.length;\n    for (let i = 0; i < nextMonthCellNum; i++) {\n      const date = addDate(end, i + 1);\n      arr.push(createCellData(1, false, date, num));\n    }\n    daysArr.push(arr);\n  }\n\n  return daysArr;\n};\n\nexport {\n  getDayCn,\n  getCellColIndex,\n  addDate,\n  createYearCellsData,\n  createMonthCellsData,\n};\n"],"names":["getDay","dt","day","dayjs","getDayCn","num","re","numStr","toString","DAY_CN_MAP","getCellColIndex","firstDayOfWeek","addDate","days","d","Date","setDate","getDate","createYearCellsData","year","curDate","format","monthsArr","isCurYear","FIRST_MONTH_OF_YEAR","LAST_MONTH_OF_YEAR","date","curDateMon","parseInt","isCurrent","push","mode","formattedDate","filterDate","formattedFilterDate","isShowWeekend","createMonthCellsData","month","daysArr","begin","startOf","toDate","end","endOf","beginDateColIndex","arr","createCellData","belongTo","weekOrder","i","length","isSame","nextMonthCellNum"],"mappings":"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"}