{"version":3,"file":"v-menu.js","sources":["../../src/menu/v-menu.ts"],"sourcesContent":["import { VNodeChildren } from 'vue';\n\ntype MenuValue = string | number;\ntype MenuNode = MenuValue | VMenuData;\n\ninterface VMenuData {\n  value: MenuValue;\n  parent?: MenuNode;\n  children: VMenuData[];\n  vnode?: VNodeChildren;\n}\n\ninterface VMenuItem {\n  value?: MenuValue;\n  parent: MenuValue;\n  vnode?: VNodeChildren;\n}\n\nconst getTreePaths = (node: VMenuData, val: MenuValue, ans: MenuValue[]): MenuValue[] => {\n  if (!node) return;\n  for (let i = 0; i < node.children.length; ++i) {\n    const child = node.children[i];\n    if (child.value === val) return [...ans, node.value];\n    const target = getTreePaths(child, val, [...ans, node.value]);\n    if (target) return target;\n  }\n};\n\nconst getTreeSameParentNodes = (node: VMenuData, val: MenuValue): VMenuData[] => {\n  if (!node) return;\n  for (let i = 0; i < node.children.length; ++i) {\n    const child = node.children[i];\n    if (child.value === val) return node.children;\n    const target = getTreeSameParentNodes(child, val);\n    if (target) return target;\n  }\n};\n\nconst DFS = (root: VMenuData, val: MenuValue): VMenuData => {\n  if (root.value === val) return root;\n  if (root.children.length > 0) {\n    for (let i = 0, len = root.children.length; i < len; i++) {\n      const res = DFS(root.children[i], val);\n      if (res) return res;\n    }\n  }\n};\n\nexport default class VMenu {\n  data: VMenuData = null;\n\n  cache: Set<VMenuData> = new Set();\n\n  isMutex = false;\n\n  expandValues: Set<MenuValue> = null;\n\n  constructor(options: Record<string, any>) {\n    const root: VMenuData = {\n      value: null, parent: null, children: [],\n    };\n    this.data = root;\n    this.isMutex = options?.isMutex;\n    this.expandValues = new Set(options?.expandValues);\n  }\n\n  add(item: VMenuItem) {\n    const { value, parent, vnode } = item;\n    const node: VMenuData = {\n      value,\n      parent,\n      vnode,\n      children: [],\n    };\n\n    this.cache.forEach((data, v2, set) => {\n      if (item.value === data.parent) {\n        node.children.push(data);\n        set.delete(data);\n      }\n    });\n    if (item.parent == null) {\n      this.data.children.push(node);\n      node.parent = this.data;\n    } else if (this.data.children.length > 0) {\n      const pNode = DFS(this.data, parent);\n      if (pNode) {\n        pNode.children.push(node);\n      } else {\n        this.cache.add(node);\n      }\n    } else {\n      this.cache.add(node);\n    }\n  }\n\n  select(val: MenuValue) {\n    const activeValues = getTreePaths(this.data, val, []) || [];\n\n    activeValues.push(val);\n    return activeValues.filter((val) => val != null);\n  }\n\n  expand(val: MenuValue) {\n    if (this.expandValues.has(val)) {\n      this.expandValues.delete(val);\n      return [...this.expandValues];\n    }\n\n    this.expandValues.add(val);\n\n    if (!this.isMutex) {\n      return [...this.expandValues];\n    }\n\n    const sameParentNodes = getTreeSameParentNodes(this.data, val);\n    const sameLevelSubmenuValues = new Set(sameParentNodes\n      .filter((node) => node.children?.length > 0 && node.value !== val)\n      .map((child) => child.value));\n\n    this.expandValues.forEach((val) => {\n      const isHit = sameLevelSubmenuValues.has(val);\n      if (isHit) {\n        this.expandValues.delete(val);\n      }\n    });\n    return [...this.expandValues];\n  }\n\n  getChild(value: MenuValue) {\n    const target = DFS(this.data, value);\n\n    return target ? target.children : [];\n  }\n}\n"],"names":["getTreePaths","node","val","ans","i","children","length","child","value","target","getTreeSameParentNodes","DFS","root","len","res","VMenu","options","Set","parent","data","isMutex","expandValues","item","vnode","cache","forEach","v2","set","push","pNode","add","activeValues","filter","val2","has","sameParentNodes","sameLevelSubmenuValues","map","isHit"],"mappings":"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"}