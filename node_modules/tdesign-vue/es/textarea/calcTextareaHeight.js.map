{"version":3,"file":"calcTextareaHeight.js","sources":["../../src/textarea/calcTextareaHeight.ts"],"sourcesContent":["/**\n * Thanks to https://github.com/ElemeFE/element/blob/dev/packages/input/src/calcTextareaHeight.js\n */\ntype RowsType = number | null;\n\ntype ResultType = {\n  height?: string,\n  minHeight?: string\n};\n\nlet hiddenTextarea: HTMLTextAreaElement;\n\nconst HIDDEN_TEXTAREA_STYLE = `\n  min-height:0 !important;\n  max-height:none !important;\n  height:0 !important;\n  visibility:hidden !important;\n  overflow:hidden !important;\n  position:absolute !important;\n  z-index:-1000 !important;\n  top:0 !important;\n  right:0 !important\n`;\n\nconst SIZING_PROPS = [\n  'letter-spacing',\n  'line-height',\n  'padding-top',\n  'padding-bottom',\n  'font-family',\n  'font-weight',\n  'font-size',\n  'font-variant',\n  'text-rendering',\n  'text-transform',\n  'width',\n  'text-indent',\n  'padding-left',\n  'padding-right',\n  'border-width',\n  'box-sizing',\n];\n\nfunction calculateNodeStyling(targetElement: HTMLTextAreaElement) {\n  const style = window.getComputedStyle(targetElement);\n\n  const boxSizing = style.getPropertyValue('box-sizing')\n  || style.getPropertyValue('-moz-box-sizing')\n  || style.getPropertyValue('-webkit-box-sizing');\n\n  const paddingSize = (\n    parseFloat(style.getPropertyValue('padding-bottom'))\n    + parseFloat(style.getPropertyValue('padding-top'))\n  );\n\n  const borderSize = (\n    parseFloat(style.getPropertyValue('border-bottom-width'))\n    + parseFloat(style.getPropertyValue('border-top-width'))\n  );\n\n  const sizingStyle = SIZING_PROPS\n    .map((name) => `${name}:${style.getPropertyValue(name)}`)\n    .join(';');\n\n  return {\n    sizingStyle, paddingSize, borderSize, boxSizing,\n  };\n}\n\nexport default function calcTextareaHeight(\n  targetElement: HTMLTextAreaElement,\n  minRows: RowsType = 1,\n  maxRows: RowsType = null,\n) {\n  if (!hiddenTextarea) {\n    hiddenTextarea = document.createElement('textarea');\n    document.body.appendChild(hiddenTextarea);\n  }\n\n  const {\n    paddingSize,\n    borderSize,\n    boxSizing,\n    sizingStyle,\n  } = calculateNodeStyling(targetElement);\n\n  hiddenTextarea.setAttribute('style', `${sizingStyle};${HIDDEN_TEXTAREA_STYLE}`);\n  hiddenTextarea.value = targetElement.value || targetElement.placeholder || '';\n\n  let height = hiddenTextarea.scrollHeight;\n  const result: ResultType = {};\n\n  if (boxSizing === 'border-box') {\n    height += borderSize;\n  } else if (boxSizing === 'content-box') {\n    height -= paddingSize;\n  }\n\n  hiddenTextarea.value = '';\n  const singleRowHeight = hiddenTextarea.scrollHeight - paddingSize;\n\n  if (minRows !== null) {\n    let minHeight = singleRowHeight * minRows;\n    if (boxSizing === 'border-box') {\n      minHeight = minHeight + paddingSize + borderSize;\n    }\n    height = Math.max(minHeight, height);\n    result.minHeight = `${minHeight}px`;\n  }\n  if (maxRows !== null) {\n    let maxHeight = singleRowHeight * maxRows;\n    if (boxSizing === 'border-box') {\n      maxHeight = maxHeight + paddingSize + borderSize;\n    }\n    height = Math.min(maxHeight, height);\n  }\n  result.height = `${height}px`;\n  hiddenTextarea.parentNode && hiddenTextarea.parentNode.removeChild(hiddenTextarea);\n  hiddenTextarea = null;\n  return result;\n}\n"],"names":["hiddenTextarea","HIDDEN_TEXTAREA_STYLE","SIZING_PROPS","calculateNodeStyling","targetElement","style","window","getComputedStyle","boxSizing","getPropertyValue","paddingSize","parseFloat","borderSize","sizingStyle","map","name","join","calcTextareaHeight","minRows","maxRows","document","createElement","body","appendChild","setAttribute","value","placeholder","height","scrollHeight","result","singleRowHeight","minHeight","Math","max","maxHeight","min","parentNode","removeChild"],"mappings":"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"}